<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Password - RemoEdPH</title>
  <link rel="stylesheet" href="modern-styles.css">
  <style>
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      position: relative;
      overflow: hidden;
    }
    
    /* Floating educational elements */
    .floating-elements {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }
    
    .floating-element {
      position: absolute;
      font-size: 2rem;
      animation: float 6s ease-in-out infinite;
      opacity: 0.2;
    }
    
    .floating-element:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
    .floating-element:nth-child(2) { top: 20%; right: 15%; animation-delay: 1s; }
    .floating-element:nth-child(3) { bottom: 30%; left: 20%; animation-delay: 2s; }
    .floating-element:nth-child(4) { bottom: 20%; right: 10%; animation-delay: 3s; }
    .floating-element:nth-child(5) { top: 50%; left: 5%; animation-delay: 4s; }
    .floating-element:nth-child(6) { top: 60%; right: 5%; animation-delay: 5s; }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }
    
                   .change-password-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 2px solid #667eea;
        position: relative;
        z-index: 2;
        max-width: 500px;
        width: 90%;
        animation: slideIn 0.8s ease-out;
        display: flex;
        flex-direction: column;
        align-items: center;
        max-height: 90vh;
        overflow-y: auto;
      }
    
    @keyframes slideIn {
      0% { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    
         .remoed-logo {
       justify-content: center;
       margin-bottom: 1rem;
       animation: pulse 2s infinite;
     }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .remoed-title {
      color: #667eea !important;
      font-size: 1.8rem !important;
      font-weight: bold !important;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
         .change-password-title {
       color: #667eea !important;
       font-size: 1.6rem !important;
       font-weight: bold !important;
       text-align: center;
       margin-bottom: 1rem;
       text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
     }
    
                   .change-password-form {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 15px;
      }
    
    .form-group {
      position: relative;
    }
    
    .form-group label {
      color: #667eea !important;
      font-weight: 600 !important;
      font-size: 1rem !important;
      margin-bottom: 0.5rem !important;
      display: block;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e8ed;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      box-sizing: border-box;
    }
    
    .form-group input:focus {
      border-color: #667eea;
      box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
      transform: scale(1.02);
      outline: none;
    }
    
    .password-group {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      z-index: 10;
      padding: 0.5rem;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .password-toggle:hover {
      background-color: rgba(0,0,0,0.1);
    }
    
    .password-toggle:active {
      background-color: rgba(0,0,0,0.2);
      transform: scale(0.95);
    }
    
    .password-toggle svg {
      width: 1.25rem;
      height: 1.25rem;
      color: #64748b;
      pointer-events: none;
    }
    
    .password-input {
      padding-right: 3rem !important;
    }
    
    /* Password input container */
    .password-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .password-input-container input {
      padding-right: 50px;
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .password-toggle:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: scale(1.1);
    }
    
    .password-toggle:active {
      transform: scale(0.95);
    }
    
    .eye-icon {
      font-size: 1.2rem;
      color: #667eea;
      transition: all 0.3s ease;
    }
    
    .password-toggle.show-password .eye-icon {
      color: #764ba2;
    }
    
                   .change-password-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 14px 30px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        letter-spacing: 0.5px;
        width: 100%;
        display: block !important;
        margin-top: 20px;
        margin-bottom: 15px;
      }
    
    .change-password-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
      background: linear-gradient(45deg, #764ba2, #667eea);
    }
    
    .change-password-btn:active {
      transform: translateY(0);
    }
    
    .change-password-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .message {
      font-size: 1rem;
      margin-top: 8px;
      text-align: center;
      display: none;
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      font-weight: 500;
    }
    
    .message.success {
      background: #f0fdf4;
      border: 2px solid #bbf7d0;
      color: #16a34a;
    }
    
    .message.error {
      background: #fef2f2;
      border: 2px solid #fecaca;
      color: #dc2626;
    }
    
         .welcome-message {
       text-align: center;
       color: #667eea;
       font-size: 0.9rem;
       font-weight: 600;
       margin-bottom: 0.8rem;
       text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
     }
    
         .password-requirements {
       background: rgba(102, 126, 234, 0.1);
       border-radius: 8px;
       padding: 8px;
       margin-top: 6px;
       font-size: 0.8rem;
       color: #667eea;
     }
    
    .password-requirements ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }
    
    .password-requirements li {
      margin-bottom: 4px;
    }
    
    .requirement-met {
      color: #16a34a;
    }
    
    .requirement-not-met {
      color: #dc2626;
    }
  </style>
</head>
<body>
  <!-- Floating educational elements -->
  <div class="floating-elements" id="floating-elements">
    <div class="floating-element">üìö</div>
    <div class="floating-element">‚úèÔ∏è</div>
    <div class="floating-element">üé®</div>
    <div class="floating-element">üî¢</div>
    <div class="floating-element">üåç</div>
    <div class="floating-element">‚≠ê</div>
  </div>

  <div class="change-password-container">
    <div class="remoed-logo">
      <img src="remoed-logo.png" alt="RemoEdPH Logo" style="height: 50px;">
      <span class="remoed-title">RemoEdPH</span>
    </div>
    
    <div class="welcome-message" id="welcome-message">
      üîê Set Your Personal Password üîê
    </div>
    
    <div class="change-password-title" id="change-password-title">Change Password</div>
    <form class="change-password-form" id="change-password-form">
      <div class="form-group">
        <label for="current-password">üîë Current Password</label>
                 <div class="password-input-container">
           <input type="password" id="current-password" class="password-input" placeholder="Enter your current password" required>
           <button type="button" class="password-toggle" id="current-password-toggle" onclick="togglePassword('current-password', 'current-password-toggle')">
             <span class="eye-icon">üëÅÔ∏è</span>
           </button>
         </div>
      </div>
      
      <div class="form-group">
        <label for="new-password">üÜï New Password</label>
                 <div class="password-input-container">
           <input type="password" id="new-password" class="password-input" placeholder="Enter your new password" required>
           <button type="button" class="password-toggle" id="new-password-toggle" onclick="togglePassword('new-password', 'new-password-toggle')">
             <span class="eye-icon">üëÅÔ∏è</span>
           </button>
         </div>
        <div class="password-requirements">
          <strong>Password Requirements:</strong>
          <ul>
            <li id="req-length">At least 8 characters long</li>
            <li id="req-uppercase">At least 1 uppercase letter</li>
            <li id="req-lowercase">At least 1 lowercase letter</li>
            <li id="req-number">At least 1 number</li>
          </ul>
        </div>
      </div>
      
      <div class="form-group">
        <label for="confirm-password">‚úÖ Confirm New Password</label>
                 <div class="password-input-container">
           <input type="password" id="confirm-password" class="password-input" placeholder="Confirm your new password" required>
           <button type="button" class="password-toggle" id="confirm-password-toggle" onclick="togglePassword('confirm-password', 'confirm-password-toggle')">
             <span class="eye-icon">üëÅÔ∏è</span>
           </button>
         </div>
      </div>
      
      <button type="submit" class="change-password-btn" id="change-password-btn">
        üîê Update Password
      </button>
    </form>
         <div class="message" id="message"></div>
  </div>

  <script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded - Change Password Page');
      
      const token = localStorage.getItem('token');
      const userType = localStorage.getItem('userType');
      
      console.log('Token:', token ? 'Present' : 'Not found');
      console.log('User Type:', userType);
      
      // Check if elements exist
      const submitBtn = document.getElementById('change-password-btn');
      console.log('Submit button found:', !!submitBtn);
      
      const currentPasswordInput = document.getElementById('current-password');
      const newPasswordInput = document.getElementById('new-password');
      const confirmPasswordInput = document.getElementById('confirm-password');
      
      console.log('Current password input found:', !!currentPasswordInput);
      console.log('New password input found:', !!newPasswordInput);
      console.log('Confirm password input found:', !!confirmPasswordInput);
      
      if (!token || !userType) {
        // Redirect to appropriate login page
        if (userType === 'student') {
          window.location.href = 'student-login.html';
        } else {
          window.location.href = 'teacher-login.html';
        }
        return;
      }
      
      // Update welcome message and title based on user type
      const welcomeMessage = document.getElementById('welcome-message');
      const changePasswordTitle = document.getElementById('change-password-title');
      
      if (userType === 'student') {
        welcomeMessage.innerHTML = 'üéì Set Your Student Password üéì';
        changePasswordTitle.innerHTML = 'Student Change Password';
        
        // Update floating elements for students
        const floatingElements = document.getElementById('floating-elements');
        floatingElements.innerHTML = `
          <div class="floating-element">üéì</div>
          <div class="floating-element">üìñ</div>
          <div class="floating-element">‚úèÔ∏è</div>
          <div class="floating-element">üî¨</div>
          <div class="floating-element">üé®</div>
          <div class="floating-element">üèÜ</div>
        `;
      } else {
        welcomeMessage.innerHTML = 'üë®‚Äçüè´ Set Your Teacher Password üë®‚Äçüè´';
        changePasswordTitle.innerHTML = 'Teacher Change Password';
        
        // Update floating elements for teachers
        const floatingElements = document.getElementById('floating-elements');
        floatingElements.innerHTML = `
          <div class="floating-element">üìö</div>
          <div class="floating-element">‚úèÔ∏è</div>
          <div class="floating-element">üé®</div>
          <div class="floating-element">üî¢</div>
          <div class="floating-element">üåç</div>
          <div class="floating-element">‚≠ê</div>
        `;
      }
    });

    // Password visibility toggle
    function togglePassword(inputId, buttonId) {
      console.log('togglePassword called for:', inputId, buttonId);
      const input = document.getElementById(inputId);
      const button = document.getElementById(buttonId);
      
      if (!input || !button) {
        console.error('Input or button not found:', inputId, buttonId);
        return;
      }
      
      const eyeIcon = button.querySelector('.eye-icon');
      if (!eyeIcon) {
        console.error('Eye icon not found in button');
        return;
      }
      
      if (input.type === 'password') {
        input.type = 'text';
        button.classList.add('show-password');
        eyeIcon.textContent = 'üôà';
        console.log('Password now visible');
      } else {
        input.type = 'password';
        button.classList.remove('show-password');
        eyeIcon.textContent = 'üëÅÔ∏è';
        console.log('Password now hidden');
      }
    }

    // Password validation (no special characters required)
    function validatePassword(password) {
      const requirements = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /\d/.test(password)
      };
      
      // Update UI
      document.getElementById('req-length').className = requirements.length ? 'requirement-met' : 'requirement-not-met';
      document.getElementById('req-uppercase').className = requirements.uppercase ? 'requirement-met' : 'requirement-not-met';
      document.getElementById('req-lowercase').className = requirements.lowercase ? 'requirement-met' : 'requirement-not-met';
      document.getElementById('req-number').className = requirements.number ? 'requirement-met' : 'requirement-not-met';
      
      return Object.values(requirements).every(req => req);
    }

    // Real-time password validation
    document.getElementById('new-password').addEventListener('input', function() {
      validatePassword(this.value);
    });

    // Form submission
    document.getElementById('change-password-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const messageDiv = document.getElementById('message');
      const submitBtn = document.getElementById('change-password-btn');
      
      // Clear previous messages
      messageDiv.style.display = 'none';
      
      // Validation
      if (!validatePassword(newPassword)) {
        showMessage('Please ensure your new password meets all requirements.', 'error');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showMessage('New passwords do not match.', 'error');
        return;
      }
      
      if (newPassword === currentPassword) {
        showMessage('New password must be different from current password.', 'error');
        return;
      }
      
      // Disable button and show loading
      submitBtn.disabled = true;
      submitBtn.textContent = 'üîÑ Updating...';
      
      try {
        const token = localStorage.getItem('token');
        const userType = localStorage.getItem('userType');
        
        const response = await fetch(`/api/auth/change-password`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            currentPassword,
            newPassword,
            userType
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showMessage('‚úÖ Password updated successfully! Redirecting...', 'success');
          submitBtn.textContent = '‚úÖ Success!';
          
          // Redirect after 2 seconds
          setTimeout(() => {
            if (userType === 'teacher') {
              window.location.href = 'teacher-dashboard.html';
            } else {
              window.location.href = 'student-dashboard.html';
            }
          }, 2000);
        } else {
          showMessage(data.message || 'Failed to update password. Please try again.', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'üîê Update Password';
        }
      } catch (error) {
        console.error('Error:', error);
        showMessage('An error occurred. Please try again.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'üîê Update Password';
      }
    });

         function showMessage(text, type) {
       const messageDiv = document.getElementById('message');
       messageDiv.textContent = text;
       messageDiv.className = `message ${type}`;
       messageDiv.style.display = 'block';
     }
  </script>
</body>
</html>
