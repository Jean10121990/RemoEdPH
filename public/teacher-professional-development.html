<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Development - RemoEdPH</title>
    <link rel="stylesheet" href="modern-styles.css">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f8fafc; 
            color: #1a202c;
            margin: 0;
            padding: 0;
        }
        
        .remoed-main {
            display: flex;
            min-height: 100vh;
        }
        
        .remoed-sidebar {
            width: 260px;
            min-width: 260px;
            background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
            box-shadow: 4px 0 20px rgba(102, 126, 234, 0.1);
            padding: 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        
        .remoed-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .remoed-menu li {
            padding: 14px 32px;
            color: #64748b;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
            transition: background 0.2s, border-color 0.2s;
        }
        
        .remoed-menu li.active,
        .remoed-menu li:hover {
            background: linear-gradient(90deg, #667eea 0%, #5a67d8 100%);
            border-left: 4px solid #667eea;
            color: white;
            transform: translateX(4px);
            transition: all 0.3s ease;
            border-radius: 0 8px 8px 0;
        }
        
        .remoed-menu svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }
        
        .remoed-content {
            flex: 1;
            padding: 36px 40px;
            margin-left: 260px;
            max-width: calc(100vw - 260px);
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }
        
        .page-header h1 {
            color: #667eea;
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e8f4fd;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .training-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .training-card {
            background: linear-gradient(135deg, #f0f8ff 0%, #ffffff 100%);
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .training-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }
        
        .training-card.completed {
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
            border-color: #10b981;
        }
        
        .training-card.in-progress {
            background: linear-gradient(135deg, #fff4e6 0%, #ffffff 100%);
            border-color: #f59e0b;
        }
        
        .training-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }
        
        .training-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .training-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .training-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #666;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e8f4fd;
        }
        
        .training-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.75rem;
        }
        
        .status-available {
            background: #e8f4fd;
            color: #667eea;
        }
        
        .status-completed {
            background: #d1fae5;
            color: #10b981;
        }
        
        .status-in-progress {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .certification-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .certification-table th,
        .certification-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e8f4fd;
        }
        
        .certification-table th {
            background: #f0f8ff;
            color: #667eea;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .certification-table tr:hover {
            background: #f8f9fa;
        }
        
        .expiry-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .expiry-valid {
            background: #d1fae5;
            color: #10b981;
        }
        
        .expiry-warning {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .expiry-expired {
            background: #fee2e2;
            color: #e74c3c;
        }
        
        .assessment-card {
            background: linear-gradient(135deg, #f0f8ff 0%, #ffffff 100%);
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .assessment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .assessment-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .assessment-date {
            font-size: 0.85rem;
            color: #666;
        }
        
        .skill-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .skill-level-item {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 2px solid #e8f4fd;
        }
        
        .skill-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .level-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .level-beginner {
            background: #fee2e2;
            color: #e74c3c;
        }
        
        .level-intermediate {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .level-advanced {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        .level-expert {
            background: #d1fae5;
            color: #10b981;
        }
        
        .peer-learning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .peer-card {
            background: white;
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .peer-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }
        
        .peer-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .peer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .peer-info h4 {
            margin: 0;
            color: #667eea;
            font-size: 1rem;
        }
        
        .peer-info p {
            margin: 4px 0 0 0;
            color: #666;
            font-size: 0.85rem;
        }
        
        .peer-expertise {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }
        
        .expertise-tag {
            background: #e8f4fd;
            color: #667eea;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #f0f8ff;
        }
        
        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid #e8f4fd;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        @media (max-width: 768px) {
            .remoed-content {
                margin-left: 0;
                padding: 20px;
            }
            
            .remoed-sidebar {
                transform: translateX(-100%);
            }
            
            .training-grid,
            .peer-learning-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <!-- Remo AI Chatbot Styles -->
    <style>
        #remo-ai-chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 380px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            display: none;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        #remo-ai-chatbot.open {
            display: flex;
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }
        
        .chatbot-header h3 {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chatbot-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .chatbot-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .chatbot-message {
            display: flex;
            gap: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        .chatbot-message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .chatbot-message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .chatbot-message.user .message-avatar {
            background: #e2e8f0;
            color: #667eea;
        }
        
        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .chatbot-message.bot .message-content {
            background: white;
            color: #1a202c;
            border: 1px solid #e2e8f0;
        }
        
        .chatbot-message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .message-buttons {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .message-button {
            padding: 10px 14px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #667eea;
            font-weight: 500;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .message-button:hover {
            background: #e2e8f0;
            border-color: #667eea;
            transform: translateX(4px);
        }
        
        .message-button-icon {
            font-size: 1rem;
        }
        
        .quick-actions {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .quick-action-btn {
            padding: 8px 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #667eea;
            font-weight: 500;
        }
        
        .quick-action-btn:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        
        .chatbot-input-area {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
        }
        
        .chatbot-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 25px;
            font-size: 0.9rem;
            outline: none;
        }
        
        .chatbot-input:focus {
            border-color: #667eea;
        }
        
        .chatbot-send {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .chatbot-send:hover {
            transform: scale(1.1);
        }
        
        .chatbot-toggle {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4), 0 0 20px rgba(255, 165, 0, 0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
            padding: 0;
            overflow: visible;
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4), 0 0 30px rgba(255, 165, 0, 0.5);
        }
        
        .remo-ai-icon {
            width: 40px;
            height: 40px;
            filter: drop-shadow(0 0 8px rgba(255, 165, 0, 0.6));
        }
        
        .chatbot-message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }
        
        .chatbot-message.bot .message-avatar svg {
            width: 28px;
            height: 28px;
        }
        
        .chatbot-toggle.hidden {
            display: none;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <div class="remoed-main">
        <nav class="remoed-sidebar">
            <div style="padding: 24px; border-bottom: 2px solid #e8f4fd;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.2rem;">R</div>
                    <div>
                        <div style="font-weight: 700; color: #667eea; font-size: 1.1rem;">RemoEdPH</div>
                        <div style="font-size: 0.75rem; color: #666;">Teacher Portal</div>
                    </div>
                </div>
            </div>
            <div style="padding: 16px; border-bottom: 2px solid #e8f4fd;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="profile-image" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">
                        <span id="avatar-text">T</span>
                    </div>
                    <span class="remoed-username" id="remoed-username">Hi, Teacher</span>
                </div>
            </div>
            <ul class="remoed-menu">
                <li onclick="window.location.href='teacher-dashboard.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="4"/></svg>Dashboard</li>
                <li onclick="window.location.href='teacher-class-table.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3v4M8 3v4"/></svg>Class Schedule</li>
                <li onclick="window.location.href='teacher-open-class.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8M12 8v8"/></svg>Class Configuration</li>
                <li onclick="window.location.href='device-check.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8M12 8v8"/></svg>Device Check</li>
                <li onclick="window.location.href='teacher-service-fee.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 10c-4.41 0-8-1.79-8-4V6c0-2.21 3.59-4 8-4s8 1.79 8 4v8c0 2.21-3.59 4-8 4z"/></svg>Teaching Fee</li>
                <li onclick="window.location.href='teacher-performance-indicator.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><path d="M3 3v18h18M7 12h10M7 8h6M7 16h4"/></svg>Performance Indicator</li>
                <li class="active"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>Professional Development</li>
                <li onclick="window.location.href='teacher-profile.html'"><svg fill="none" stroke="#667eea" stroke-width="2" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>Profile</li>
                <li id="logout-nav" style="margin-top:auto; color:#e74c3c; cursor:pointer;"><svg fill="none" stroke="#e74c3c" stroke-width="2" viewBox="0 0 24 24"><path d="M17 16l4-4m0 0l-4-4m4 4H7"/><path d="M3 12a9 9 0 0118 0 9 9 0 01-18 0z"/></svg>Logout</li>
            </ul>
        </nav>
        
        <div class="remoed-content">
            <div class="page-header">
                <h1>üéì Professional Development</h1>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('training', this)">üìö Training Portal</button>
                <button class="tab-btn" onclick="showTab('certifications', this)">üèÜ Certifications</button>
                <button class="tab-btn" onclick="showTab('assessments', this)">üìä Skill Assessments</button>
                <button class="tab-btn" onclick="showTab('peer-learning', this)">üë• Peer Learning</button>
            </div>
            
            <!-- Training Portal Tab -->
            <div id="training-tab" class="tab-content active">
                <div class="section-card">
                    <div class="section-title">üìö Training Portal</div>
                    <p style="color: #666; margin-bottom: 24px;">Access training materials, courses, and resources to enhance your teaching skills and advance your career.</p>
                    
                    <div class="training-grid" id="training-courses-grid">
                        <!-- Training courses will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Certifications Tab -->
            <div id="certifications-tab" class="tab-content">
                <div class="section-card">
                    <div class="section-title">üèÜ Certification Tracking</div>
                    <p style="color: #666; margin-bottom: 24px;">Track your certifications, their expiration dates, and renewal requirements.</p>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <button class="btn-primary" onclick="openAddCertificationModal()">+ Add Certification</button>
                        <div style="font-size: 0.9rem; color: #666;">
                            <span id="certification-summary"></span>
                        </div>
                    </div>
                    
                    <table class="certification-table" id="certifications-table">
                        <thead>
                            <tr>
                                <th>Certification Name</th>
                                <th>Issuing Organization</th>
                                <th>Issue Date</th>
                                <th>Expiration Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="certifications-tbody">
                            <!-- Certifications will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Skill Assessments Tab -->
            <div id="assessments-tab" class="tab-content">
                <div class="section-card">
                    <div class="section-title">üìä Skill Assessments</div>
                    <p style="color: #666; margin-bottom: 24px;">Periodic assessments help update your teaching levels and showcase your growth.</p>
                    
                    <div id="assessments-container">
                        <!-- Assessments will be loaded here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 32px;">
                        <button class="btn-primary" onclick="requestAssessment()">Request New Assessment</button>
                    </div>
                </div>
            </div>
            
            <!-- Peer Learning Tab -->
            <div id="peer-learning-tab" class="tab-content">
                <div class="section-card">
                    <div class="section-title">üë• Peer Learning Community</div>
                    <p style="color: #666; margin-bottom: 24px;">Connect with other teachers, share best practices, and learn from the community.</p>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                        <input type="text" id="peer-search" placeholder="Search teachers by name, expertise, or subject..." style="flex: 1; padding: 12px; border: 2px solid #e8f4fd; border-radius: 8px; font-size: 0.9rem;">
                        <button class="btn-primary" onclick="searchPeers()">Search</button>
                    </div>
                    
                    <div class="peer-learning-grid" id="peer-learning-grid">
                        <!-- Peer teachers will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Certification Modal -->
    <div id="add-certification-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="margin: 0; color: #667eea;">Add Certification</h2>
                <button onclick="closeAddCertificationModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
            </div>
            <form id="certification-form" onsubmit="saveCertification(event)">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">Certification Name *</label>
                    <input type="text" id="cert-name" required style="width: 100%; padding: 12px; border: 2px solid #e8f4fd; border-radius: 8px; font-size: 0.9rem;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">Issuing Organization *</label>
                    <input type="text" id="cert-organization" required style="width: 100%; padding: 12px; border: 2px solid #e8f4fd; border-radius: 8px; font-size: 0.9rem;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">Issue Date *</label>
                    <input type="date" id="cert-issue-date" required style="width: 100%; padding: 12px; border: 2px solid #e8f4fd; border-radius: 8px; font-size: 0.9rem;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">Expiration Date</label>
                    <input type="date" id="cert-expiry-date" style="width: 100%; padding: 12px; border: 2px solid #e8f4fd; border-radius: 8px; font-size: 0.9rem;">
                    <small style="color: #666; font-size: 0.85rem;">Leave blank if certification doesn't expire</small>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #667eea;">Certificate Number (Optional)</label>
                    <input type="text" id="cert-number" style="width: 100%; padding: 12px; border: 2px solid #e8f4fd; border-radius: 8px; font-size: 0.9rem;">
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn-primary" style="flex: 1;">Save Certification</button>
                    <button type="button" class="btn-secondary" onclick="closeAddCertificationModal()" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Role-based access control
        const userType = localStorage.getItem('userType');
        if (userType !== 'teacher') {
            alert('Access denied. This page is for teachers only.');
            window.location.href = 'index.html';
        }
        
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'teacher-login.html';
        }
        
        // Update sidebar profile
        async function updateSidebarProfile() {
            const usernameEl = document.getElementById('remoed-username');
            const avatarTextEl = document.getElementById('avatar-text');
            const profileImageEl = document.getElementById('profile-image');
            
            if (!token) return;
            
            try {
                const response = await fetch('/api/teacher/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.profile) {
                        const firstName = data.profile.firstName || 'Teacher';
                        if (usernameEl) {
                            usernameEl.textContent = `Hi, ${firstName}`;
                        }
                        if (avatarTextEl) {
                            avatarTextEl.textContent = firstName[0].toUpperCase();
                        }
                        if (data.profile.profilePicture && profileImageEl) {
                            const img = document.createElement('img');
                            img.src = data.profile.profilePicture;
                            img.style.width = '100%';
                            img.style.height = '100%';
                            img.style.borderRadius = '50%';
                            img.style.objectFit = 'cover';
                            profileImageEl.innerHTML = '';
                            profileImageEl.appendChild(img);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }
        
        // Tab switching
        function showTab(tabName, clickedElement) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Find and activate the clicked button
            if (clickedElement) {
                clickedElement.classList.add('active');
            } else {
                // Fallback: find button by data attribute or text
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.textContent.includes(tabName === 'training' ? 'Training' : 
                                                  tabName === 'certifications' ? 'Certifications' :
                                                  tabName === 'assessments' ? 'Assessments' : 'Peer')) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Update URL hash without triggering navigation
            if (window.history && window.history.replaceState) {
                window.history.replaceState(null, null, '#' + tabName);
            }
            
            // Load data for the selected tab
            if (tabName === 'training') {
                loadTrainingCourses();
            } else if (tabName === 'certifications') {
                loadCertifications();
            } else if (tabName === 'assessments') {
                loadAssessments();
            } else if (tabName === 'peer-learning') {
                loadPeerTeachers();
            }
        }
        
        // Training Portal
        async function loadTrainingCourses() {
            const grid = document.getElementById('training-courses-grid');
            if (!grid) return;
            
            // Mock training courses - in production, fetch from API
            const courses = [
                {
                    id: 1,
                    title: 'Effective Online Teaching Strategies',
                    description: 'Learn proven techniques for engaging students in virtual classrooms and maximizing learning outcomes.',
                    duration: '4 hours',
                    status: 'available',
                    icon: 'üíª'
                },
                {
                    id: 2,
                    title: 'TEFL Certification Course',
                    description: 'Comprehensive training for Teaching English as a Foreign Language with internationally recognized certification.',
                    duration: '120 hours',
                    status: 'in-progress',
                    progress: 45,
                    icon: 'üåç'
                },
                {
                    id: 3,
                    title: 'Student Engagement Techniques',
                    description: 'Master the art of keeping students motivated and engaged throughout your lessons.',
                    duration: '3 hours',
                    status: 'completed',
                    icon: 'üéØ'
                },
                {
                    id: 4,
                    title: 'Classroom Management Essentials',
                    description: 'Essential skills for managing virtual classrooms and handling challenging situations.',
                    duration: '2.5 hours',
                    status: 'available',
                    icon: 'üìã'
                },
                {
                    id: 5,
                    title: 'Advanced Grammar Teaching',
                    description: 'Deep dive into teaching complex grammar concepts with practical examples and activities.',
                    duration: '6 hours',
                    status: 'available',
                    icon: 'üìñ'
                },
                {
                    id: 6,
                    title: 'Cultural Sensitivity in Teaching',
                    description: 'Learn to create inclusive learning environments that respect diverse cultural backgrounds.',
                    duration: '3 hours',
                    status: 'available',
                    icon: 'üåè'
                }
            ];
            
            grid.innerHTML = courses.map(course => `
                <div class="training-card ${course.status}" onclick="openTrainingCourse(${course.id}, event)">
                    <div class="training-icon">${course.icon}</div>
                    <div class="training-title">${course.title}</div>
                    <div class="training-description">${course.description}</div>
                    <div class="training-meta">
                        <span>‚è±Ô∏è ${course.duration}</span>
                        <span class="training-status status-${course.status}">
                            ${course.status === 'available' ? 'Available' : course.status === 'in-progress' ? `In Progress (${course.progress}%)` : 'Completed ‚úì'}
                        </span>
                    </div>
                    ${course.status === 'in-progress' ? `<div style="background: #e0e6ed; border-radius: 8px; height: 6px; margin-top: 12px; overflow: hidden;"><div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: ${course.progress}%; transition: width 0.3s ease;"></div></div>` : ''}
                </div>
            `).join('');
        }
        
        function openTrainingCourse(courseId, evt) {
            // Prevent event bubbling
            if (evt) {
                evt.stopPropagation();
            }
            
            // Show a modal or navigate to course content
            const courseName = document.querySelector(`.training-card[onclick*="${courseId}"] .training-title`)?.textContent || `Course ${courseId}`;
            
            // Create a simple modal to show course details
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%;">
                    <h2 style="margin: 0 0 16px 0; color: #667eea;">${courseName}</h2>
                    <p style="color: #666; margin-bottom: 24px;">Ready to start this course? Click "Start Course" to begin your learning journey.</p>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn-primary" onclick="this.closest('div[style*=\"position: fixed\"]').remove()">Close</button>
                        <button class="btn-secondary" onclick="startCourse(${courseId}); this.closest('div[style*=\"position: fixed\"]').remove();">Start Course</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function startCourse(courseId) {
            // Map course IDs to appropriate actions
            const courseActions = {
                1: 'teacher-professional-development.html#training',
                2: 'teacher-professional-development.html#training',
                3: 'teacher-professional-development.html#training',
                4: 'teacher-professional-development.html#training',
                5: 'teacher-professional-development.html#training',
                6: 'teacher-professional-development.html#training'
            };
            
            // For now, redirect to training portal
            // In production, this could redirect to a specific course page
            const redirectUrl = courseActions[courseId] || 'teacher-professional-development.html#training';
            window.location.href = redirectUrl;
        }
        
        // Certifications
        async function loadCertifications() {
            try {
                console.log('Loading certifications...');
                const response = await fetch('/api/teacher/certifications', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Certifications response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Certifications data received:', data);
                    const certifications = data.certifications || [];
                    console.log('Certifications array:', certifications);
                    displayCertifications(certifications);
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    console.error('Failed to load certifications:', errorData);
                    displayCertifications([]);
                }
            } catch (error) {
                console.error('Error loading certifications:', error);
                displayCertifications([]);
            }
        }
        
        function displayCertifications(certifications) {
            const tbody = document.getElementById('certifications-tbody');
            const summary = document.getElementById('certification-summary');
            
            if (!tbody) return;
            
            if (certifications.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                            <div class="empty-state">
                                <div class="empty-state-icon">üèÜ</div>
                                <p>No certifications added yet. Click "Add Certification" to get started.</p>
                            </div>
                        </td>
                    </tr>
                `;
                if (summary) summary.textContent = 'No certifications';
                return;
            }
            
            const now = new Date();
            let validCount = 0;
            let expiringSoon = 0;
            let expiredCount = 0;
            
            tbody.innerHTML = certifications.map(cert => {
                const expiryDate = cert.expiryDate ? new Date(cert.expiryDate) : null;
                let statusClass = 'expiry-valid';
                let statusText = 'Valid';
                
                if (expiryDate) {
                    const daysUntilExpiry = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    if (daysUntilExpiry < 0) {
                        statusClass = 'expiry-expired';
                        statusText = 'Expired';
                        expiredCount++;
                    } else if (daysUntilExpiry <= 30) {
                        statusClass = 'expiry-warning';
                        statusText = `Expires in ${daysUntilExpiry} days`;
                        expiringSoon++;
                    } else {
                        validCount++;
                    }
                } else {
                    validCount++;
                }
                
                return `
                    <tr>
                        <td><strong>${cert.name || 'N/A'}</strong></td>
                        <td>${cert.organization || 'N/A'}</td>
                        <td>${cert.issueDate ? new Date(cert.issueDate).toLocaleDateString() : 'N/A'}</td>
                        <td>${expiryDate ? expiryDate.toLocaleDateString() : 'No expiration'}</td>
                        <td><span class="expiry-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-secondary" onclick="editCertification('${cert._id || cert.id}')" style="padding: 6px 12px; font-size: 0.85rem;">Edit</button>
                            <button class="btn-secondary" onclick="deleteCertification('${cert._id || cert.id}')" style="padding: 6px 12px; font-size: 0.85rem; margin-left: 8px; background: #fee2e2; color: #e74c3c; border-color: #e74c3c;">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            if (summary) {
                summary.textContent = `${validCount} valid, ${expiringSoon} expiring soon, ${expiredCount} expired`;
            }
        }
        
        function openAddCertificationModal() {
            document.getElementById('add-certification-modal').style.display = 'flex';
        }
        
        function closeAddCertificationModal() {
            document.getElementById('add-certification-modal').style.display = 'none';
            document.getElementById('certification-form').reset();
        }
        
        async function saveCertification(event) {
            event.preventDefault();
            
            const certData = {
                name: document.getElementById('cert-name').value,
                organization: document.getElementById('cert-organization').value,
                issueDate: document.getElementById('cert-issue-date').value,
                expiryDate: document.getElementById('cert-expiry-date').value || null,
                certificateNumber: document.getElementById('cert-number').value || null
            };
            
            console.log('Saving certification:', certData);
            
            try {
                const response = await fetch('/api/teacher/certifications', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(certData)
                });
                
                console.log('Save certification response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Certification saved successfully:', data);
                    alert('Certification added successfully!');
                    closeAddCertificationModal();
                    // Add a small delay to ensure the backend has saved
                    setTimeout(() => {
                        loadCertifications();
                    }, 500);
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    console.error('Failed to add certification:', errorData);
                    alert(`Failed to add certification: ${errorData.error || 'Please try again.'}`);
                }
            } catch (error) {
                console.error('Error saving certification:', error);
                alert(`Error saving certification: ${error.message || 'Please try again.'}`);
            }
        }
        
        function editCertification(certId) {
            alert(`Edit certification ${certId}. This would open an edit modal.`);
            // In production, load certification data and open edit modal
        }
        
        async function deleteCertification(certId) {
            if (confirm('Are you sure you want to delete this certification?')) {
                try {
                    const response = await fetch(`/api/teacher/certifications/${certId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        alert('Certification deleted successfully!');
                        loadCertifications();
                    } else {
                        const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                        alert(`Failed to delete certification: ${errorData.error || 'Please try again.'}`);
                    }
                } catch (error) {
                    console.error('Error deleting certification:', error);
                    alert(`Error deleting certification: ${error.message || 'Please try again.'}`);
                }
            }
        }
        
        // Skill Assessments
        async function loadAssessments() {
            const container = document.getElementById('assessments-container');
            if (!container) return;
            
            try {
                const response = await fetch('/api/teacher/assessments', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayAssessments(data.assessments || []);
                } else {
                    // Mock data for demonstration
                    displayAssessments([
                        {
                            id: 1,
                            date: '2024-01-15',
                            skills: {
                                listening: 'Advanced',
                                reading: 'Intermediate',
                                speaking: 'Advanced',
                                writing: 'Intermediate'
                            }
                        },
                        {
                            id: 2,
                            date: '2024-06-20',
                            skills: {
                                listening: 'Expert',
                                reading: 'Advanced',
                                speaking: 'Expert',
                                writing: 'Advanced'
                            }
                        }
                    ]);
                }
            } catch (error) {
                console.error('Error loading assessments:', error);
                displayAssessments([]);
            }
        }
        
        function displayAssessments(assessments) {
            const container = document.getElementById('assessments-container');
            if (!container) return;
            
            if (assessments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>No assessments yet. Request an assessment to get started.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = assessments.map(assessment => `
                <div class="assessment-card">
                    <div class="assessment-header">
                        <div class="assessment-title">Assessment #${assessment.id}</div>
                        <div class="assessment-date">${new Date(assessment.date).toLocaleDateString()}</div>
                    </div>
                    <div class="skill-levels">
                        ${Object.entries(assessment.skills).map(([skill, level]) => `
                            <div class="skill-level-item">
                                <div class="skill-name">${skill.charAt(0).toUpperCase() + skill.slice(1)}</div>
                                <span class="level-badge level-${level.toLowerCase()}">${level}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        async function requestAssessment() {
            if (confirm('Request a new skill assessment? An admin or trainer will review your profile and schedule an assessment.')) {
                try {
                    const response = await fetch('/api/teacher/assessments/request', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        alert(data.message || 'Assessment request submitted! You will be notified when it\'s scheduled.');
                    } else {
                        const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                        alert(`Failed to request assessment: ${errorData.error || 'Please try again.'}`);
                    }
                } catch (error) {
                    console.error('Error requesting assessment:', error);
                    alert(`Error requesting assessment: ${error.message || 'Please try again.'}`);
                }
            }
        }
        
        // Peer Learning
        async function loadPeerTeachers() {
            const grid = document.getElementById('peer-learning-grid');
            if (!grid) return;
            
            try {
                const response = await fetch('/api/teacher/peers', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayPeerTeachers(data.peers || []);
                } else {
                    console.error('Failed to load peer teachers:', response.status);
                    displayPeerTeachers([]);
                }
            } catch (error) {
                console.error('Error loading peer teachers:', error);
                displayPeerTeachers([]);
            }
        }
        
        function displayPeerTeachers(peers) {
            const grid = document.getElementById('peer-learning-grid');
            if (!grid) return;
            
            if (peers.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">üë•</div>
                        <p>No peer teachers found. Try adjusting your search.</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = peers.map(peer => {
                const peerId = String(peer.id || '').replace(/'/g, "\\'");
                return `
                <div class="peer-card" data-peer-id="${peerId.replace(/"/g, '&quot;')}" onclick="viewPeerProfile('${peerId}', event)">
                    <div class="peer-header">
                        <div class="peer-avatar">${peer.name.charAt(0)}</div>
                        <div class="peer-info">
                            <h4>${peer.name}</h4>
                            <p>‚≠ê ${peer.rating} | ${peer.experience} experience</p>
                        </div>
                    </div>
                    <div class="peer-expertise">
                        ${peer.expertise.map(exp => `<span class="expertise-tag">${exp}</span>`).join('')}
                    </div>
                    <button class="btn-secondary" style="width: 100%; margin-top: 12px;" onclick="event.stopPropagation(); connectWithPeer('${peerId}', event)">Connect</button>
                </div>
            `;
            }).join('');
        }
        
        function searchPeers() {
            const searchTerm = document.getElementById('peer-search').value;
            loadPeerTeachers(); // In production, pass search term to API
        }
        
        function viewPeerProfile(peerId, evt) {
            // Prevent event bubbling if called from card click
            if (evt) {
                evt.stopPropagation();
            }
            
            // Ensure peerId is a string
            const peerIdStr = String(peerId || '');
            
            // Create a modal to show peer profile
            // Use data attribute instead of searching onclick for better reliability
            const peerCard = document.querySelector(`.peer-card[data-peer-id="${peerIdStr}"]`);
            const peerName = peerCard?.querySelector('.peer-info h4')?.textContent || `Teacher ${peerIdStr}`;
            const peerInfo = peerCard?.querySelector('.peer-info p')?.textContent || '';
            const safePeerId = peerIdStr.replace(/'/g, "\\'");
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%;">
                    <h2 style="margin: 0 0 16px 0; color: #667eea;">${peerName}</h2>
                    <p style="color: #666; margin-bottom: 24px;">${peerInfo}</p>
                    <p style="color: #666; margin-bottom: 24px;">View their full profile, teaching experience, and connect for peer learning opportunities.</p>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn-primary" onclick="this.closest('div[style*=\"position: fixed\"]').remove()">Close</button>
                        <button class="btn-secondary" onclick="connectWithPeer('${safePeerId}'); this.closest('div[style*=\"position: fixed\"]').remove();">Connect</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function connectWithPeer(peerId, evt) {
            // Prevent event bubbling
            if (evt) {
                evt.stopPropagation();
            }
            
            // Ensure peerId is a string and encode it properly
            const safePeerId = encodeURIComponent(String(peerId || ''));
            
            // Redirect to peer learning connections page with peer ID
            window.location.href = `teacher-peer-learning-connections.html?peerId=${safePeerId}&action=connect`;
        }
        
        // Logout
        document.getElementById('logout-nav').addEventListener('click', function() {
            localStorage.clear();
            window.location.href = 'teacher-login.html';
        });
        
        // Handle hash navigation (e.g., #certifications)
        function handleHashNavigation() {
            const hash = window.location.hash.replace('#', '');
            if (hash) {
                // Map hash to tab name
                const tabMap = {
                    'certifications': 'certifications',
                    'training': 'training',
                    'assessments': 'assessments',
                    'peer-learning': 'peer-learning'
                };
                
                const tabName = tabMap[hash];
                if (tabName) {
                    // Find and click the appropriate tab button
                    const tabButton = Array.from(document.querySelectorAll('.tab-btn')).find(btn => {
                        return btn.textContent.includes(
                            tabName === 'certifications' ? 'Certifications' :
                            tabName === 'training' ? 'Training' :
                            tabName === 'assessments' ? 'Assessments' : 'Peer'
                        );
                    });
                    
                    if (tabButton) {
                        setTimeout(() => {
                            tabButton.click();
                        }, 100);
                    }
                }
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateSidebarProfile();
            loadTrainingCourses();
            loadCertifications();
            loadAssessments();
            loadPeerTeachers();
            
            // Handle hash navigation after a short delay to ensure DOM is ready
            setTimeout(handleHashNavigation, 200);
            
            // Initialize mobile features
            if (isMobile && isMobile()) {
                // Add swipe gestures to certification table rows
                setTimeout(() => {
                    const certRows = document.querySelectorAll('#certifications-tbody tr');
                    certRows.forEach(row => {
                        row.setAttribute('data-swipe-item', 'true');
                        row.style.position = 'relative';
                    });
                    
                    if (certRows.length > 0) {
                        new QuickActions('#certifications-tbody', {
                            actionButtons: ['edit', 'delete']
                        });
                    }
                }, 1000);
                
                // Add swipe gestures to peer cards
                const peerCards = document.querySelectorAll('.peer-card');
                peerCards.forEach(card => {
                    card.setAttribute('data-swipe-item', 'true');
                });
                
                if (peerCards.length > 0) {
                    new QuickActions('#peer-learning-grid', {
                        actionButtons: ['edit']
                    });
                }
            }
        });
    </script>
    <script src="mobile-utils.js"></script>
    
    <!-- Remo AI Chatbot -->
    <div id="remo-ai-chatbot">
      <div class="chatbot-header">
        <h3>
          <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: 24px; margin-right: 5px;">
            <defs>
              <radialGradient id="eyeGlowHeaderPD" cx="50%" cy="50%">
                <stop offset="0%" stop-color="#4FC3F7" stop-opacity="1"/>
                <stop offset="100%" stop-color="#29B6F6" stop-opacity="0.8"/>
              </radialGradient>
            </defs>
            <line x1="50" y1="5" x2="50" y2="15" stroke="#fff" stroke-width="2"/>
            <circle cx="50" cy="5" r="2" fill="#fff"/>
            <ellipse cx="50" cy="30" rx="25" ry="20" fill="white" stroke="#fff" stroke-width="2"/>
            <path d="M 45 20 L 50 25 L 55 20" stroke="#fff" stroke-width="1.5" fill="none"/>
            <rect x="35" y="25" width="30" height="20" rx="3" fill="#fff"/>
            <circle cx="42" cy="33" r="4" fill="url(#eyeGlowHeaderPD)"/>
            <circle cx="58" cy="33" r="4" fill="url(#eyeGlowHeaderPD)"/>
            <path d="M 40 40 Q 50 45 60 40" stroke="#4FC3F7" stroke-width="2" fill="none" stroke-linecap="round"/>
            <ellipse cx="25" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#fff" stroke-width="1.5"/>
            <ellipse cx="25" cy="30" rx="4" ry="6" fill="#fff"/>
            <ellipse cx="75" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#fff" stroke-width="1.5"/>
            <ellipse cx="75" cy="30" rx="4" ry="6" fill="#fff"/>
            <rect x="30" y="50" width="40" height="35" rx="5" fill="white" stroke="#fff" stroke-width="2"/>
            <rect x="38" y="58" width="24" height="18" rx="2" fill="#29B6F6" stroke="#4FC3F7" stroke-width="1"/>
            <circle cx="42" cy="62" r="1.5" fill="#ff4444"/>
            <circle cx="45" cy="62" r="1.5" fill="white"/>
            <circle cx="50" cy="66" r="3" fill="#FFD700"/>
            <ellipse cx="50" cy="70" rx="2" ry="3" fill="#4FC3F7"/>
            <rect x="30" y="82" width="40" height="4" fill="#fff"/>
            <rect x="20" y="55" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
            <rect x="20" y="60" width="12" height="3" fill="#fff"/>
            <rect x="68" y="55" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
            <rect x="68" y="60" width="12" height="3" fill="#fff"/>
            <ellipse cx="26" cy="78" rx="4" ry="5" fill="white" stroke="#fff" stroke-width="1.5"/>
            <ellipse cx="74" cy="78" rx="4" ry="5" fill="white" stroke="#fff" stroke-width="1.5"/>
            <rect x="35" y="88" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
            <rect x="35" y="93" width="12" height="3" fill="#fff"/>
            <rect x="53" y="88" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
            <rect x="53" y="93" width="12" height="3" fill="#fff"/>
            <ellipse cx="41" cy="110" rx="6" ry="4" fill="white" stroke="#fff" stroke-width="1.5"/>
            <ellipse cx="59" cy="110" rx="6" ry="4" fill="white" stroke="#fff" stroke-width="1.5"/>
          </svg>
          <span>Remo AI Assistant</span>
        </h3>
        <button class="chatbot-close" onclick="toggleChatbot()">√ó</button>
      </div>
      <div class="chatbot-messages" id="chatbot-messages">
        <div class="chatbot-message bot">
          <div class="message-avatar">
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" style="width: 28px; height: 28px;">
              <defs>
                <radialGradient id="eyeGlowInitPD" cx="50%" cy="50%">
                  <stop offset="0%" stop-color="#4FC3F7" stop-opacity="1"/>
                  <stop offset="100%" stop-color="#29B6F6" stop-opacity="0.8"/>
                </radialGradient>
              </defs>
              <line x1="50" y1="5" x2="50" y2="15" stroke="#1a1a1a" stroke-width="2"/>
              <circle cx="50" cy="5" r="2" fill="#1a1a1a"/>
              <ellipse cx="50" cy="30" rx="25" ry="20" fill="white" stroke="#1a1a1a" stroke-width="2"/>
              <path d="M 45 20 L 50 25 L 55 20" stroke="#1a1a1a" stroke-width="1.5" fill="none"/>
              <rect x="35" y="25" width="30" height="20" rx="3" fill="#1a1a1a"/>
              <circle cx="42" cy="33" r="4" fill="url(#eyeGlowInitPD)"/>
              <circle cx="58" cy="33" r="4" fill="url(#eyeGlowInitPD)"/>
              <path d="M 40 40 Q 50 45 60 40" stroke="#4FC3F7" stroke-width="2" fill="none" stroke-linecap="round"/>
              <ellipse cx="25" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="25" cy="30" rx="4" ry="6" fill="#1a1a1a"/>
              <ellipse cx="75" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="75" cy="30" rx="4" ry="6" fill="#1a1a1a"/>
              <rect x="30" y="50" width="40" height="35" rx="5" fill="white" stroke="#1a1a1a" stroke-width="2"/>
              <rect x="38" y="58" width="24" height="18" rx="2" fill="#29B6F6" stroke="#4FC3F7" stroke-width="1"/>
              <circle cx="42" cy="62" r="1.5" fill="#ff4444"/>
              <circle cx="45" cy="62" r="1.5" fill="white"/>
              <circle cx="50" cy="66" r="3" fill="#FFD700"/>
              <ellipse cx="50" cy="70" rx="2" ry="3" fill="#4FC3F7"/>
              <rect x="30" y="82" width="40" height="4" fill="#1a1a1a"/>
              <rect x="20" y="55" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="20" y="60" width="12" height="3" fill="#1a1a1a"/>
              <rect x="68" y="55" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="68" y="60" width="12" height="3" fill="#1a1a1a"/>
              <ellipse cx="26" cy="78" rx="4" ry="5" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="74" cy="78" rx="4" ry="5" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="35" y="88" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="35" y="93" width="12" height="3" fill="#1a1a1a"/>
              <rect x="53" y="88" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="53" y="93" width="12" height="3" fill="#1a1a1a"/>
              <ellipse cx="41" cy="110" rx="6" ry="4" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="59" cy="110" rx="6" ry="4" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
            </svg>
          </div>
          <div class="message-content">
            <strong>Hello! I'm Remo AI Assistant üëã</strong><br>
            I'm here to help you with troubleshooting, lesson support, and any questions about the platform. How can I assist you today?
          </div>
        </div>
      </div>
      <div class="quick-actions">
        <button class="quick-action-btn" onclick="handleQuickAction('tour')">üéØ Start Tour</button>
        <button class="quick-action-btn" onclick="handleQuickAction('troubleshooting')">üîß Troubleshooting</button>
        <button class="quick-action-btn" onclick="handleQuickAction('lessons')">üìö Lesson Support</button>
        <button class="quick-action-btn" onclick="handleQuickAction('schedule')">üìÖ Schedule Help</button>
      </div>
      <div class="chatbot-input-area">
        <input type="text" class="chatbot-input" id="chatbot-input" placeholder="Type your question..." onkeypress="handleChatbotKeyPress(event)">
        <button class="chatbot-send" onclick="sendChatbotMessage()">‚û§</button>
      </div>
    </div>
    <button class="chatbot-toggle" id="chatbot-toggle" onclick="toggleChatbot()" title="Open Remo AI Assistant">
      <svg class="remo-ai-icon" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <radialGradient id="eyeGlowTogglePD" cx="50%" cy="50%">
            <stop offset="0%" stop-color="#4FC3F7" stop-opacity="1"/>
            <stop offset="100%" stop-color="#29B6F6" stop-opacity="0.8"/>
          </radialGradient>
        </defs>
        <line x1="50" y1="5" x2="50" y2="15" stroke="#fff" stroke-width="2"/>
        <circle cx="50" cy="5" r="2" fill="#fff"/>
        <ellipse cx="50" cy="30" rx="25" ry="20" fill="white" stroke="#fff" stroke-width="2"/>
        <path d="M 45 20 L 50 25 L 55 20" stroke="#fff" stroke-width="1.5" fill="none"/>
        <rect x="35" y="25" width="30" height="20" rx="3" fill="#fff"/>
        <circle cx="42" cy="33" r="4" fill="url(#eyeGlowTogglePD)"/>
        <circle cx="58" cy="33" r="4" fill="url(#eyeGlowTogglePD)"/>
        <path d="M 40 40 Q 50 45 60 40" stroke="#4FC3F7" stroke-width="2" fill="none" stroke-linecap="round"/>
        <ellipse cx="25" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#fff" stroke-width="1.5"/>
        <ellipse cx="25" cy="30" rx="4" ry="6" fill="#fff"/>
        <ellipse cx="75" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#fff" stroke-width="1.5"/>
        <ellipse cx="75" cy="30" rx="4" ry="6" fill="#fff"/>
        <rect x="30" y="50" width="40" height="35" rx="5" fill="white" stroke="#fff" stroke-width="2"/>
        <rect x="38" y="58" width="24" height="18" rx="2" fill="#29B6F6" stroke="#4FC3F7" stroke-width="1"/>
        <circle cx="42" cy="62" r="1.5" fill="#ff4444"/>
        <circle cx="45" cy="62" r="1.5" fill="white"/>
        <circle cx="50" cy="66" r="3" fill="#FFD700"/>
        <ellipse cx="50" cy="70" rx="2" ry="3" fill="#4FC3F7"/>
        <rect x="30" y="82" width="40" height="4" fill="#fff"/>
        <rect x="20" y="55" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
        <rect x="20" y="60" width="12" height="3" fill="#fff"/>
        <rect x="68" y="55" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
        <rect x="68" y="60" width="12" height="3" fill="#fff"/>
        <ellipse cx="26" cy="78" rx="4" ry="5" fill="white" stroke="#fff" stroke-width="1.5"/>
        <ellipse cx="74" cy="78" rx="4" ry="5" fill="white" stroke="#fff" stroke-width="1.5"/>
        <rect x="35" y="88" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
        <rect x="35" y="93" width="12" height="3" fill="#fff"/>
        <rect x="53" y="88" width="12" height="20" rx="3" fill="white" stroke="#fff" stroke-width="1.5"/>
        <rect x="53" y="93" width="12" height="3" fill="#fff"/>
        <ellipse cx="41" cy="110" rx="6" ry="4" fill="white" stroke="#fff" stroke-width="1.5"/>
        <ellipse cx="59" cy="110" rx="6" ry="4" fill="white" stroke="#fff" stroke-width="1.5"/>
      </svg>
    </button>
    
    <script>
      if (typeof chatbot === 'undefined') {
        window.chatbot = {
          isOpen: false,
          messages: [],
          init() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('help') === 'technical') {
              setTimeout(() => {
                this.open();
                this.addBotMessage("Welcome! I see you're looking for technical help. I'm here to assist you with troubleshooting, lesson support, and any questions about the platform. What can I help you with?");
              }, 500);
            }
          },
          open() {
            this.isOpen = true;
            const el = document.getElementById('remo-ai-chatbot');
            const toggle = document.getElementById('chatbot-toggle');
            if (el) el.classList.add('open');
            if (toggle) toggle.classList.add('hidden');
            setTimeout(() => {
              const input = document.getElementById('chatbot-input');
              if (input) input.focus();
            }, 100);
          },
          close() {
            this.isOpen = false;
            const el = document.getElementById('remo-ai-chatbot');
            const toggle = document.getElementById('chatbot-toggle');
            if (el) el.classList.remove('open');
            if (toggle) toggle.classList.remove('hidden');
          },
          addMessage(text, isUser = false, buttons = null) {
            const container = document.getElementById('chatbot-messages');
            if (!container) return;
            const msg = document.createElement('div');
            msg.className = `chatbot-message ${isUser ? 'user' : 'bot'}`;
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            if (isUser) {
              avatar.textContent = 'üë§';
            } else {
              const uniqueId = 'eyeGlow' + Date.now() + Math.random().toString(36).substr(2, 9);
              avatar.innerHTML = `<svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" style="width: 28px; height: 28px;">
                <defs>
                  <radialGradient id="${uniqueId}" cx="50%" cy="50%">
                    <stop offset="0%" stop-color="#4FC3F7" stop-opacity="1"/>
                    <stop offset="100%" stop-color="#29B6F6" stop-opacity="0.8"/>
                  </radialGradient>
                </defs>
                <line x1="50" y1="5" x2="50" y2="15" stroke="#1a1a1a" stroke-width="2"/>
                <circle cx="50" cy="5" r="2" fill="#1a1a1a"/>
                <ellipse cx="50" cy="30" rx="25" ry="20" fill="white" stroke="#1a1a1a" stroke-width="2"/>
                <path d="M 45 20 L 50 25 L 55 20" stroke="#1a1a1a" stroke-width="1.5" fill="none"/>
                <rect x="35" y="25" width="30" height="20" rx="3" fill="#1a1a1a"/>
                <circle cx="42" cy="33" r="4" fill="url(#${uniqueId})"/>
                <circle cx="58" cy="33" r="4" fill="url(#${uniqueId})"/>
                <path d="M 40 40 Q 50 45 60 40" stroke="#4FC3F7" stroke-width="2" fill="none" stroke-linecap="round"/>
                <ellipse cx="25" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#1a1a1a" stroke-width="1.5"/>
                <ellipse cx="25" cy="30" rx="4" ry="6" fill="#1a1a1a"/>
                <ellipse cx="75" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#1a1a1a" stroke-width="1.5"/>
                <ellipse cx="75" cy="30" rx="4" ry="6" fill="#1a1a1a"/>
                <rect x="30" y="50" width="40" height="35" rx="5" fill="white" stroke="#1a1a1a" stroke-width="2"/>
                <rect x="38" y="58" width="24" height="18" rx="2" fill="#29B6F6" stroke="#4FC3F7" stroke-width="1"/>
                <circle cx="42" cy="62" r="1.5" fill="#ff4444"/>
                <circle cx="45" cy="62" r="1.5" fill="white"/>
                <circle cx="50" cy="66" r="3" fill="#FFD700"/>
                <ellipse cx="50" cy="70" rx="2" ry="3" fill="#4FC3F7"/>
                <rect x="30" y="82" width="40" height="4" fill="#1a1a1a"/>
                <rect x="20" y="55" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <rect x="20" y="60" width="12" height="3" fill="#1a1a1a"/>
                <rect x="68" y="55" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <rect x="68" y="60" width="12" height="3" fill="#1a1a1a"/>
                <ellipse cx="26" cy="78" rx="4" ry="5" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <ellipse cx="74" cy="78" rx="4" ry="5" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <rect x="35" y="88" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <rect x="35" y="93" width="12" height="3" fill="#1a1a1a"/>
                <rect x="53" y="88" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <rect x="53" y="93" width="12" height="3" fill="#1a1a1a"/>
                <ellipse cx="41" cy="110" rx="6" ry="4" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
                <ellipse cx="59" cy="110" rx="6" ry="4" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              </svg>`;
            }
            const content = document.createElement('div');
            content.className = 'message-content';
            const textDiv = document.createElement('div');
            textDiv.innerHTML = text.replace(/\n/g, '<br>');
            content.appendChild(textDiv);
            if (buttons && buttons.length > 0 && !isUser) {
              const btnContainer = document.createElement('div');
              btnContainer.className = 'message-buttons';
              buttons.forEach(btn => {
                const b = document.createElement('button');
                b.className = 'message-button';
                b.innerHTML = `<span class="message-button-icon">${btn.icon || 'üìå'}</span><span>${btn.text}</span>`;
                b.onclick = () => {
                  this.addUserMessage(btn.text);
                  if (btn.action) btn.action();
                  else this.processMessage(btn.topic || btn.text.toLowerCase());
                };
                btnContainer.appendChild(b);
              });
              content.appendChild(btnContainer);
            }
            msg.appendChild(avatar);
            msg.appendChild(content);
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            this.messages.push({ text, isUser, buttons, timestamp: new Date() });
          },
          addBotMessage(text, buttons = null) { this.addMessage(text, false, buttons); },
          addUserMessage(text) { this.addMessage(text, true); },
          showTyping() {
            const container = document.getElementById('chatbot-messages');
            if (!container) return;
            const typing = document.createElement('div');
            typing.className = 'chatbot-message bot';
            typing.id = 'typing-indicator';
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            const uniqueIdTyping = 'eyeGlowTyping' + Date.now() + Math.random().toString(36).substr(2, 9);
            avatar.innerHTML = `<svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" style="width: 28px; height: 28px;">
              <defs>
                <radialGradient id="${uniqueIdTyping}" cx="50%" cy="50%">
                  <stop offset="0%" stop-color="#4FC3F7" stop-opacity="1"/>
                  <stop offset="100%" stop-color="#29B6F6" stop-opacity="0.8"/>
                </radialGradient>
              </defs>
              <line x1="50" y1="5" x2="50" y2="15" stroke="#1a1a1a" stroke-width="2"/>
              <circle cx="50" cy="5" r="2" fill="#1a1a1a"/>
              <ellipse cx="50" cy="30" rx="25" ry="20" fill="white" stroke="#1a1a1a" stroke-width="2"/>
              <path d="M 45 20 L 50 25 L 55 20" stroke="#1a1a1a" stroke-width="1.5" fill="none"/>
              <rect x="35" y="25" width="30" height="20" rx="3" fill="#1a1a1a"/>
              <circle cx="42" cy="33" r="4" fill="url(#${uniqueIdTyping})"/>
              <circle cx="58" cy="33" r="4" fill="url(#${uniqueIdTyping})"/>
              <path d="M 40 40 Q 50 45 60 40" stroke="#4FC3F7" stroke-width="2" fill="none" stroke-linecap="round"/>
              <ellipse cx="25" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="25" cy="30" rx="4" ry="6" fill="#1a1a1a"/>
              <ellipse cx="75" cy="30" rx="8" ry="12" fill="#29B6F6" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="75" cy="30" rx="4" ry="6" fill="#1a1a1a"/>
              <rect x="30" y="50" width="40" height="35" rx="5" fill="white" stroke="#1a1a1a" stroke-width="2"/>
              <rect x="38" y="58" width="24" height="18" rx="2" fill="#29B6F6" stroke="#4FC3F7" stroke-width="1"/>
              <circle cx="42" cy="62" r="1.5" fill="#ff4444"/>
              <circle cx="45" cy="62" r="1.5" fill="white"/>
              <circle cx="50" cy="66" r="3" fill="#FFD700"/>
              <ellipse cx="50" cy="70" rx="2" ry="3" fill="#4FC3F7"/>
              <rect x="30" y="82" width="40" height="4" fill="#1a1a1a"/>
              <rect x="20" y="55" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="20" y="60" width="12" height="3" fill="#1a1a1a"/>
              <rect x="68" y="55" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="68" y="60" width="12" height="3" fill="#1a1a1a"/>
              <ellipse cx="26" cy="78" rx="4" ry="5" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="74" cy="78" rx="4" ry="5" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="35" y="88" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="35" y="93" width="12" height="3" fill="#1a1a1a"/>
              <rect x="53" y="88" width="12" height="20" rx="3" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <rect x="53" y="93" width="12" height="3" fill="#1a1a1a"/>
              <ellipse cx="41" cy="110" rx="6" ry="4" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
              <ellipse cx="59" cy="110" rx="6" ry="4" fill="white" stroke="#1a1a1a" stroke-width="1.5"/>
            </svg>`;
            const content = document.createElement('div');
            content.className = 'message-content typing-indicator';
            content.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            typing.appendChild(avatar);
            typing.appendChild(content);
            container.appendChild(typing);
            container.scrollTop = container.scrollHeight;
          },
          hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
          },
          async processMessage(userMessage) {
            const lower = userMessage.toLowerCase();
            this.showTyping();
            await new Promise(r => setTimeout(r, 1000));
            this.hideTyping();
            if (lower.includes('tour') || lower.includes('guide')) {
              this.addBotMessage("Great! I'll start the interactive tour for you.");
              setTimeout(() => { if (typeof teacherTour !== 'undefined') teacherTour.startTour(); }, 500);
            } else if (lower.includes('lesson material') || lower.includes('finding lesson')) {
              this.addBotMessage("Here's how to find lesson materials:\n\n**Step 1: Access Lessons Library**\n‚Ä¢ Click 'Lessons Library' in sidebar\n‚Ä¢ Or go to: teacher-lessons-library.html\n\n**Step 2: Browse Materials**\n‚Ä¢ Filter by subject, level, or keywords\n‚Ä¢ Preview before downloading\n\n**Step 3: Create Your Own**\n‚Ä¢ Click 'Create Lesson'\n‚Ä¢ Upload files or create content\n\nWould you like me to take you there?", [
                { text: "Open Lessons Library", icon: "üìö", action: () => window.location.href = 'teacher-lessons-library.html' },
                { text: "How to Create a Lesson", icon: "‚ûï", topic: "create lesson" }
              ]);
            } else if (lower.includes('lesson structure') || lower.includes('lesson format')) {
              this.addBotMessage("**Standard Lesson Structure (50-60 min):**\n\n1Ô∏è‚É£ **Warm-up (5-10 min)** - Engage students\n2Ô∏è‚É£ **Introduction (5-10 min)** - Present objectives\n3Ô∏è‚É£ **Practice (15-20 min)** - Interactive exercises\n4Ô∏è‚É£ **Production (10-15 min)** - Apply learning\n5Ô∏è‚É£ **Wrap-up (5 min)** - Review and homework\n\n**Tips:** Keep it interactive, use multimedia!");
            } else if (lower.includes('teaching tip') || lower.includes('effective teaching')) {
              this.addBotMessage("**Top Tips for Online Teaching:**\n\nüéØ **Engagement**: Use polls, games, breakout rooms\nüí¨ **Communication**: Speak clearly, use visuals\n‚è∞ **Time Management**: Plan with time allocations\nüë• **Interaction**: Encourage participation, give feedback\nüîß **Technical**: Test equipment, have backup plans\n\nRemember: Adaptability and creativity are key!");
            } else if (lower.includes('create lesson')) {
              this.addBotMessage("**How to Create a Lesson:**\n\n1. Go to Lessons Library\n2. Click 'Create Lesson'\n3. Fill in details (title, subject, level)\n4. Upload materials or create content\n5. Save and organize\n\nReady to create?", [
                { text: "Go to Lessons Library", icon: "üìö", action: () => window.location.href = 'teacher-lessons-library.html' }
              ]);
            } else if (lower.includes('internet connection') || lower.includes('connection issue')) {
              this.addBotMessage("**Internet Connection Troubleshooting:**\n\n1. Check Wi-Fi signal strength\n2. Restart router (unplug 30 sec)\n3. Test speed at speedtest.net\n4. Use wired connection if possible\n5. Close bandwidth-heavy apps\n\nIf problems persist, contact your ISP.");
            } else if (lower.includes('camera') || lower.includes('microphone') || lower.includes('mic')) {
              this.addBotMessage("**Camera/Microphone Fixes:**\n\n1. Check browser permissions\n2. Make sure no other app is using devices\n3. Test in Device Check section\n4. Refresh page and allow permissions\n5. Update browser\n\nNeed to test devices?", [
                { text: "Go to Device Check", icon: "üîç", action: () => window.location.href = 'device-check.html' }
              ]);
            } else if (lower.includes('browser') || lower.includes('compatibility')) {
              this.addBotMessage("**Browser Compatibility:**\n\n‚úÖ **Recommended**: Chrome, Firefox, Edge (latest)\n\n**Fixes:**\n1. Update browser\n2. Clear cache (Ctrl+Shift+Delete)\n3. Disable extensions\n4. Try incognito mode\n\nIf issues persist, try a different browser.");
            } else if (lower.includes('platform error') || lower.includes('error message')) {
              this.addBotMessage("**Platform Error Fixes:**\n\n1. Refresh page (F5 or Ctrl+R)\n2. Clear browser cache\n3. Check internet connection\n4. Try different browser\n\n**If error persists:**\nüì∏ Take screenshot\nüìù Note what you were doing\nüìß Contact support@remoedph.com", [
                { text: "Contact Support", icon: "üìß", action: () => {
                  this.addBotMessage("**Contact Support:**\n\nüìß Email: support@remoedph.com\n\nPlease include:\n‚Ä¢ Screenshot of error\n‚Ä¢ What you were doing\n‚Ä¢ Browser and OS info");
                }}
              ]);
            } else if (lower.includes('troubleshoot') || lower.includes('problem') || lower.includes('issue')) {
              this.addBotMessage("I can help with troubleshooting! What specific issue?", [
                { text: "Internet Connection", icon: "üåê", topic: "internet connection" },
                { text: "Camera/Microphone", icon: "üé•", topic: "camera microphone" },
                { text: "Browser Issues", icon: "üåè", topic: "browser compatibility" },
                { text: "Platform Errors", icon: "‚ö†Ô∏è", topic: "platform errors" },
                { text: "Contact Support", icon: "üìß", action: () => {
                  this.addBotMessage("üìß Email: support@remoedph.com\n\nPlease provide details about your problem.");
                }}
              ]);
            } else if (lower.includes('lesson') || lower.includes('teaching')) {
              this.addBotMessage("I can help with lesson support! What do you need?", [
                { text: "Finding Lesson Materials", icon: "üìö", topic: "finding lesson materials" },
                { text: "Lesson Structure", icon: "üìã", topic: "lesson structure and format" },
                { text: "Teaching Tips", icon: "üí°", topic: "teaching tips" },
                { text: "Go to Lessons Library", icon: "üìñ", action: () => window.location.href = 'teacher-lessons-library.html' }
              ]);
            } else if (lower.includes('set reminder') || lower.includes('reminder')) {
              this.addBotMessage("**How to Set Reminders:**\n\n**Method 1**: Dashboard > Upcoming Classes > Set reminder\n**Method 2**: Class Schedule > Click class > Enable reminder\n**Method 3**: Allow browser notifications\n\n**Tips**: Set 15-30 min before class", [
                { text: "View Schedule", icon: "üìÖ", action: () => window.location.href = 'teacher-class-table.html' }
              ]);
            } else if (lower.includes('booking') || lower.includes('accept booking')) {
              this.addBotMessage("**Booking Guide:**\n\n1. Students book your time slots\n2. You receive notifications\n3. Accept/decline in Class Schedule\n4. Prepare materials and set reminders\n\n**Manage Availability**: Go to Class Configuration", [
                { text: "View Bookings", icon: "üìã", action: () => window.location.href = 'teacher-class-table.html' },
                { text: "Class Configuration", icon: "‚öôÔ∏è", action: () => window.location.href = 'teacher-open-class.html' }
              ]);
            } else if (lower.includes('schedule') || lower.includes('class time')) {
              this.addBotMessage("I can help with schedule questions! What do you need?", [
                { text: "View My Schedule", icon: "üìÖ", action: () => window.location.href = 'teacher-class-table.html' },
                { text: "Set Reminders", icon: "üîî", topic: "set reminders" },
                { text: "Manage Availability", icon: "‚öôÔ∏è", action: () => window.location.href = 'teacher-open-class.html' },
                { text: "Booking Questions", icon: "‚ùì", topic: "booking questions" }
              ]);
            } else if (lower.includes('hello') || lower.includes('hi') || lower.includes('hey')) {
              this.addBotMessage("Hello! üëã I'm Remo AI Assistant. I can help with:\n\n‚Ä¢ Troubleshooting\n‚Ä¢ Lesson support\n‚Ä¢ Platform navigation\n‚Ä¢ Starting tours\n\nWhat would you like help with?");
            } else if (lower.includes('help') || lower.includes('support')) {
              this.addBotMessage("I'm here to help! You can:\n\n‚Ä¢ Ask questions about the platform\n‚Ä¢ Click 'Start Tour' for guidance\n‚Ä¢ Use quick action buttons\n‚Ä¢ Contact support@remoedph.com\n\nWhat specific help do you need?");
            } else {
              this.addBotMessage("I understand you're asking about: \"" + userMessage + "\"\n\nI can help you with:", [
                { text: "Troubleshooting", icon: "üîß", topic: "troubleshooting" },
                { text: "Lesson Support", icon: "üìö", topic: "lesson support" },
                { text: "Schedule Help", icon: "üìÖ", topic: "schedule" },
                { text: "Start Tour", icon: "üéØ", action: () => {
                  this.addBotMessage("Great! Starting tour...");
                  setTimeout(() => { if (typeof teacherTour !== 'undefined') teacherTour.startTour(); }, 500);
                }}
              ]);
            }
          }
        };
        
        window.toggleChatbot = function() {
          if (window.chatbot.isOpen) window.chatbot.close();
          else window.chatbot.open();
        };
        
        window.sendChatbotMessage = function() {
          const input = document.getElementById('chatbot-input');
          const message = input ? input.value.trim() : '';
          if (message) {
            window.chatbot.addUserMessage(message);
            if (input) input.value = '';
            window.chatbot.processMessage(message);
          }
        };
        
        window.handleChatbotKeyPress = function(event) {
          if (event.key === 'Enter') window.sendChatbotMessage();
        };
        
        window.handleQuickAction = function(action) {
          switch(action) {
            case 'tour':
              window.chatbot.addUserMessage("Start the tour");
              window.chatbot.addBotMessage("Great! Starting tour...");
              setTimeout(() => { if (typeof teacherTour !== 'undefined') teacherTour.startTour(); }, 500);
              break;
            case 'troubleshooting':
              window.chatbot.addUserMessage("I need troubleshooting help");
              window.chatbot.processMessage("troubleshooting");
              break;
            case 'lessons':
              window.chatbot.addUserMessage("I need lesson support");
              window.chatbot.processMessage("lesson support");
              break;
            case 'schedule':
              window.chatbot.addUserMessage("I need schedule help");
              window.chatbot.processMessage("schedule");
              break;
          }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
          if (window.chatbot) window.chatbot.init();
        });
      }
    </script>
</body>
</html>
