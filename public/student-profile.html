<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë§ My Profile - RemoEdPH</title>
    <link rel="stylesheet" href="modern-styles.css">
    <link rel="stylesheet" href="child-friendly-styles.css">
    <style>
        body { 
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #FFF0F5 0%, #E8F8F5 50%, #FFF9E6 100%);
            background-attachment: fixed;
            margin: 0;
            padding: 0;
        }
        
        .remoed-main { 
            display: flex; 
            min-height: 100vh; 
        }
        .remoed-sidebar { 
            width: 260px; 
            min-width: 260px;
            background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%); 
            box-shadow: 4px 0 20px rgba(102, 126, 234, 0.1); 
            padding: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: stretch;
            position: fixed;
            height: 100vh;
            z-index: 100;
            border-right: 1px solid rgba(102, 126, 234, 0.1);
        }
        .remoed-logo { 
            display: flex; 
            align-items: center; 
            gap: 14px; 
        }
        .remoed-logo img { 
            height: 48px; 
        }
        .remoed-title { 
            font-size: 1.7rem; 
            font-weight: 700; 
            color: #667eea; 
            letter-spacing: 1px; 
        }
        .remoed-user { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .remoed-avatar { 
            width: 72px; 
            height: 72px; 
            border-radius: 50%; 
            background: #667eea; 
            color: #fff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 2.2rem; 
        }
        .remoed-username { 
            color: #667eea; 
            font-weight: 600; 
        }
        .remoed-menu { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
        }
        .remoed-menu li { 
            padding: 14px 32px; 
            color: #667eea; 
            font-weight: 500; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            border-left: 4px solid transparent; 
            transition: background 0.2s, border-color 0.2s; 
        }
            .remoed-menu li.active, .remoed-menu li:hover { 
      background: linear-gradient(90deg, #667eea 0%, #5a67d8 100%); 
      border-left: 4px solid #667eea; 
      color: white; 
      transform: translateX(4px);
      transition: all 0.3s ease;
    }
        .remoed-menu svg { 
            width: 20px; 
            height: 20px; 
            stroke: currentColor;
        }
        .remoed-content { 
            flex: 1; 
            padding: 24px 32px; 
            margin-left: 260px;
            max-width: calc(100vw - 260px);
            background: #F0F2F5;
        }
        
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Facebook-style Profile Header */
        .profile-header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .profile-avatar-large {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1CA7E7, #5CB3FF);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            border: 6px solid #FFD700;
            box-shadow: 0 8px 24px rgba(28, 167, 231, 0.3);
        }
        
        .profile-avatar-large:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(28, 167, 231, 0.4);
        }
        
        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .upload-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .profile-avatar-large:hover .upload-overlay {
            transform: translateY(0);
        }
        
        .profile-header-info {
            flex: 1;
        }
        
        .profile-name-large {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1CA7E7;
            margin: 0 0 8px 0;
            text-shadow: 2px 2px 4px rgba(28, 167, 231, 0.2);
        }
        
        .profile-email-large {
            color: #4A6FA5;
            margin: 0 0 16px 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .profile-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #1CA7E7, #5CB3FF);
            color: white;
            border: 2px solid #FFD700;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(28, 167, 231, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(28, 167, 231, 0.4);
        }
        
        /* Profile Content Grid - Facebook Style */
        .profile-content-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
        }
        
        .profile-sidebar-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 24px;
        }
        
        .profile-main-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1CA7E7;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid #FFD700;
        }
        
        .info-section {
            margin-bottom: 32px;
        }
        
        .info-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1E3A5F;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #1E3A5F;
            font-size: 0.95rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 3px solid #E8F4FD;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #1CA7E7;
            box-shadow: 0 0 0 4px rgba(28, 167, 231, 0.1);
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 3px solid #E8F4FD;
            border-radius: 12px;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #1CA7E7;
            box-shadow: 0 0 0 4px rgba(28, 167, 231, 0.1);
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: block;
            padding: 16px;
            border: 3px dashed #1CA7E7;
            border-radius: 12px;
            text-align: center;
            color: #1CA7E7;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: #F0F8FF;
            cursor: pointer;
        }
        
        .file-upload:hover .file-upload-label {
            background: linear-gradient(135deg, #E8F4FD, #FFFBF0);
            border-color: #FFD700;
            transform: scale(1.02);
        }
        
        .save-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: 2px solid #2E7D32;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .save-btn:disabled {
            background: #ccc;
            border-color: #999;
            cursor: not-allowed;
            transform: none;
        }
        
        .edit-btn {
            background: linear-gradient(135deg, #1CA7E7, #5CB3FF);
            color: white;
            border: 2px solid #FFD700;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(28, 167, 231, 0.3);
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
        }
        
        .edit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(28, 167, 231, 0.4);
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: 2px solid #495057;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
        }
        
        .cancel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        .form-input:disabled, .form-textarea:disabled, .form-input[readonly], .form-textarea[readonly] {
            background-color: #f8f9fa;
            color: #495057;
            cursor: not-allowed;
        }
        
        .file-upload.disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .education-item {
            background: #F8F9FA;
            border: 3px solid #E8F4FD;
            border-left: 4px solid #1CA7E7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .education-item:hover {
            border-color: #FFD700;
            box-shadow: 0 4px 12px rgba(28, 167, 231, 0.15);
        }
        
        .education-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .education-header span {
            font-weight: 800;
            font-size: 1.1rem;
            color: #1CA7E7;
        }
        
        .remove-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .remove-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .add-btn {
            background: linear-gradient(135deg, #1CA7E7, #5CB3FF);
            color: white;
            border: 2px solid #FFD700;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(28, 167, 231, 0.3);
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(28, 167, 231, 0.4);
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .tab-container {
            margin-bottom: 0;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 3px solid #E8F4FD;
            margin-bottom: 32px;
            gap: 8px;
        }
        
        .tab-btn {
            background: none;
            border: none;
            padding: 16px 24px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            color: #4A6FA5;
            border-bottom: 4px solid transparent;
            transition: all 0.3s ease;
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', 'Segoe UI', sans-serif;
            position: relative;
            top: 3px;
        }
        
        .tab-btn.active {
            color: #1CA7E7;
            border-bottom-color: #1CA7E7;
        }
        
        .tab-btn:hover {
            color: #1CA7E7;
            background: #F0F8FF;
            border-radius: 12px 12px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Info Cards - Facebook Style */
        .info-card {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #1CA7E7;
        }
        
        .info-row {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #E8F4FD;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 700;
            color: #1E3A5F;
            min-width: 180px;
            font-size: 0.95rem;
        }
        
        .info-value {
            color: #4A6FA5;
            font-size: 1rem;
            flex: 1;
        }
        
        .info-value.empty {
            color: #999;
            font-style: italic;
        }
        
        .document-preview {
            max-width: 100%;
            max-height: 200px;
            border: 3px solid #E8F4FD;
            border-radius: 12px;
            margin-top: 12px;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .document-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .profile-content-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-sidebar-card {
                position: static;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar-large {
                width: 120px;
                height: 120px;
            }
            
            .profile-name-large {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="remoed-main">
        <nav class="remoed-sidebar">
            <div class="remoed-logo" style="height:100px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding-top:24px;">
                <img src="remoed-logo.png" alt="RemoEdPH Logo" style="height:40px; width:auto; display:inline-block; vertical-align:middle;">
                <span class="remoed-title" style="font-size:1.4rem; font-weight:800; color:#1CA7E7; letter-spacing:1px; text-shadow: 2px 2px 4px rgba(28, 167, 231, 0.2);">RemoEdPH</span>
            </div>
            <div class="remoed-user" style="display:flex; flex-direction:column; align-items:center; margin-bottom:24px;">
                <div class="remoed-avatar" id="sidebar-avatar" style="position: relative; overflow: hidden;">
                    <img id="profile-image" src="" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: none;">
                    <span id="avatar-text">S</span>
                </div>
                <span class="remoed-username" id="sidebar-email">student@remoedph.com</span>
            </div>
            <ul class="remoed-menu">
                <li onclick="window.location.href='student-dashboard.html'">üè† <span>My Home</span></li>
                <li onclick="window.location.href='student-class-table.html'">üìÖ <span>My Schedule</span></li>
                <li onclick="window.location.href='student-book.html'">‚ûï <span>Book a Class</span></li>
                <li onclick="window.location.href='student-booking-history.html'">üìú <span>My Classes</span></li>
                <li onclick="window.location.href='student-games-activities.html'">üéÆ <span>Play & Learn</span></li>
                <li class="active">üë§ <span>My Profile</span></li>
                <li onclick="window.location.href='student-assessment.html'">üéØ <span>My Level</span></li>
                <li id="logout-nav" style="margin-top:auto; color:#e74c3c; cursor:pointer;">üö™ <span>Exit</span></li>
            </ul>
        </nav>
        <div class="remoed-content">
            <div class="profile-container">
                <!-- Facebook-style Profile Header -->
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profile-avatar">
                        <img id="profile-avatar-img" src="" alt="Profile Avatar" style="width:100%; height:100%; object-fit:cover; border-radius:50%; display:none;">
                        <span id="profile-avatar-text" style="font-size:4rem; font-weight:bold; color:#fff; display:inline-block;">S</span>
                        <div class="upload-overlay">üì∏ Click to upload</div>
                    </div>
                    <div class="profile-header-info">
                        <h1 class="profile-name-large" id="profile-name">Student Name</h1>
                        <p class="profile-email-large" id="profile-email">student@email.com</p>
                        <div class="profile-actions">
                            <button class="back-btn" onclick="goBack()">‚Üê Back to Dashboard</button>
                            <button class="edit-btn" id="edit-btn" onclick="enableEditing()">‚úèÔ∏è Edit Profile</button>
                            <button class="cancel-btn" id="cancel-btn" onclick="cancelEditing()" style="display: none;">‚ùå Cancel</button>
                            <button class="save-btn" id="save-btn" onclick="saveProfile()" style="display: none;">üíæ Save Changes</button>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Content Grid -->
                <div class="profile-content-grid">
                    <!-- Profile Sidebar Card -->
                    <div class="profile-sidebar-card">
                        <h3 class="section-title" style="font-size: 1.3rem; margin-bottom: 20px;">üìã Quick Info</h3>
                        <div class="info-card">
                            <div class="info-row">
                                <span class="info-label">üìß Email:</span>
                                <span class="info-value" id="sidebar-email-display">student@email.com</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">üìû Contact:</span>
                                <span class="info-value" id="sidebar-contact-display">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">üéÇ Birthday:</span>
                                <span class="info-value" id="sidebar-birthday-display">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">üìç Location:</span>
                                <span class="info-value" id="sidebar-location-display">-</span>
                            </div>
                        </div>
                    </div>
            
            <!-- Profile Main Content -->
            <div class="profile-main-card">
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="showTab('personal')">Personal Information</button>
                        <button class="tab-btn" onclick="showTab('education')">Education</button>
                        <button class="tab-btn" onclick="showTab('documents')">Documents</button>
                        <button class="tab-btn" onclick="showTab('settings')">Settings</button>
                    </div>
                    
                    <!-- Personal Information Tab -->
                    <div id="personal" class="tab-content active">
                        <!-- Basic Information Section -->
                        <div class="info-section">
                            <h4 class="info-section-title">üë§ Basic Information</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-input" id="firstName" placeholder="First Name" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Middle Name</label>
                                    <input type="text" class="form-input" id="middleName" placeholder="Middle Name" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-input" id="lastName" placeholder="Last Name" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Gender</label>
                                    <select class="form-input" id="gender" disabled>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üéÇ Birthday</label>
                                    <input type="date" class="form-input" id="birthday" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Age</label>
                                    <input type="number" class="form-input" id="age" placeholder="Age" min="1" max="100" disabled>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Information Section -->
                        <div class="info-section">
                            <h4 class="info-section-title">üìû Contact Information</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">üìß Email</label>
                                    <input type="email" class="form-input" id="email" placeholder="Email" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üì± Contact Number</label>
                                    <input type="tel" class="form-input" id="contact" placeholder="Contact Number" disabled>
                                </div>
                                <div class="form-group full-width">
                                    <label class="form-label">üìç Address</label>
                                    <textarea class="form-textarea" id="address" placeholder="Complete Address" disabled></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- About Section -->
                        <div class="info-section">
                            <h4 class="info-section-title">üí¨ About Me</h4>
                            <div class="form-group full-width">
                                <textarea class="form-textarea" id="aboutMe" placeholder="Tell us about yourself, your interests, and learning goals..." disabled style="min-height: 150px;"></textarea>
                            </div>
                        </div>
                        
                        <!-- Interests Section -->
                        <div class="info-section">
                            <h4 class="info-section-title">üé® Interests & Hobbies</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">üó£Ô∏è Language</label>
                                    <input type="text" class="form-input" id="language" placeholder="Primary Language" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üéØ Hobbies</label>
                                    <input type="text" class="form-input" id="hobbies" placeholder="Hobbies" disabled>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Family & Emergency Contact Section -->
                        <div class="info-section">
                            <h4 class="info-section-title">üë®‚Äçüë©‚Äçüëß Family & Emergency Contact</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">üë®‚Äçüë©‚Äçüëß Parent/Guardian Name</label>
                                    <input type="text" class="form-input" id="parentName" placeholder="Parent/Guardian Name" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üìû Parent/Guardian Contact</label>
                                    <input type="tel" class="form-input" id="parentContact" placeholder="Parent/Guardian Contact" disabled>
                                </div>
                                <div class="form-group full-width">
                                    <label class="form-label">üö® Emergency Contact</label>
                                    <textarea class="form-textarea" id="emergencyContact" placeholder="Emergency Contact Information" disabled></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Education Tab -->
                    <div id="education" class="tab-content">
                        <div class="info-section">
                            <h4 class="info-section-title">üéì Education History</h4>
                            <div id="education-list">
                                <!-- Education items will be added here dynamically -->
                            </div>
                            <button class="add-btn" id="add-education-btn" onclick="addEducationItem()" disabled style="padding: 12px 24px; font-size: 1rem; border-radius: 12px; margin-top: 16px;">‚ûï Add Education</button>
                        </div>
                    </div>
                    
                    <!-- Documents Tab -->
                    <div id="documents" class="tab-content">
                        <div class="info-section">
                            <h4 class="info-section-title">üìÑ Documents & Certificates</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">üì∏ Profile Picture</label>
                                    <div class="file-upload" id="profile-picture-upload">
                                        <input type="file" id="profilePicture" accept="image/*" onchange="previewImage(this, 'profile-preview')" disabled>
                                        <label class="file-upload-label">üì§ Upload Profile Picture</label>
                                    </div>
                                    <img id="profile-preview" class="document-preview">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üÜî Student ID</label>
                                    <div class="file-upload" id="student-id-upload">
                                        <input type="file" id="studentId" accept="image/*,.pdf" onchange="previewImage(this, 'student-id-preview')" disabled>
                                        <label class="file-upload-label">üì§ Upload Student ID</label>
                                    </div>
                                    <img id="student-id-preview" class="document-preview">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üìú Birth Certificate</label>
                                    <div class="file-upload" id="birth-cert-upload">
                                        <input type="file" id="birthCertificate" accept="image/*,.pdf" onchange="previewImage(this, 'birth-cert-preview')" disabled>
                                        <label class="file-upload-label">üì§ Upload Birth Certificate</label>
                                    </div>
                                    <img id="birth-cert-preview" class="document-preview">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üìö Academic Records</label>
                                    <div class="file-upload" id="academic-upload">
                                        <input type="file" id="academicRecords" accept="image/*,.pdf" onchange="previewImage(this, 'academic-preview')" disabled>
                                        <label class="file-upload-label">üì§ Upload Academic Records</label>
                                    </div>
                                    <img id="academic-preview" class="document-preview">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üèÜ Certificates</label>
                                    <div class="file-upload" id="certificates-upload">
                                        <input type="file" id="certificates" accept="image/*,.pdf" onchange="previewImage(this, 'certificates-preview')" disabled>
                                        <label class="file-upload-label">üì§ Upload Certificates</label>
                                    </div>
                                    <img id="certificates-preview" class="document-preview">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Tab -->
                    <div id="settings" class="tab-content">
                        <div class="info-section">
                            <h4 class="info-section-title">‚öôÔ∏è Account Settings</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">üìß Current Email</label>
                                    <input type="email" class="form-input" id="current-email" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üìß New Email</label>
                                    <input type="email" class="form-input" id="new-email" placeholder="Enter new email address">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üë§ Current Username</label>
                                    <input type="text" class="form-input" id="current-username" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üë§ New Username</label>
                                    <input type="text" class="form-input" id="new-username" placeholder="Enter new username">
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-section">
                            <h4 class="info-section-title">üîê Change Password</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">üîë Current Password</label>
                                    <input type="password" class="form-input" id="current-password" placeholder="Enter current password">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üîë New Password</label>
                                    <input type="password" class="form-input" id="new-password" placeholder="Enter new password">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">üîë Confirm New Password</label>
                                    <input type="password" class="form-input" id="confirm-password" placeholder="Confirm new password">
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap;">
                            <button class="save-btn" onclick="updateSettings()">üíæ Update Settings</button>
                            <button class="cancel-btn" onclick="resetSettingsForm()">üîÑ Reset Form</button>
                            <button class="edit-btn" onclick="goToForgotPassword()">üîì Forgot Password</button>
                        </div>
                    </div>
                </div>
                
                <div class="success-message" id="success-message" style="display: none; padding: 16px 24px; border-radius: 12px; margin-bottom: 24px; font-weight: 600;">
                    Profile updated successfully!
                </div>
            </div>
        </div>
        </div>

    <script src="avatar-helper.js"></script>
    <script>
        // Role-based access control
        const userType = localStorage.getItem('userType');
        if (userType !== 'student') {
            alert('Access denied. This page is for students only.');
            window.location.href = 'index.html';
        }

        // Initialize profile
        document.addEventListener('DOMContentLoaded', function() {
            // Set sidebar avatar and email
            const username = localStorage.getItem('remoedUsername') || 'Student';
            const studentId = localStorage.getItem('studentId');
            
            // Set sidebar avatar initial (keep img and text elements intact)
            const sidebarImg = document.getElementById('profile-image');
            const sidebarText = document.getElementById('avatar-text');
            if (sidebarImg && sidebarText) {
                sidebarImg.style.display = 'none';
                sidebarText.style.display = 'inline-block';
                sidebarText.textContent = username[0].toUpperCase();
            }
            document.getElementById('sidebar-email').textContent = username;
            
            // Load profile picture if available
            if (studentId) {
                loadProfilePicture(studentId);
            }
            
            // Logout functionality
            document.getElementById('logout-nav').onclick = function() {
                localStorage.clear();
                window.location.href = 'student-login.html';
            };
            
            updateProfileDisplay();
            loadProfile();
            loadSettingsData();
            setupProfilePictureUpload();
            addSafeContentBadge();
        });
        
        // Safe Content Badge
        function addSafeContentBadge() {
            if (!document.getElementById('safe-content-badge')) {
                const badge = document.createElement('div');
                badge.id = 'safe-content-badge';
                badge.className = 'safe-content-badge';
                badge.innerHTML = 'üõ°Ô∏è Safe & Friendly Content';
                document.body.appendChild(badge);
                setTimeout(() => {
                    badge.style.display = 'flex';
                }, 1000);
            }
        }
        
    // Load profile picture from backend (uses shared setAvatar)
    async function loadProfilePicture(studentId) {
        try {
            const token = localStorage.getItem('token');
            if (!token) {
                console.log('üîç No token found for profile picture');
                return;
            }

            const username = localStorage.getItem('remoedUsername') || 'Student';
            console.log('üîç Loading profile picture for studentId:', studentId);

            // Add timeout to prevent hanging
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout

            const response = await fetch(`/api/student/profile`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                },
                signal: controller.signal
            });

            clearTimeout(timeoutId);

            if (response.ok) {
                const data = await response.json();
                const profilePic = data && data.profile && data.profile.profilePicture ? data.profile.profilePicture : '';
                // Use shared helper to set sidebar avatar
                try {
                    setAvatar({ imageUrl: profilePic, displayName: username, imgSelector: '#profile-image', textSelector: '#avatar-text' });
                } catch (e) {
                    console.error('setAvatar failed for sidebar', e);
                }
            } else {
                console.log('‚ùå Failed to load profile data for picture (status ' + response.status + ')');
                try {
                    setAvatar({ imageUrl: '', displayName: username, imgSelector: '#profile-image', textSelector: '#avatar-text' });
                } catch (e) {
                    console.error('setAvatar error', e);
                }
            }
        } catch (error) {
            console.error('‚ùå Error loading profile picture:', error);
            try {
                setAvatar({ imageUrl: '', displayName: localStorage.getItem('remoedUsername') || 'S', imgSelector: '#profile-image', textSelector: '#avatar-text' });
            } catch (e) {
                console.error('setAvatar error', e);
            }
        }
    }

        function updateProfileDisplay() {
            const username = localStorage.getItem('remoedUsername') || 'Student';
            document.getElementById('profile-name').textContent = username;
            document.getElementById('profile-email').textContent = username;
            
            // Update sidebar quick info
            const email = document.getElementById('email')?.value || username;
            const contact = document.getElementById('contact')?.value || '-';
            const birthday = document.getElementById('birthday')?.value || '-';
            const address = document.getElementById('address')?.value || '-';
            
            document.getElementById('sidebar-email-display').textContent = email;
            document.getElementById('sidebar-contact-display').textContent = contact !== '-' ? contact : '-';
            document.getElementById('sidebar-birthday-display').textContent = birthday !== '-' ? new Date(birthday).toLocaleDateString() : '-';
            document.getElementById('sidebar-location-display').textContent = address !== '' ? (address.length > 30 ? address.substring(0, 30) + '...' : address) : '-';
            
            // Main profile avatar: set initial text and hide image (use helper for consistency)
            try {
                setAvatar({ imageUrl: '', displayName: username, imgSelector: '#profile-avatar-img', textSelector: '#profile-avatar-text' });
            } catch (e) {
                console.error('setAvatar error for main avatar', e);
            }
        }

        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function addEducationItem() {
            const educationList = document.getElementById('education-list');
            const educationItem = document.createElement('div');
            educationItem.className = 'education-item';
            
            // Check if editing is enabled
            const isEditing = document.getElementById('save-btn').style.display !== 'none';
            
                    educationItem.innerHTML = `
                        <div class="education-header">
                            <span>üéì Education ${educationList.children.length + 1}</span>
                            <button class="remove-btn" onclick="removeEducationItem(this)">üóëÔ∏è Remove</button>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">üè´ School Name</label>
                                <input type="text" class="form-input" placeholder="School Name" ${!isEditing ? 'disabled' : ''}>
                            </div>
                            <div class="form-group">
                                <label class="form-label">üìö Level</label>
                                <select class="form-input" ${!isEditing ? 'disabled' : ''}>
                                    <option value="">Select Level</option>
                                    <option value="nursery">üå± Nursery</option>
                                    <option value="kindergarten">üåü Kindergarten</option>
                                    <option value="primary">üìñ Primary</option>
                                    <option value="secondary">üéì Secondary</option>
                                    <option value="college">üèõÔ∏è College</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">üìÖ Year Started</label>
                                <input type="number" class="form-input" placeholder="Year Started" min="1900" max="2030" ${!isEditing ? 'disabled' : ''}>
                            </div>
                            <div class="form-group">
                                <label class="form-label">üìÖ Year Ended</label>
                                <input type="number" class="form-input" placeholder="Year Ended" min="1900" max="2030" ${!isEditing ? 'disabled' : ''}>
                            </div>
                        </div>
                    `;
            educationList.appendChild(educationItem);
        }

        function removeEducationItem(button) {
            button.closest('.education-item').remove();
        }

        function setupProfilePictureUpload() {
            const avatar = document.getElementById('profile-avatar');
            const fileInput = document.getElementById('profilePicture');
            if (!avatar || !fileInput) return;

            // Only open the file picker when editing is enabled.
            avatar.addEventListener('click', () => {
                const isEditing = document.getElementById('save-btn').style.display !== 'none';
                if (!isEditing) {
                    alert('Click "Edit Profile" to upload a new profile picture.');
                    return;
                }
                // Ensure input is enabled before clicking
                fileInput.disabled = false;
                fileInput.click();
            });

            // When a file is selected, preview it immediately in the avatar and sidebar
            fileInput.addEventListener('change', function() {
                const file = this.files && this.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(e) {
                    const dataUrl = e.target.result;

                    // Main profile avatar
                    const mainImg = document.getElementById('profile-avatar-img');
                    const mainText = document.getElementById('profile-avatar-text');
                    if (mainImg) {
                        mainImg.src = dataUrl;
                        mainImg.style.display = 'block';
                    }
                    if (mainText) mainText.style.display = 'none';

                    // Sidebar avatar
                    const sidebarImg = document.getElementById('profile-image');
                    const sidebarText = document.getElementById('avatar-text');
                    if (sidebarImg) {
                        sidebarImg.src = dataUrl;
                        sidebarImg.style.display = 'block';
                    }
                    if (sidebarText) sidebarText.style.display = 'none';

                    // Document preview (if present)
                    const preview = document.getElementById('profile-preview');
                    if (preview) {
                        preview.src = dataUrl;
                        preview.style.display = 'block';
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

                async function loadProfile() {
            try {
                const token = localStorage.getItem('token');
                const username = localStorage.getItem('remoedUsername') || 'Student';
                const studentId = localStorage.getItem('studentId');
                
                console.log('üîç Loading profile with token:', token ? 'Token exists' : 'No token');
                console.log('üîç Username from localStorage:', username);
                console.log('üîç Student ID from localStorage:', studentId);
                
                if (!token) {
                    console.log('‚ùå No token found - cannot load profile');
                    showSuccessMessage('Please log in to view your profile.', 'error');
                    return;
                }
                
                // Add timeout to prevent hanging
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout
                
                // Try multiple API endpoints
                let response;
                let profileData;
                
                // First try: /api/student/profile
                try {
                    console.log('üîç Trying /api/student/profile endpoint...');
                    response = await fetch(`/api/student/profile`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        },
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    console.log('üîç Profile response status:', response.status);
                    
                    if (response.ok) {
                        profileData = await response.json();
                        console.log('‚úÖ Profile data received from /api/student/profile:', profileData);
                    } else {
                        console.log('‚ùå /api/student/profile failed with status:', response.status);
                    }
                } catch (error) {
                    console.log('‚ùå Error with /api/student/profile:', error.message);
                }
                
                // Second try: /api/students/profile (alternative endpoint)
                if (!profileData && response && response.status !== 200) {
                    try {
                        console.log('üîç Trying /api/students/profile endpoint...');
                        const controller2 = new AbortController();
                        const timeoutId2 = setTimeout(() => controller2.abort(), 10000);
                        
                        response = await fetch(`/api/students/profile`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json',
                                'Cache-Control': 'no-cache',
                                'Pragma': 'no-cache'
                            },
                            signal: controller2.signal
                        });
                        
                        clearTimeout(timeoutId2);
                        console.log('üîç Second attempt response status:', response.status);
                        
                        if (response.ok) {
                            profileData = await response.json();
                            console.log('‚úÖ Profile data received from /api/students/profile:', profileData);
                        }
                    } catch (error) {
                        console.log('‚ùå Error with /api/students/profile:', error.message);
                    }
                }
                
                // Third try: Direct student lookup by ID
                if (!profileData && studentId) {
                    try {
                        console.log('üîç Trying direct student lookup by ID...');
                        const controller3 = new AbortController();
                        const timeoutId3 = setTimeout(() => controller3.abort(), 10000);
                        
                        response = await fetch(`/api/students/${studentId}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json',
                                'Cache-Control': 'no-cache',
                                'Pragma': 'no-cache'
                            },
                            signal: controller3.signal
                        });
                        
                        clearTimeout(timeoutId3);
                        console.log('üîç Direct lookup response status:', response.status);
                        
                        if (response.ok) {
                            profileData = await response.json();
                            console.log('‚úÖ Profile data received from direct lookup:', profileData);
                        }
                    } catch (error) {
                        console.log('‚ùå Error with direct student lookup:', error.message);
                    }
                }
                
                // Process the profile data
                if (profileData) {
                    // Handle different response structures
                    let profile;
                    if (profileData.profile) {
                        profile = profileData.profile;
                    } else if (profileData.student) {
                        profile = profileData.student;
                    } else {
                        profile = profileData;
                    }
                    
                    console.log('‚úÖ Final profile data to populate:', profile);
                    populateForm(profile);
                } else if (response && response.status === 401) {
                    console.log('‚ùå Unauthorized - token may be expired');
                    showSuccessMessage('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        localStorage.clear();
                        window.location.href = 'student-login.html';
                    }, 2000);
                } else if (response && response.status === 404) {
                    console.log('‚ÑπÔ∏è No profile found - creating new profile');
                    // Create a basic profile structure for new users
                    const basicProfile = {
                        firstName: username.split('@')[0] || 'Student',
                        lastName: 'User',
                        email: username,
                        // Add other default fields
                    };
                    populateForm(basicProfile);
                } else {
                    console.log('‚ùå All API attempts failed');
                    showSuccessMessage('Failed to load profile data. Please check your connection and try again.', 'error');
                }
            } catch (error) {
                console.error('‚ùå Error loading profile:', error);
                if (error.name === 'AbortError') {
                    showSuccessMessage('Request timed out. Please check your connection and try again.', 'error');
                } else {
                    showSuccessMessage('Network error. Please check your connection and try again.', 'error');
                }
            }
        }

        function populateForm(profile) {
            console.log('üîç Populating form with profile data:', profile);
            
            // Personal Information
            document.getElementById('firstName').value = profile.firstName || '';
            document.getElementById('middleName').value = profile.middleName || '';
            document.getElementById('lastName').value = profile.lastName || '';
            document.getElementById('gender').value = profile.gender || '';
            
            // Handle birthday format (convert from Date object if needed)
            let birthdayValue = profile.birthday || '';
            if (birthdayValue && typeof birthdayValue === 'string' && birthdayValue.includes('T')) {
                // Convert ISO date string to YYYY-MM-DD format for input
                birthdayValue = birthdayValue.split('T')[0];
            }
            document.getElementById('birthday').value = birthdayValue;
            
            document.getElementById('age').value = profile.age || '';
            document.getElementById('contact').value = profile.contact || '';
            
            // Use profile email if available, otherwise use login email from localStorage
            const loginEmail = localStorage.getItem('remoedUsername') || '';
            document.getElementById('email').value = profile.email || profile.username || loginEmail;
            
            document.getElementById('address').value = profile.address || '';
            document.getElementById('language').value = profile.language || '';
            document.getElementById('hobbies').value = profile.hobbies || '';
            document.getElementById('parentName').value = profile.parentName || '';
            document.getElementById('parentContact').value = profile.parentContact || '';
            document.getElementById('emergencyContact').value = profile.emergencyContact || '';
            document.getElementById('aboutMe').value = profile.aboutMe || '';

            // Update profile display
            const displayName = profile.firstName ? `${profile.firstName} ${profile.lastName || ''}`.trim() : profile.username || 'Student';
            document.getElementById('profile-name').textContent = displayName;
            document.getElementById('profile-email').textContent = profile.email || profile.username || loginEmail;
            
            // Update sidebar quick info
            updateSidebarQuickInfo(profile);
            
            // Update avatar text
                const mainText = document.getElementById('profile-avatar-text');
                const mainImg = document.getElementById('profile-avatar-img');
                if (mainText) {
                    mainText.textContent = displayName[0].toUpperCase();
                    if (mainImg) mainImg.style.display = 'none';
                    mainText.style.display = 'inline-block';
                }

            // Profile Picture
            if (profile.profilePicture) {
                console.log('üîç Found profile picture, updating avatar...');
                const mainImg = document.getElementById('profile-avatar-img');
                const mainText = document.getElementById('profile-avatar-text');
                // Update sidebar elements too if present
                const sidebarImgEl = document.getElementById('profile-image');
                const sidebarTextEl = document.getElementById('avatar-text');

                // Create a new image to test if it loads
                const testImage = new Image();
                testImage.onload = function() {
                    if (mainImg && mainText) {
                        mainImg.src = profile.profilePicture;
                        mainImg.style.display = 'block';
                        mainText.style.display = 'none';
                    }
                    if (sidebarImgEl && sidebarTextEl) {
                        sidebarImgEl.src = profile.profilePicture;
                        sidebarImgEl.style.display = 'block';
                        sidebarTextEl.style.display = 'none';
                    }
                    console.log('‚úÖ Profile picture loaded successfully in form and sidebar');
                };
                testImage.onerror = function() {
                    console.log('‚ùå Profile picture failed to load in form');
                    if (mainImg && mainText) {
                        mainImg.style.display = 'none';
                        mainText.style.display = 'inline-block';
                        mainText.textContent = displayName[0].toUpperCase();
                    }
                    if (sidebarImgEl && sidebarTextEl) {
                        sidebarImgEl.style.display = 'none';
                        sidebarTextEl.style.display = 'inline-block';
                    }
                };
                testImage.src = profile.profilePicture;
            }

            // Education
            if (profile.education && profile.education.length > 0) {
                console.log('üîç Found education data:', profile.education);
                const educationList = document.getElementById('education-list');
                educationList.innerHTML = '';
                profile.education.forEach(edu => {
                    const educationItem = document.createElement('div');
                    educationItem.className = 'education-item';
                    educationItem.innerHTML = `
                        <div class="education-header">
                            <span>üéì Education ${educationList.children.length + 1}</span>
                            <button class="remove-btn" onclick="removeEducationItem(this)">üóëÔ∏è Remove</button>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">üè´ School Name</label>
                                <input type="text" class="form-input" value="${edu.schoolName || ''}" placeholder="School Name" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">üìö Level</label>
                                <select class="form-input" disabled>
                                    <option value="">Select Level</option>
                                    <option value="nursery" ${edu.level === 'nursery' ? 'selected' : ''}>üå± Nursery</option>
                                    <option value="kindergarten" ${edu.level === 'kindergarten' ? 'selected' : ''}>üåü Kindergarten</option>
                                    <option value="primary" ${edu.level === 'primary' ? 'selected' : ''}>üìñ Primary</option>
                                    <option value="secondary" ${edu.level === 'secondary' ? 'selected' : ''}>üéì Secondary</option>
                                    <option value="college" ${edu.level === 'college' ? 'selected' : ''}>üèõÔ∏è College</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">üìÖ Year Started</label>
                                <input type="number" class="form-input" value="${edu.yearStarted || ''}" placeholder="Year Started" min="1900" max="2030" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">üìÖ Year Ended</label>
                                <input type="number" class="form-input" value="${edu.yearEnded || ''}" placeholder="Year Ended" min="1900" max="2030" disabled>
                            </div>
                        </div>
                    `;
                    educationList.appendChild(educationItem);
                });
            }

            // Documents
            if (profile.documents) {
                console.log('üîç Found documents data:', profile.documents);
                if (profile.documents.studentId) {
                    document.getElementById('student-id-preview').src = profile.documents.studentId;
                    document.getElementById('student-id-preview').style.display = 'block';
                }
                if (profile.documents.birthCertificate) {
                    document.getElementById('birth-cert-preview').src = profile.documents.birthCertificate;
                    document.getElementById('birth-cert-preview').style.display = 'block';
                }
                if (profile.documents.academicRecords) {
                    document.getElementById('academic-preview').src = profile.documents.academicRecords;
                    document.getElementById('academic-preview').style.display = 'block';
                }
                if (profile.documents.certificates) {
                    document.getElementById('certificates-preview').src = profile.documents.certificates;
                    document.getElementById('certificates-preview').style.display = 'block';
                }
            }
            
            console.log('‚úÖ Form populated successfully');
        }

        async function saveProfile() {
            const saveBtn = document.getElementById('save-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                // Get token from localStorage
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found. Please login again.');
                }

                // Collect form data
                const profileData = {
                    firstName: document.getElementById('firstName').value,
                    middleName: document.getElementById('middleName').value,
                    lastName: document.getElementById('lastName').value,
                    gender: document.getElementById('gender').value,
                    birthday: document.getElementById('birthday').value,
                    age: document.getElementById('age').value,
                    contact: document.getElementById('contact').value,
                    email: document.getElementById('email').value || localStorage.getItem('remoedUsername') || '',
                    address: document.getElementById('address').value,
                    language: document.getElementById('language').value,
                    hobbies: document.getElementById('hobbies').value,
                    parentName: document.getElementById('parentName').value,
                    parentContact: document.getElementById('parentContact').value,
                    emergencyContact: document.getElementById('emergencyContact').value,
                    aboutMe: document.getElementById('aboutMe').value
                };

                // Collect education data
                const educationItems = document.querySelectorAll('.education-item');
                profileData.education = Array.from(educationItems).map(item => {
                    const inputs = item.querySelectorAll('input, select');
                    return {
                        schoolName: inputs[0].value,
                        level: inputs[1].value,
                        yearStarted: inputs[2].value,
                        yearEnded: inputs[3].value
                    };
                });

                // Validate required fields - make them optional for initial setup
                if (!profileData.email || profileData.email.trim() === '') {
                    // Use username as email if not provided
                    profileData.email = localStorage.getItem('remoedUsername') || '';
                }
                
                if (!profileData.firstName || profileData.firstName.trim() === '') {
                    profileData.firstName = 'Student'; // Default first name
                }
                
                if (!profileData.lastName || profileData.lastName.trim() === '') {
                    profileData.lastName = 'User'; // Default last name
                }

                console.log('Saving profile data:', profileData);
                console.log('Using token:', token ? 'Token exists' : 'No token');

                // Save profile data
                const response = await fetch('/api/student/profile', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profileData)
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);

                if (response.ok) {
                    const result = await response.json();
                    console.log('Save result:', result);
                    showSuccessMessage('Profile saved successfully!');
                    
                    // Reload profile data to show updated information
                    await loadProfile();
                    
                    // Disable editing after successful save
                    const inputs = document.querySelectorAll('.form-input, .form-textarea');
                    inputs.forEach(input => input.disabled = true);
                    
                    const fileInputs = document.querySelectorAll('input[type="file"]');
                    fileInputs.forEach(input => input.disabled = true);
                    
                    document.getElementById('add-education-btn').disabled = true;
                    
                    const educationInputs = document.querySelectorAll('.education-item input, .education-item select');
                    educationInputs.forEach(input => input.disabled = true);
                    
                    // Show/hide buttons
                    document.getElementById('edit-btn').style.display = 'inline-block';
                    document.getElementById('cancel-btn').style.display = 'none';
                    document.getElementById('save-btn').style.display = 'none';
                } else {
                    const errorText = await response.text();
                    console.error('Server error response:', errorText);
                    let errorMessage = 'Failed to save profile';
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorMessage;
                    } catch (e) {
                        errorMessage = errorText || errorMessage;
                    }
                    throw new Error(errorMessage);
                }

                // Handle file uploads
                await handleFileUploads();

            } catch (error) {
                console.error('Error saving profile:', error);
                showSuccessMessage('Error saving profile: ' + error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Profile';
            }
        }

        async function handleFileUploads() {
            const files = [
                { id: 'profilePicture', field: 'profilePicture' },
                { id: 'studentId', field: 'studentId' },
                { id: 'birthCertificate', field: 'birthCertificate' },
                { id: 'academicRecords', field: 'academicRecords' },
                { id: 'certificates', field: 'certificates' }
            ];

            for (const file of files) {
                const fileInput = document.getElementById(file.id);
                if (fileInput.files.length > 0) {
                    await uploadFile(fileInput.files[0], file.field);
                }
            }
        }

        async function uploadFile(file, documentType) {
            try {
                const token = localStorage.getItem('token');
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const fileData = {
                        documentType: documentType,
                        fileData: e.target.result,
                        fileName: file.name
                    };

                    const response = await fetch('/api/student/upload-document', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(fileData)
                    });

                    if (response.ok) {
                        console.log(`${documentType} uploaded successfully`);
                    } else {
                        console.error(`Failed to upload ${documentType}`);
                    }
                };
                reader.readAsDataURL(file);
            } catch (error) {
                console.error(`Error uploading ${documentType}:`, error);
            }
        }

        function showSuccessMessage(message, type = 'success') {
            const successMessage = document.getElementById('success-message');
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            
            // Set color based on message type
            if (type === 'error') {
                successMessage.style.color = '#dc3545';
                successMessage.style.backgroundColor = '#f8d7da';
                successMessage.style.borderColor = '#f5c6cb';
            } else {
                successMessage.style.color = '#155724';
                successMessage.style.backgroundColor = '#d4edda';
                successMessage.style.borderColor = '#c3e6cb';
            }
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 5000);
        }

        function enableEditing() {
            console.log('Enabling editing...');
            
            // Enable all form inputs
            const inputs = document.querySelectorAll('.form-input, .form-textarea');
            inputs.forEach(input => {
                input.disabled = false;
                console.log('Enabled input:', input.id || input.name);
            });
            
            // Enable file uploads
            const fileInputs = document.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => {
                input.disabled = false;
                console.log('Enabled file input:', input.id);
            });
            
            // Enable education add button
            const addEducationBtn = document.getElementById('add-education-btn');
            if (addEducationBtn) {
                addEducationBtn.disabled = false;
                console.log('Enabled add education button');
            }
            
            // Enable education inputs
            const educationInputs = document.querySelectorAll('.education-item input, .education-item select');
            educationInputs.forEach(input => {
                input.disabled = false;
                console.log('Enabled education input:', input.id || input.name);
            });
            
            // Show/hide buttons
            document.getElementById('edit-btn').style.display = 'none';
            document.getElementById('cancel-btn').style.display = 'inline-block';
            document.getElementById('save-btn').style.display = 'inline-block';
            
            console.log('Editing enabled successfully');
        }
        
        function cancelEditing() {
            // Disable all form inputs
            const inputs = document.querySelectorAll('.form-input, .form-textarea');
            inputs.forEach(input => input.disabled = true);
            
            // Disable file uploads
            const fileInputs = document.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => input.disabled = true);
            
            // Disable education add button
            document.getElementById('add-education-btn').disabled = true;
            
            // Disable education inputs
            const educationInputs = document.querySelectorAll('.education-item input, .education-item select');
            educationInputs.forEach(input => input.disabled = true);
            
            // Show/hide buttons
            document.getElementById('edit-btn').style.display = 'inline-block';
            document.getElementById('cancel-btn').style.display = 'none';
            document.getElementById('save-btn').style.display = 'none';
            
            // Reload profile data to restore original values
            loadProfile();
        }
        
        function goBack() {
            window.location.href = 'student-dashboard.html';
        }
        
        // Settings functions
        async function updateSettings() {
            const newEmail = document.getElementById('new-email').value.trim();
            const newUsername = document.getElementById('new-username').value.trim();
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // Validate password match
            if (newPassword && newPassword !== confirmPassword) {
                showSuccessMessage('New passwords do not match!', 'error');
                return;
            }
            
            // Validate password length
            if (newPassword && newPassword.length < 6) {
                showSuccessMessage('New password must be at least 6 characters long!', 'error');
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const settingsData = {
                    newEmail: newEmail || undefined,
                    newUsername: newUsername || undefined,
                    currentPassword: currentPassword || undefined,
                    newPassword: newPassword || undefined
                };
                
                // Remove undefined values
                Object.keys(settingsData).forEach(key => {
                    if (settingsData[key] === undefined) {
                        delete settingsData[key];
                    }
                });
                
                if (Object.keys(settingsData).length === 0) {
                    showSuccessMessage('Please fill in at least one field to update!', 'error');
                    return;
                }
                
                const response = await fetch('/api/student/update-settings', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settingsData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccessMessage('Settings updated successfully!');
                    
                    // Update localStorage if username was changed
                    if (newUsername) {
                        localStorage.setItem('remoedUsername', newUsername);
                        updateProfileDisplay();
                    }
                    
                    // Clear form
                    resetSettingsForm();
                    
                    // Reload profile data
                    await loadProfile();
                } else {
                    const errorData = await response.json();
                    showSuccessMessage(errorData.error || 'Failed to update settings', 'error');
                }
            } catch (error) {
                console.error('Error updating settings:', error);
                showSuccessMessage('Error updating settings. Please try again.', 'error');
            }
        }
        
        function resetSettingsForm() {
            document.getElementById('new-email').value = '';
            document.getElementById('new-username').value = '';
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            
            // Reload current values
            loadSettingsData();
        }
        
        function loadSettingsData() {
            const username = localStorage.getItem('remoedUsername') || '';
            const email = localStorage.getItem('remoedUsername') || ''; // For students, username is often the email
            
            document.getElementById('current-email').value = email;
            document.getElementById('current-username').value = username;
        }
        
        function updateSidebarQuickInfo(profile) {
            const email = profile.email || profile.username || '-';
            const contact = profile.contact || '-';
            const birthday = profile.birthday || '-';
            const address = profile.address || '-';
            
            document.getElementById('sidebar-email-display').textContent = email;
            document.getElementById('sidebar-contact-display').textContent = contact !== '-' ? contact : '-';
            if (birthday !== '-') {
                try {
                    const date = new Date(birthday);
                    document.getElementById('sidebar-birthday-display').textContent = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                } catch (e) {
                    document.getElementById('sidebar-birthday-display').textContent = birthday;
                }
            } else {
                document.getElementById('sidebar-birthday-display').textContent = '-';
            }
            document.getElementById('sidebar-location-display').textContent = address !== '' ? (address.length > 30 ? address.substring(0, 30) + '...' : address) : '-';
        }
        
        function goToForgotPassword() {
            window.location.href = 'forgot-password.html';
        }
        
        // Debug function to test API connection
        async function testApiConnection() {
            console.log('üîç Testing API connection...');
            const token = localStorage.getItem('token');
            const studentId = localStorage.getItem('studentId');
            const username = localStorage.getItem('remoedUsername');
            
            console.log('üîç Token:', token ? 'Present' : 'Missing');
            console.log('üîç Student ID:', studentId);
            console.log('üîç Username:', username);
            
            if (!token) {
                alert('No authentication token found. Please log in again.');
                return;
            }
            
            try {
                // Test basic connectivity
                const response = await fetch('/api/student/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('üîç Response status:', response.status);
                console.log('üîç Response headers:', response.headers);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ API test successful:', data);
                    alert('API connection successful! Check console for details.');
                } else {
                    const errorText = await response.text();
                    console.log('‚ùå API test failed:', errorText);
                    alert(`API test failed with status ${response.status}. Check console for details.`);
                }
            } catch (error) {
                console.error('‚ùå API test error:', error);
                alert('API test error: ' + error.message);
            }
        }
        

    </script>
</body>
</html> 