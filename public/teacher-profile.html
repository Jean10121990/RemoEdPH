<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Profile - RemoEdPH</title>
    <link rel="stylesheet" href="modern-styles.css">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #F0F2F5; 
            margin: 0;
            padding: 0;
        }
        
        .remoed-main {
            display: flex;
            min-height: 100vh;
        }
        
        .remoed-sidebar {
            width: 260px;
            min-width: 260px;
            background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
            box-shadow: 4px 0 20px rgba(102, 126, 234, 0.1);
            padding: 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow: hidden;
            z-index: 100;
        }
        
        .remoed-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .remoed-menu li {
            padding: 14px 32px;
            color: #64748b;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
            transition: background 0.2s, border-color 0.2s;
        }

        .remoed-menu li.active,
        .remoed-menu li:hover {
            background: linear-gradient(90deg, #667eea 0%, #5a67d8 100%);
            border-left: 4px solid #667eea;
            color: white;
            transform: translateX(4px);
            transition: all 0.3s ease;
            border-radius: 0 8px 8px 0;
        }
        
        .remoed-menu svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }
        
        .remoed-content {
            flex: 1;
            padding: 24px 32px;
            margin-left: 260px;
            max-width: calc(100vw - 260px);
            background: #F0F2F5;
        }
        
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Facebook-style Profile Header */
        .profile-header {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .profile-avatar-large {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            border: 4px solid #667eea;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }
        
        .profile-avatar-large:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }
        
        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .upload-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .profile-avatar-large:hover .upload-overlay {
            transform: translateY(0);
        }
        
        .profile-header-info {
            flex: 1;
        }
        
        .profile-name-large {
            font-size: 2.5rem;
            font-weight: 800;
            color: #667eea;
            margin: 0 0 8px 0;
        }
        
        .profile-email-large {
            color: #4A6FA5;
            margin: 0 0 16px 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .profile-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        /* Profile Content Grid - Facebook Style */
        .profile-content-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
        }
        
        .profile-sidebar-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 24px;
        }
        
        .profile-main-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid #667eea;
        }
        
        .info-section {
            margin-bottom: 32px;
        }
        
        .info-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1E3A5F;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #1E3A5F;
            font-size: 0.95rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E8F4FD;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E8F4FD;
            border-radius: 12px;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: block;
            padding: 16px;
            border: 3px dashed #667eea;
            border-radius: 12px;
            text-align: center;
            color: #667eea;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: #F0F8FF;
            cursor: pointer;
        }
        
        .file-upload:hover .file-upload-label {
            background: linear-gradient(135deg, #E8F4FD, #FFFBF0);
            border-color: #667eea;
            transform: scale(1.02);
        }
        
        .save-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .save-btn:disabled {
            background: #ccc;
            border-color: #999;
            cursor: not-allowed;
            transform: none;
        }
        
        .edit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .edit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        
        .cancel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        .form-input:disabled, .form-textarea:disabled, .form-input[readonly], .form-textarea[readonly] {
            background-color: #f8f9fa;
            color: #495057;
            cursor: not-allowed;
        }
        
        .form-help {
            color: #6c757d;
            font-size: 0.7rem;
            margin-top: 2px;
            display: block;
        }
        
        .file-upload.disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .education-item {
            background: #F8F9FA;
            border: 2px solid #E8F4FD;
            border-left: 4px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .education-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        /* Compact document item layout */
        .document-item {
            background: #F8F9FA;
            border: 2px solid #E8F4FD;
            border-left: 4px solid #667eea;
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .document-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .document-header strong {
            font-size: 0.9rem;
            color: #667eea;
        }
        
        .document-content {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        
        .document-upload-compact {
            flex: 0 0 140px;
            min-width: 140px;
        }
        
        .document-preview-compact {
            flex: 1;
            min-width: 0;
        }
        
        /* Grid layout for document containers */
        #diplomas-container,
        #certificates-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 768px) {
            #diplomas-container,
            #certificates-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Bulk Upload Styles */
        .bulk-upload-zone {
            position: relative;
        }
        
        .bulk-upload-zone.drag-over {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
            border-color: #764ba2;
            transform: scale(1.02);
        }
        
        .bulk-upload-zone:hover {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
            border-color: #764ba2;
        }
        
        /* Document Category Tabs */
        .doc-category-btn {
            background: transparent;
            border: none;
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.9rem;
        }
        
        .doc-category-btn:hover {
            background: #f0f8ff;
            color: #667eea;
        }
        
        .doc-category-btn.active {
            background: #f0f8ff;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .doc-count-badge {
            background: #667eea;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
            margin-left: 6px;
            font-weight: 700;
        }
        
        /* Preview Mode Styles */
        .preview-mode {
            pointer-events: none;
        }
        
        .preview-mode .form-input,
        .preview-mode .form-textarea,
        .preview-mode button:not(.preview-btn),
        .preview-mode .file-upload {
            opacity: 0.6;
        }
        
        .preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 9998;
            display: none;
            backdrop-filter: blur(4px);
        }
        
        .preview-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 95vw;
            max-height: 95vh;
            overflow-y: auto;
            z-index: 9999;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: none;
            width: 100%;
            max-width: 800px;
        }
        
        .preview-modal::-webkit-scrollbar {
            width: 8px;
        }
        
        .preview-modal::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .preview-modal::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        .preview-modal::-webkit-scrollbar-thumb:hover {
            background: #5a67d8;
        }
        
        .preview-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e8f4fd;
        }
        
        .preview-modal-header h3 {
            margin: 0;
            color: #667eea;
        }
        
        .close-preview-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .close-preview-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .preview-modal {
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
                top: 0;
                left: 0;
                transform: none;
            }
            
            .preview-modal-header {
                border-radius: 0 !important;
            }
        }
        
        .education-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .education-header span {
            font-weight: 800;
            font-size: 1.1rem;
            color: #667eea;
        }
        
        .work-experience-item {
            background: #F8F9FA;
            border: 2px solid #E8F4FD;
            border-left: 4px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .work-experience-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .work-experience-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .work-experience-header span {
            font-weight: 800;
            font-size: 1.1rem;
            color: #667eea;
        }
        
        .remove-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .remove-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .add-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
         
         /* Video Upload Styles */
         .video-upload-section {
             margin-top: 10px;
             width: 100%;
         }
         
         .video-upload-btn {
             display: flex;
             align-items: center;
             gap: 8px;
             padding: 8px 12px;
             background: #f8f9fa;
             border: 2px dashed #1ca7e7;
             border-radius: 8px;
             cursor: pointer;
             transition: all 0.2s;
             font-size: 0.7rem;
             color: #1ca7e7;
             font-weight: 600;
             justify-content: center;
         }
         
         .video-upload-btn:hover {
             background: #eaf7ff;
             border-color: #168fc1;
         }
         
         .video-upload-btn svg {
             width: 16px;
             height: 16px;
         }
         
         .video-preview {
             margin-top: 8px;
             background: #f8f9fa;
             border-radius: 8px;
             padding: 8px;
             border: 1px solid #e0e6ed;
         }
         
         .video-info {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-top: 6px;
             font-size: 0.65rem;
             color: #666;
         }
         
         .remove-video-btn {
             background: #dc3545;
             color: white;
             border: none;
             padding: 2px 6px;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.6rem;
         }
         
         .remove-video-btn:hover {
             background: #c82333;
         }
         
         .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease-in;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Tab Styles */
        .tab-container {
            margin-bottom: 0;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 3px solid #E8F4FD;
            margin-bottom: 32px;
            gap: 8px;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 16px 24px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            color: #4A6FA5;
            border-bottom: 4px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            top: 3px;
        }
        
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-button:hover {
            color: #667eea;
            background: #F0F8FF;
            border-radius: 12px 12px 0 0;
        }
        
        /* Info Cards - Facebook Style */
        .info-card {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #667eea;
            overflow: hidden;
            word-wrap: break-word;
        }
        
        .info-row {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #E8F4FD;
            gap: 8px;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 700;
            color: #1E3A5F;
            min-width: 80px;
            max-width: 80px;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .info-value {
            color: #4A6FA5;
            font-size: 0.9rem;
            flex: 1;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.4;
            min-width: 0;
        }
        
        .info-value.empty {
            color: #999;
            font-style: italic;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Teaching Abilities Assessment Styles */
        .assessment-notice {
            background: linear-gradient(135deg, #E8F4FD 0%, #F0F8FF 100%);
            border-left: 4px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 32px;
        }
        
        .assessment-notice h4 {
            color: #667eea;
            margin: 0 0 8px 0;
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .assessment-notice p {
            color: #4A6FA5;
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .skill-assessment-card {
            background: #F8F9FA;
            border: 2px solid #E8F4FD;
            border-left: 4px solid #667eea;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }
        
        .skill-assessment-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .skill-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1E3A5F;
        }
        
        .assessed-level {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.95rem;
        }
        
        .skill-stars {
            font-size: 1.2rem;
            color: #ffc107;
            letter-spacing: 2px;
        }
        
        .assessment-criteria {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            margin-bottom: 16px;
        }
        
        .assessment-criteria h5 {
            color: #667eea;
            margin: 0 0 12px 0;
            font-size: 0.95rem;
            font-weight: 700;
        }
        
        .criteria-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .criteria-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #E8F4FD;
            font-size: 0.9rem;
            color: #4A6FA5;
        }
        
        .criteria-item:last-child {
            border-bottom: none;
        }
        
        .criteria-item::before {
            content: "‚úì";
            color: #4CAF50;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .assessment-source {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            font-size: 0.85rem;
            color: #666;
        }
        
        .assessment-source-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #E8F4FD;
            border-radius: 6px;
            color: #667eea;
            font-weight: 600;
        }
        
        .level-description {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .level-description label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #1E3A5F;
            font-size: 0.95rem;
        }
        
        .teacher-description {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .teacher-description label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #1E3A5F;
            font-size: 0.95rem;
        }
        
        .level-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .level-badge.beginner {
            background: #FFF3CD;
            color: #856404;
        }
        
        .level-badge.intermediate {
            background: #D1ECF1;
            color: #0C5460;
        }
        
        .level-badge.advanced {
            background: #D4EDDA;
            color: #155724;
        }
        
        .level-badge.expert {
            background: #D1E7DD;
            color: #0F5132;
        }
        
        .level-badge.master {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        /* Support & Resources Styles */
        .support-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .support-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .support-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        .support-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }
        
        .support-card h3 {
            color: #667eea;
            margin: 0 0 12px 0;
            font-size: 1.2rem;
        }
        
        .support-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .support-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            width: 100%;
        }
        
        .support-btn:hover {
            background: #5568d3;
        }
        
        .quick-links {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .quick-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .quick-link:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        /* Legal Links Styles */
        .legal-links {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        
        .legal-link {
            display: inline-flex;
            align-items: center;
            padding: 12px 20px;
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 8px;
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .legal-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .document-preview {
            max-width: 100%;
            max-height: 200px;
            border: 2px solid #E8F4FD;
            border-radius: 12px;
            margin-top: 12px;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .document-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        .file-preview {
            max-width: 200px;
            max-height: 150px;
            width: auto;
            height: auto;
            border: 2px solid #E8F4FD;
            border-radius: 12px;
            margin-top: 12px;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .file-preview img {
            width: 100%;
            max-width: 200px;
            max-height: 150px;
            height: auto;
            object-fit: contain;
            border-radius: 12px;
            display: block;
        }
        
        .file-preview .file-info {
            background: #f8f9fa;
            padding: 8px 12px;
            font-size: 0.85rem;
            color: #666;
            border-top: 1px solid #E8F4FD;
            text-align: center;
        }
        
        /* Compact preview styles */
        .document-preview-compact {
            border: 2px solid #E8F4FD;
            border-radius: 8px;
            display: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            background: white;
        }
        
        .document-preview-compact img {
            width: 100%;
            max-width: 100%;
            max-height: 120px;
            height: auto;
            object-fit: contain;
            display: block;
        }
        
        .document-preview-compact .file-info {
            background: #f8f9fa;
            padding: 6px 8px;
            font-size: 0.75rem;
            color: #666;
            border-top: 1px solid #E8F4FD;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-upload-label-compact {
            display: block;
            padding: 10px 12px;
            border: 2px dashed #667eea;
            border-radius: 8px;
            text-align: center;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            background: #F0F8FF;
            cursor: pointer;
        }
        
        .file-upload-label-compact:hover {
            background: linear-gradient(135deg, #E8F4FD, #FFFBF0);
            border-color: #667eea;
        }
        
        .video-upload-section {
            margin-top: 10px;
            width: 100%;
        }
        
        .video-upload-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 600;
            justify-content: center;
        }
        
        .video-upload-btn:hover {
            background: #eaf7ff;
            border-color: #667eea;
        }
        
        .video-preview {
            margin-top: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border: 2px solid #E8F4FD;
        }
        
        .video-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .remove-video-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .remove-video-btn:hover {
            background: #c82333;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .profile-content-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-sidebar-card {
                position: static;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar-large {
                width: 120px;
                height: 120px;
            }
            
            .profile-name-large {
                font-size: 2rem;
            }
            
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .tab-button {
                font-size: 0.9rem;
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="remoed-main">
        <!-- Sidebar will be loaded via JavaScript -->
        <div class="remoed-sidebar" id="sidebar"></div>
        
        <div class="remoed-content">
            <div class="profile-container">
                <!-- Facebook-style Profile Header -->
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profile-avatar-large" onclick="handleProfilePictureClick()">
                        <img id="profile-avatar-img" src="" alt="Profile Avatar" style="width:100%; height:100%; object-fit:cover; border-radius:50%; display:none;">
                        <span id="profile-avatar-text" style="font-size:4rem; font-weight:bold; color:#fff; display:inline-block;">T</span>
                        <div class="upload-overlay">Click to upload photo</div>
                    </div>
                    <input type="file" id="profile-picture" accept="image/*" style="display: none;">
                    <div class="profile-header-info">
                        <h1 class="profile-name-large" id="profile-name-large">Teacher Name</h1>
                        <p class="profile-email-large" id="profile-email-large">teacher@remoedph.com</p>
                        <div class="profile-actions">
                            <button class="back-btn" onclick="window.location.href='teacher-dashboard.html'">‚Üê Back to Dashboard</button>
                            <button class="edit-btn" id="edit-profile-btn" onclick="enableEditing()">Edit Profile</button>
                            <button class="cancel-btn" id="cancel-edit-btn" onclick="cancelEditing()" style="display: none;">Cancel</button>
                            <button class="save-btn" id="save-profile-btn" onclick="saveProfile()" style="display: none;">Save Changes</button>
                        </div>
                    </div>
                </div>
                
                <div class="success-message" id="success-message" style="display: none;"></div>
                <div class="error-message" id="error-message" style="display: none;">Error updating profile. Please try again.</div>
                
                <!-- Profile Content Grid -->
                <div class="profile-content-grid">
                    <!-- Profile Sidebar Card -->
                    <div class="profile-sidebar-card">
                        <h3 class="section-title" style="font-size: 1.3rem; margin-bottom: 20px;">Quick Info</h3>
                        <div class="info-card">
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value" id="sidebar-email-display">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Contact:</span>
                                <span class="info-value" id="sidebar-contact-display">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Birthday:</span>
                                <span class="info-value" id="sidebar-birthday-display">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Location:</span>
                                <span class="info-value" id="sidebar-location-display">-</span>
                            </div>
                        </div>
                        
                        <!-- Video Introduction Upload -->
                        <div class="video-upload-section" style="margin-top: 24px;">
                            <h4 class="info-section-title" style="font-size: 1rem; margin-bottom: 12px;">Video Introduction</h4>
                            <div class="video-upload-btn" onclick="document.getElementById('video-introduction').click()">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 7l-7 4 7 4V7z"/>
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                                </svg>
                                <span>Upload Video Introduction</span>
                            </div>
                            <input type="file" id="video-introduction" accept="video/*" style="display: none;">
                            <div id="video-preview" class="video-preview" style="display: none; margin-top: 12px;">
                                <video id="video-player" controls style="width: 100%; border-radius: 8px;">
                                    <source src="" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                <div class="video-info">
                                    <span id="video-name">No video selected</span>
                                    <button type="button" class="remove-video-btn" onclick="removeVideo()">Remove</button>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Profile Main Content -->
                    <div class="profile-main-card">
                <div id="profile-form">
                    <!-- Profile Completion Indicator -->
                    <div id="profile-completion-indicator" style="background: linear-gradient(135deg, #f0f8ff 0%, #e8f4fd 100%); border: 2px solid #667eea; border-radius: 12px; padding: 16px 20px; margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <div>
                                <h4 style="margin: 0; color: #667eea; font-size: 1rem; font-weight: 700;">Profile Completion</h4>
                                <p style="margin: 4px 0 0 0; color: #666; font-size: 0.85rem;" id="completion-message">Complete your profile to attract more students</p>
                            </div>
                            <button type="button" class="preview-btn" id="preview-profile-btn" onclick="togglePreviewMode()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.3s ease;">
                                üëÅÔ∏è Preview Profile
                            </button>
                        </div>
                        <div style="background: #e0e6ed; border-radius: 8px; height: 12px; overflow: hidden; position: relative;">
                            <div id="completion-progress-bar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.5s ease; border-radius: 8px;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                            <span id="completion-percentage" style="font-size: 0.9rem; font-weight: 700; color: #667eea;">0%</span>
                            <span id="completion-details" style="font-size: 0.8rem; color: #666;"></span>
                        </div>
                        <div id="missing-fields-list" style="margin-top: 12px; font-size: 0.85rem; color: #666; display: none;">
                            <strong style="color: #e74c3c;">Missing:</strong> <span id="missing-fields-text"></span>
                        </div>
                    </div>
                    
                    <!-- Tab Navigation -->
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button type="button" class="tab-button active" onclick="showTab('personal', event)">Personal Information</button>
                            <button type="button" class="tab-button" onclick="showTab('education', event)">Education and Work Experience</button>
                            <button type="button" class="tab-button" onclick="showTab('teaching-abilities', event)">Teaching Abilities</button>
                            <button type="button" class="tab-button" onclick="showTab('documents', event)">Documents & Certificates</button>
                            <button type="button" class="tab-button" onclick="showTab('support', event)">Support & Resources</button>
                            <button type="button" class="tab-button" onclick="showTab('settings', event)">Settings</button>
                        </div>
                    </div>
                    
                                         <!-- Personal Information Tab -->
                     <div id="personal-tab" class="tab-content active">
                         <div class="form-grid">
                             <div class="form-group">
                                 <label class="form-label">First Name *</label>
                                 <input type="text" class="form-input" id="firstname" name="firstname" required disabled>
                             </div>
                             <div class="form-group">
                                 <label class="form-label">Middle Name</label>
                                 <input type="text" class="form-input" id="middlename" name="middlename" disabled>
                             </div>
                             <div class="form-group">
                                 <label class="form-label">Last Name *</label>
                                 <input type="text" class="form-input" id="lastname" name="lastname" required disabled>
                             </div>
                            <div class="form-group">
                                <label class="form-label">Birthday</label>
                                <input type="date" class="form-input" id="birthday" name="birthday" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gender</label>
                                <select class="form-input" id="gender" name="gender" disabled>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Language</label>
                                <select class="form-input" id="language" name="language" disabled>
                                    <option value="">Select Language</option>
                                    <option value="English">English</option>
                                    <option value="Filipino">Filipino</option>
                                    <option value="Spanish">Spanish</option>
                                    <option value="Chinese">Chinese</option>
                                    <option value="Japanese">Japanese</option>
                                </select>
                            </div>
                                                         <div class="form-group full-width">
                                 <label class="form-label">Hobbies & Interests</label>
                                 <textarea class="form-textarea" id="hobbies" name="hobbies" rows="3" placeholder="e.g., Reading, Traveling, Music, Sports, Cooking..." disabled></textarea>
                             </div>
                            <div class="form-group full-width">
                                <label class="form-label">Address</label>
                                <textarea class="form-textarea" id="address" name="address" rows="1" disabled></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contact Number</label>
                                <input type="tel" class="form-input" id="contact" name="contact" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-input" id="email" name="email" required disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Username *</label>
                                <input type="text" class="form-input" id="username" name="username" required disabled>
                                <small class="form-help">You can change your username to something more personal</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Emergency Contact</label>
                                <input type="tel" class="form-input" id="emergency-contact" name="emergency-contact" disabled>
                            </div>
                        </div>
                        
                                                 <div class="section-title">Professional Information</div>
                         <div class="form-group full-width">
                             <label class="form-label">Introduction</label>
                             <textarea class="form-textarea" id="introduction" name="introduction" rows="3" placeholder="Tell us about yourself, your teaching philosophy, and what makes you unique as an educator..." disabled></textarea>
                         </div>
                         <div class="form-group full-width">
                             <label class="form-label">Teaching Experience</label>
                             <textarea class="form-textarea" id="experience" name="experience" rows="3" placeholder="Describe your teaching experience, subjects taught, years of experience..." disabled></textarea>
                         </div>
                    </div>
                    
                    <!-- Education Tab -->
                    <div id="education-tab" class="tab-content">
                        <div class="section-title">Education Details</div>
                        <div id="education-container">
                            <!-- Education items will be added here -->
                        </div>
                        <button type="button" class="add-btn" id="add-education-btn" onclick="addEducationItem()" disabled>+ Add Education</button>
                        
                        <div class="section-title" style="margin-top: 30px;">Work Experience</div>
                        <div id="work-experience-container">
                            <!-- Work experience items will be added here -->
                        </div>
                        <button type="button" class="add-btn" id="add-work-experience-btn" onclick="addWorkExperienceItem()" disabled>+ Add Work Experience</button>
                    </div>
                    
                    <!-- Documents Tab -->
                    <div id="documents-tab" class="tab-content">
                        <div class="section-title">Documents & Certificates</div>
                        <div style="background: #e3f2fd; border-left: 4px solid #667eea; padding: 12px 16px; margin-bottom: 24px; border-radius: 8px; color: #1976d2; font-size: 0.95rem;">
                            <strong>üí° Note:</strong> After uploading files, click the <strong>"Save Changes"</strong> button at the top to save all documents.
                        </div>
                        
                        <!-- Bulk Upload Section -->
                        <div class="info-section" style="margin-bottom: 32px;">
                            <div class="info-section-title">
                                <span>üì§ Bulk Upload</span>
                                <span style="font-size: 0.9rem; color: #666; font-weight: 400;">Drag & drop multiple files</span>
                            </div>
                            <div id="bulk-upload-zone" class="bulk-upload-zone" style="border: 3px dashed #667eea; border-radius: 12px; padding: 40px; text-align: center; background: #f0f8ff; cursor: pointer; transition: all 0.3s ease; margin-top: 12px;">
                                <input type="file" id="bulk-upload-input" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                                <div id="bulk-upload-content">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" style="margin: 0 auto 16px; display: block;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    <p style="margin: 0; color: #667eea; font-weight: 600; font-size: 1rem;">Drag & drop files here or click to browse</p>
                                    <p style="margin: 8px 0 0 0; color: #666; font-size: 0.85rem;">You can upload multiple files at once (PDF, JPG, PNG)</p>
                                </div>
                                <div id="bulk-upload-progress" style="display: none; margin-top: 16px;">
                                    <div style="background: #e0e6ed; border-radius: 8px; height: 8px; overflow: hidden;">
                                        <div id="bulk-upload-progress-bar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                                    </div>
                                    <p id="bulk-upload-status" style="margin: 8px 0 0 0; color: #666; font-size: 0.85rem;"></p>
                                </div>
                            </div>
                            <div id="bulk-upload-files-list" style="margin-top: 16px; display: none;">
                                <div style="background: #f8f9fa; border-radius: 8px; padding: 12px; max-height: 200px; overflow-y: auto;">
                                    <strong style="color: #667eea; font-size: 0.9rem;">Selected Files:</strong>
                                    <div id="bulk-files-list" style="margin-top: 8px;"></div>
                                </div>
                                <div style="margin-top: 12px; display: flex; gap: 8px;">
                                    <button type="button" class="add-btn" onclick="processBulkUpload()" style="flex: 1;">üìÅ Organize & Add Files</button>
                                    <button type="button" class="cancel-btn" onclick="clearBulkUpload()" style="flex: 1;">Clear All</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Document Categories Tabs -->
                        <div style="margin-bottom: 24px;">
                            <div style="display: flex; gap: 8px; border-bottom: 2px solid #e8f4fd; padding-bottom: 8px;">
                                <button type="button" class="doc-category-btn active" onclick="showDocumentCategory('diplomas')" data-category="diplomas">
                                    üìÑ Diplomas <span id="diploma-count-badge" class="doc-count-badge">0</span>
                                </button>
                                <button type="button" class="doc-category-btn" onclick="showDocumentCategory('certificates')" data-category="certificates">
                                    üèÜ Certificates <span id="certificate-count-badge" class="doc-count-badge">0</span>
                                </button>
                                <button type="button" class="doc-category-btn" onclick="showDocumentCategory('valid-id')" data-category="valid-id">
                                    üÜî Valid ID
                                </button>
                            </div>
                        </div>
                        
                        <!-- Diplomas Section (1-5 uploads) -->
                        <div class="info-section document-category" id="diplomas-category">
                            <div class="info-section-title">
                                <span>üìÑ Diplomas</span>
                                <span style="font-size: 0.9rem; color: #666; font-weight: 400;">(Up to 5)</span>
                            </div>
                            <div id="diplomas-container">
                                <!-- Diploma items will be added here dynamically -->
                            </div>
                            <button type="button" class="add-btn" id="add-diploma-btn" onclick="addDiplomaItem()" style="margin-top: 12px;">+ Add Diploma</button>
                        </div>
                        
                        <!-- Certificates Section (1-5 uploads) -->
                        <div class="info-section document-category" id="certificates-category" style="display: none; margin-top: 32px;">
                            <div class="info-section-title">
                                <span>üèÜ Certificates</span>
                                <span style="font-size: 0.9rem; color: #666; font-weight: 400;">(Up to 5)</span>
                            </div>
                            <div id="certificates-container">
                                <!-- Certificate items will be added here dynamically -->
                            </div>
                            <button type="button" class="add-btn" id="add-certificate-btn" onclick="addCertificateItem()" style="margin-top: 12px;">+ Add Certificate</button>
                        </div>
                        
                        <!-- Valid ID Section (single upload) -->
                        <div class="info-section document-category" id="valid-id-category" style="display: none; margin-top: 32px;">
                            <div class="info-section-title">üÜî Valid ID</div>
                            <div class="form-group">
                                <div class="file-upload" id="valid-id-upload">
                                    <input type="file" id="valid-id" name="valid-id" accept=".pdf,.jpg,.jpeg,.png" disabled>
                                    <label class="file-upload-label" for="valid-id">üÜî Upload Valid ID</label>
                                </div>
                                <div class="file-preview" id="valid-id-preview" style="display: none;">
                                    <img src="" alt="Valid ID Preview">
                                    <div class="file-info">No file selected</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Teaching Abilities Tab -->
                    <div id="teaching-abilities-tab" class="tab-content">
                        <div class="section-title">Teaching Abilities Assessment</div>
                        
                        <div class="assessment-notice">
                            <h4>Assessment-Based Leveling System</h4>
                            <p>Your teaching abilities are assessed objectively by our system based on your education level, certifications, work experience, performance indicators, and interview/trainer evaluations. Levels are automatically updated as you gain experience and improve your performance. This ensures accurate representation of your skills to help students find the perfect match.</p>
                        </div>

                        <!-- Listening Skills Assessment -->
                        <div class="skill-assessment-card">
                            <div class="skill-header">
                                <span class="skill-name">Listening Skills</span>
                                <div class="assessed-level" id="listening-level-badge">
                                    <span class="skill-stars" id="listening-stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                                    <span id="listening-level-text">Not Assessed</span>
                                </div>
                            </div>
                            
                            <div class="assessment-criteria" id="listening-criteria">
                                <h5>Assessment Criteria</h5>
                                <ul class="criteria-list" id="listening-criteria-list">
                                    <li class="criteria-item">Assessment pending - Complete your profile and interview to be evaluated</li>
                                </ul>
                            </div>
                            
                            <div class="assessment-source">
                                <span>Assessed by:</span>
                                <span class="assessment-source-badge" id="listening-source">Pending</span>
                            </div>
                            
                            <div class="teacher-description">
                                <label>Your Teaching Approach (Optional)</label>
                                <textarea class="form-textarea" id="listening-description" rows="3" placeholder="Describe your approach to teaching listening skills. This helps students understand your teaching style..." disabled></textarea>
                            </div>
                        </div>

                        <!-- Reading Skills Assessment -->
                        <div class="skill-assessment-card">
                            <div class="skill-header">
                                <span class="skill-name">Reading Skills</span>
                                <div class="assessed-level" id="reading-level-badge">
                                    <span class="skill-stars" id="reading-stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                                    <span id="reading-level-text">Not Assessed</span>
                                </div>
                            </div>
                            
                            <div class="assessment-criteria" id="reading-criteria">
                                <h5>Assessment Criteria</h5>
                                <ul class="criteria-list" id="reading-criteria-list">
                                    <li class="criteria-item">Assessment pending - Complete your profile and interview to be evaluated</li>
                                </ul>
                            </div>
                            
                            <div class="assessment-source">
                                <span>Assessed by:</span>
                                <span class="assessment-source-badge" id="reading-source">Pending</span>
                            </div>
                            
                            <div class="teacher-description">
                                <label>Your Teaching Approach (Optional)</label>
                                <textarea class="form-textarea" id="reading-description" rows="3" placeholder="Describe your approach to teaching reading skills. This helps students understand your teaching style..." disabled></textarea>
                            </div>
                        </div>

                        <!-- Speaking Skills Assessment -->
                        <div class="skill-assessment-card">
                            <div class="skill-header">
                                <span class="skill-name">Speaking Skills</span>
                                <div class="assessed-level" id="speaking-level-badge">
                                    <span class="skill-stars" id="speaking-stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                                    <span id="speaking-level-text">Not Assessed</span>
                                </div>
                            </div>
                            
                            <div class="assessment-criteria" id="speaking-criteria">
                                <h5>Assessment Criteria</h5>
                                <ul class="criteria-list" id="speaking-criteria-list">
                                    <li class="criteria-item">Assessment pending - Complete your profile and interview to be evaluated</li>
                                </ul>
                            </div>
                            
                            <div class="assessment-source">
                                <span>Assessed by:</span>
                                <span class="assessment-source-badge" id="speaking-source">Pending</span>
                            </div>
                            
                            <div class="teacher-description">
                                <label>Your Teaching Approach (Optional)</label>
                                <textarea class="form-textarea" id="speaking-description" rows="3" placeholder="Describe your approach to teaching speaking skills. This helps students understand your teaching style..." disabled></textarea>
                            </div>
                        </div>

                        <!-- Writing Skills Assessment -->
                        <div class="skill-assessment-card">
                            <div class="skill-header">
                                <span class="skill-name">Writing Skills</span>
                                <div class="assessed-level" id="writing-level-badge">
                                    <span class="skill-stars" id="writing-stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
                                    <span id="writing-level-text">Not Assessed</span>
                                </div>
                            </div>
                            
                            <div class="assessment-criteria" id="writing-criteria">
                                <h5>Assessment Criteria</h5>
                                <ul class="criteria-list" id="writing-criteria-list">
                                    <li class="criteria-item">Assessment pending - Complete your profile and interview to be evaluated</li>
                                </ul>
                            </div>
                            
                            <div class="assessment-source">
                                <span>Assessed by:</span>
                                <span class="assessment-source-badge" id="writing-source">Pending</span>
                            </div>
                            
                            <div class="teacher-description">
                                <label>Your Teaching Approach (Optional)</label>
                                <textarea class="form-textarea" id="writing-description" rows="3" placeholder="Describe your approach to teaching writing skills. This helps students understand your teaching style..." disabled></textarea>
                            </div>
                        </div>

                        <!-- Creativity & Hobbies -->
                        <div class="skill-assessment-card">
                            <div class="skill-header">
                                <span class="skill-name">Creativity & Hobbies</span>
                            </div>
                            
                            <div class="teacher-description">
                                <label>Share Your Interests</label>
                                <textarea class="form-textarea" id="creativity-hobbies" rows="4" placeholder="Share your creative pursuits, hobbies, and interests that make you unique. This helps students connect with you on a personal level..." disabled></textarea>
                                <small class="form-help" style="display: block; margin-top: 8px; color: #666; font-size: 0.85rem;">Your hobbies and creative interests help build rapport with students and showcase your personality.</small>
                            </div>
                        </div>

                        <div style="display: flex; gap: 8px; margin-top: 20px;">
                            <button type="button" class="edit-btn" id="edit-teaching-abilities-btn" onclick="enableTeachingAbilitiesEditing()">Edit Descriptions</button>
                            <button type="button" class="save-btn" id="save-teaching-abilities-btn" onclick="saveTeachingAbilities()" style="display: none;">Save Descriptions</button>
                            <button type="button" class="cancel-btn" id="cancel-teaching-abilities-btn" onclick="cancelTeachingAbilitiesEditing()" style="display: none;">Cancel</button>
                        </div>
                    </div>
                    
                    <!-- Support & Resources Tab -->
                    <div id="support-tab" class="tab-content">
                        <div class="section-title">Support & Resources</div>
                        <p style="color: #666; margin-bottom: 20px;">We're here to help you succeed! Access resources, training, and support to grow your teaching career.</p>
                        
                        <div class="support-grid">
                            <div class="support-card">
                                <div class="support-icon">üíª</div>
                                <h3>Technical Assistance</h3>
                                <p>Get help with platform features, troubleshooting, and technical issues.</p>
                                <button class="support-btn" onclick="openSupportModal('technical')">Get Technical Help</button>
                            </div>
                            
                            <div class="support-card">
                                <div class="support-icon">üìö</div>
                                <h3>Lesson Guidance</h3>
                                <p>Access lesson plans, teaching materials, and curriculum resources.</p>
                                <button class="support-btn" onclick="openSupportModal('lesson')">View Resources</button>
                            </div>
                            
                            <div class="support-card">
                                <div class="support-icon">üéì</div>
                                <h3>Teacher Training</h3>
                                <p>Enhance your skills with our comprehensive training programs.</p>
                                <button class="support-btn" onclick="openSupportModal('training')">Start Training</button>
                            </div>
                            
                            <div class="support-card">
                                <div class="support-icon">üèÜ</div>
                                <h3>Teacher Certification</h3>
                                <p>Earn certifications to advance your career and increase your rate.</p>
                                <button class="support-btn" onclick="openSupportModal('certification')">View Certifications</button>
                            </div>
                        </div>
                        
                        <div class="section-title" style="margin-top: 40px;">Quick Links</div>
                        <div class="quick-links">
                            <a href="#" class="quick-link" onclick="openSupportModal('faq')">‚ùì Frequently Asked Questions</a>
                            <a href="teacher-dashboard.html" class="quick-link">üåç Community & Social Responsibility</a>
                            <a href="#" class="quick-link" onclick="openSupportModal('webinars')">üìπ Training Webinars</a>
                            <a href="#" class="quick-link" onclick="openSupportModal('best-practices')">‚ú® Best Practices Guide</a>
                        </div>
                    </div>
                    
                    <!-- Settings Tab -->
                    <div id="settings-tab" class="tab-content">
                        <div class="section-title">Account Settings</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Current Email</label>
                                <input type="email" class="form-input" id="current-email" name="current-email" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Email</label>
                                <input type="email" class="form-input" id="new-email" name="new-email" placeholder="Enter new email address">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Username</label>
                                <input type="text" class="form-input" id="current-username" name="current-username" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Username</label>
                                <input type="text" class="form-input" id="new-username" name="new-username" placeholder="Enter new username">
                            </div>
                        </div>
                        
                        <div class="section-title">Change Password</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Current Password</label>
                                <input type="password" class="form-input" id="current-password" name="current-password" placeholder="Enter current password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" class="form-input" id="new-password" name="new-password" placeholder="Enter new password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" class="form-input" id="confirm-password" name="confirm-password" placeholder="Confirm new password">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <button type="button" class="save-btn" onclick="updateSettings()">Update Settings</button>
                            <button type="button" class="cancel-btn" onclick="resetSettingsForm()">Reset Form</button>
                            <button type="button" class="edit-btn" onclick="goToForgotPassword()">üîë Forgot Password</button>
                        </div>
                        
                        <div id="settings-message" style="margin-top: 10px;"></div>
                        
                        <div class="section-title" style="margin-top: 30px;">Legal & Policies</div>
                        <div class="legal-links">
                            <a href="/terms-of-service.html" target="_blank" class="legal-link">
                                üìÑ Terms of Service
                            </a>
                            <a href="/privacy-policy.html" target="_blank" class="legal-link">
                                üîí Privacy Policy
                            </a>
                        </div>
                        <p style="color: #666; font-size: 0.85rem; margin-top: 10px;">
                            As a freelance tutor, you are an independent contractor. Please review our terms and privacy policy to understand your rights and responsibilities.
                        </p>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Role-based access control
        const userType = localStorage.getItem('userType');
        if (userType !== 'teacher') {
            alert('Access denied. This page is for teachers only.');
            window.location.href = 'index.html';
        }

        let educationCounter = 0;
        let workExperienceCounter = 0;
        let diplomaCounter = 0;
        let certificateCounter = 0;
        let isEditingProfile = false;

        // Global variables for bulk upload
        let bulkUploadFiles = [];
        let isPreviewMode = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize profile completion indicator
            updateProfileCompletion();
            
            // Setup bulk upload drag and drop
            setupBulkUpload();
            
            // Setup document category tabs
            updateDocumentCounts();
            
            // Setup sidebar navigation links
            function setupSidebarNavigation() {
                const menuItems = document.querySelectorAll('.remoed-menu li');
                menuItems.forEach(item => {
                    const text = item.textContent.trim();
                    
                    // Remove existing onclick and add new one to ensure it works
                    item.onclick = null;
                    
                    if (text.includes('Dashboard')) {
                        item.onclick = () => window.location.href = 'teacher-dashboard.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Class Schedule')) {
                        item.onclick = () => window.location.href = 'teacher-class-table.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Class Configuration')) {
                        item.onclick = () => window.location.href = 'teacher-open-class.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Device Check')) {
                        item.onclick = () => window.location.href = 'device-check.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Teaching Fee')) {
                        item.onclick = () => window.location.href = 'teacher-service-fee.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Performance Indicator')) {
                        item.onclick = () => window.location.href = 'teacher-performance-indicator.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Professional Development')) {
                        item.onclick = () => window.location.href = 'teacher-professional-development.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Profile') && !text.includes('Support')) {
                        item.onclick = () => window.location.href = 'teacher-profile.html';
                        item.style.cursor = 'pointer';
                    } else if (text.includes('Logout')) {
                        item.onclick = () => {
                            localStorage.clear();
                            window.location.href = 'teacher-login.html';
                        };
                        item.style.cursor = 'pointer';
                    }
                });
            }
            
            // Shared function to update sidebar username and profile
            async function updateSidebarProfile() {
                const username = localStorage.getItem('remoedUsername') || 'Teacher';
                const teacherId = localStorage.getItem('teacherId');
                const token = localStorage.getItem('token');
                
                // Get username element (could be remoed-username or sidebar-email depending on page)
                const usernameEl = document.getElementById('remoed-username') || document.getElementById('sidebar-email');
                const avatarTextEl = document.getElementById('avatar-text');
                const profileImageEl = document.getElementById('profile-image');
                
                // Set initial values
                if (usernameEl) {
                    usernameEl.textContent = 'Loading...';
                }
                if (avatarTextEl) {
                    avatarTextEl.textContent = username[0].toUpperCase();
                }
                
                // Load profile to get firstName
                if (token && teacherId) {
                    try {
                        const response = await fetch('/api/teacher/profile', {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.profile) {
                                const firstName = data.profile.firstName || username;
                                
                                // Update username with "Hi, [FirstName]" format
                                if (usernameEl) {
                                    usernameEl.textContent = `Hi, ${firstName}`;
                                }
                                
                                // Update avatar
                                if (data.profile.profilePicture) {
                                    if (profileImageEl) {
                                        profileImageEl.src = data.profile.profilePicture;
                                        profileImageEl.style.display = 'block';
                                    }
                                    if (avatarTextEl) {
                                        avatarTextEl.style.display = 'none';
                                    }
                                } else {
                                    if (profileImageEl) {
                                        profileImageEl.style.display = 'none';
                                    }
                                    if (avatarTextEl) {
                                        avatarTextEl.textContent = firstName[0].toUpperCase();
                                        avatarTextEl.style.display = 'inline-block';
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error loading profile:', error);
                        // Fallback to username
                        if (usernameEl) {
                            usernameEl.textContent = `Hi, ${username}`;
                        }
                    }
                } else {
                    // Fallback if no token
                    if (usernameEl) {
                        usernameEl.textContent = `Hi, ${username}`;
                    }
                }
            }
            
            // Load sidebar
            fetch('teacher-dashboard.html')
                .then(r => r.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const sidebar = doc.querySelector('.remoed-sidebar');
                    if (sidebar) {
                        document.getElementById('sidebar').innerHTML = sidebar.innerHTML;
                        
                        // Setup all navigation links
                        setupSidebarNavigation();
                        
                        // Update active menu item - remove active from all first, then add to current page only
                        const menuItems = document.querySelectorAll('.remoed-menu li');
                        menuItems.forEach(item => {
                            item.classList.remove('active');
                            if (item.textContent.includes('Profile')) {
                                item.classList.add('active');
                            }
                        });
                        
                        // Update sidebar profile (username and picture)
                        updateSidebarProfile();
                    }
                })
                .catch(err => console.error('Error loading sidebar:', err));
            
            loadProfileData();
            setupFileUploads();
            setupFormSubmission();
            
            // Handle hash navigation (e.g., #support)
            if (window.location.hash) {
                const hash = window.location.hash.substring(1); // Remove the #
                if (hash === 'support') {
                    // Switch to support tab
                    setTimeout(() => {
                        const supportTabButton = Array.from(document.querySelectorAll('.tab-button')).find(btn => 
                            btn.textContent.includes('Support')
                        );
                        if (supportTabButton) {
                            supportTabButton.click();
                        } else {
                            // Fallback: directly show the tab
                            showTabDirectly('support');
                        }
                    }, 500); // Small delay to ensure page is loaded
                }
            }
        });
        
        // Helper function to show tab directly without event
        function showTabDirectly(tabName) {
            showTab(tabName, null);
        }

        function showTab(tabName, event) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Fallback: find button by tab name
                const buttons = document.querySelectorAll('.tab-button');
                buttons.forEach(button => {
                    if (button.textContent.includes(tabName.charAt(0).toUpperCase() + tabName.slice(1).replace('-', ' '))) {
                        button.classList.add('active');
                    }
                });
            }
        }

                 function loadProfileData() {
             // Load profile data from API
             const token = localStorage.getItem('token');
             console.log('Token from localStorage:', token ? 'Present' : 'Missing');
             
             if (!token) {
                 showMessage('Authentication required. Please login again.', 'error');
                 return;
             }
            
                         fetch('/api/teacher/profile', {
                 method: 'GET',
                 headers: {
                     'Authorization': `Bearer ${token}`,
                     'Content-Type': 'application/json'
                 }
             })
             .then(response => {
                 console.log('Profile API response status:', response.status);
                 return response.json();
             })
             .then(data => {
                 console.log('Profile API response data:', data);
                 if (data.success && data.profile) {
                    const profile = data.profile;
                    
                     // Set display values
                     const displayName = profile.fullname || `${profile.firstName || ''} ${profile.lastName || ''}`.trim() || profile.username || 'Teacher';
                     document.getElementById('profile-name-large').textContent = displayName;
                     document.getElementById('profile-email-large').textContent = profile.email || '';
                     
                     // Update sidebar quick info
                     updateSidebarQuickInfo(profile);
                     
                     // Update main profile avatar
                     updateProfileAvatar(profile);
                     
                     // Populate form fields
                     document.getElementById('firstname').value = profile.firstName || '';
                     document.getElementById('middlename').value = profile.middleName || '';
                     document.getElementById('lastname').value = profile.lastName || '';
                    document.getElementById('birthday').value = profile.birthday ? profile.birthday.split('T')[0] : '';
                    document.getElementById('gender').value = profile.gender || '';
                    document.getElementById('language').value = profile.language || '';
                    document.getElementById('hobbies').value = profile.hobbies || '';
                    document.getElementById('address').value = profile.address || '';
                    document.getElementById('contact').value = profile.contact || '';
                    document.getElementById('email').value = profile.email || '';
                    document.getElementById('username').value = profile.username || '';
                    document.getElementById('emergency-contact').value = profile.emergencyContact || '';
                    document.getElementById('introduction').value = profile.introduction || '';
                    document.getElementById('experience').value = profile.experience || '';
                    
                    // Load teaching abilities
                    loadTeachingAbilities(profile);
                    
                    // Load education items (only from real data, no mock/template rows)
                    const educationContainer = document.getElementById('education-container');
                    educationContainer.innerHTML = '';
                    educationCounter = 0;
                    if (profile.education && profile.education.length > 0) {
                        profile.education.forEach(edu => {
                            addEducationItem(edu);
                        });
                    }
                    
                    // Load work experience items (only from real data, no mock/template rows)
                    console.log('Loading work experience data:', profile.workExperience);
                    const workContainer = document.getElementById('work-experience-container');
                    workContainer.innerHTML = '';
                    workExperienceCounter = 0;
                    if (profile.workExperience && profile.workExperience.length > 0) {
                        profile.workExperience.forEach(work => {
                            console.log('Adding work experience item:', work);
                            addWorkExperienceItem(work);
                        });
                    }
                    
                     // Load profile picture
                     if (profile.profilePicture) {
                         const avatarImg = document.getElementById('profile-avatar-img');
                         const avatarText = document.getElementById('profile-avatar-text');
                         if (avatarImg) {
                             avatarImg.src = profile.profilePicture;
                             avatarImg.style.display = 'block';
                         }
                         if (avatarText) {
                             avatarText.style.display = 'none';
                         }
                     }
                     
                     // Load video introduction
                     if (profile.videoIntroduction) {
                         const videoPlayer = document.getElementById('video-player');
                         const videoSource = videoPlayer.querySelector('source');
                         videoSource.src = profile.videoIntroduction;
                         videoPlayer.load();
                         document.getElementById('video-name').textContent = profile.videoIntroductionFileName || 'Video Introduction';
                         document.getElementById('video-preview').style.display = 'block';
                     }
                    
                    // Load document previews
                    if (profile.documents) {
                        // Reset counters
                        diplomaCounter = 0;
                        certificateCounter = 0;
                        
                        // Clear existing containers
                        const diplomasContainer = document.getElementById('diplomas-container');
                        const certificatesContainer = document.getElementById('certificates-container');
                        if (diplomasContainer) diplomasContainer.innerHTML = '';
                        if (certificatesContainer) certificatesContainer.innerHTML = '';
                        
                        // Load multiple diplomas (up to 5)
                        if (profile.documents.diplomas && Array.isArray(profile.documents.diplomas) && profile.documents.diplomas.length > 0) {
                            console.log('Loading diplomas:', profile.documents.diplomas.length);
                            profile.documents.diplomas.forEach((diploma, index) => {
                                if (diploma && diploma.fileData && index < 5) {
                                    console.log(`Loading diploma ${index + 1}:`, diploma.fileName || 'Diploma');
                                    addDiplomaItem({ fileData: diploma.fileData, fileName: diploma.fileName || `Diploma ${index + 1}` });
                                }
                            });
                        } else if (profile.documents.diploma) {
                            // Legacy single diploma support - convert to new format
                            console.log('Loading legacy single diploma');
                            addDiplomaItem({ fileData: profile.documents.diploma, fileName: 'Diploma' });
                        } else {
                            console.log('No diplomas found in profile.documents:', profile.documents);
                        }
                        
                        // Load multiple certificates (up to 5)
                        if (profile.documents.certificates && Array.isArray(profile.documents.certificates) && profile.documents.certificates.length > 0) {
                            console.log('Loading certificates:', profile.documents.certificates.length);
                            profile.documents.certificates.forEach((certificate, index) => {
                                if (certificate && certificate.fileData && index < 5) {
                                    console.log(`Loading certificate ${index + 1}:`, certificate.fileName || 'Certificate');
                                    addCertificateItem({ fileData: certificate.fileData, fileName: certificate.fileName || `Certificate ${index + 1}` });
                                }
                            });
                        } else if (profile.documents.certifications && Array.isArray(profile.documents.certifications) && profile.documents.certifications.length > 0) {
                            // Legacy certifications support - convert to new format
                            console.log('Loading legacy certifications:', profile.documents.certifications.length);
                            profile.documents.certifications.forEach((cert, index) => {
                                if (cert && index < 5) {
                                    addCertificateItem({ fileData: cert, fileName: `Certificate ${index + 1}` });
                                }
                            });
                        } else {
                            console.log('No certificates found in profile.documents:', profile.documents);
                        }
                        
                        // Load valid ID (single)
                        if (profile.documents.validId) {
                            showDocumentPreview('valid-id-preview', profile.documents.validId, 'Valid ID');
                        }
                    }
                    
                    // Populate settings fields
                    document.getElementById('current-email').value = profile.email || '';
                    document.getElementById('current-username').value = profile.username || '';
                } else {
                    showMessage('Failed to load profile data', 'error');
                }
            })
                         .catch(error => {
                 console.error('Error loading profile:', error);
                 if (error.name === 'AbortError') {
                     showMessage('Profile loading timed out. Please try again.', 'error');
                 } else {
                     showMessage('Error loading profile data: ' + error.message, 'error');
                 }
             });
        }
        
        function showDocumentPreview(previewId, fileData, fileName) {
            const preview = document.getElementById(previewId);
            const previewImg = preview.querySelector('img');
            const fileInfo = preview.querySelector('.file-info');
            
            if (fileData.startsWith('data:image/')) {
                previewImg.src = fileData;
                previewImg.style.display = 'block';
                fileInfo.textContent = fileName;
                preview.style.display = 'block';
            } else {
                previewImg.style.display = 'none';
                fileInfo.textContent = fileName;
                preview.style.display = 'block';
            }
        }

        function setupFileUploads() {
            // Profile picture upload
            document.getElementById('profile-picture').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        showMessage('Authentication required. Please login again.', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const fileData = e.target.result;
                        
                        // Show preview immediately in main avatar
                        const avatarImg = document.getElementById('profile-avatar-img');
                        const avatarText = document.getElementById('profile-avatar-text');
                        if (avatarImg) {
                            avatarImg.src = fileData;
                            avatarImg.style.display = 'block';
                        }
                        if (avatarText) {
                            avatarText.style.display = 'none';
                        }
                        
                        // Save to database
                        fetch('/api/teacher/profile', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                profilePicture: fileData
                            })
                        })
                        .then(response => {
                            console.log('Profile picture upload response status:', response.status);
                            return response.json();
                        })
                        .then(data => {
                            console.log('Profile picture upload response data:', data);
                            if (data.success) {
                                console.log('Profile picture updated successfully');
                                showMessage('Profile picture updated successfully!', 'success');
                            } else {
                                console.error('Profile picture update failed:', data.error);
                                showMessage('Failed to update profile picture: ' + (data.error || 'Unknown error'), 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error updating profile picture:', error);
                            showMessage('Error updating profile picture: ' + error.message, 'error');
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
            
                         // Document uploads with preview (valid-id only, diplomas and certificates are handled dynamically)
             setupDocumentUpload('valid-id', 'valid-id-preview');
             
             // Video introduction upload
             setupVideoUpload();
             
             // Test server connectivity
             testVideoUploadEndpoint();
        }
        
        function setupDocumentUpload(inputId, previewId) {
            const input = document.getElementById(inputId);
            if (!input) {
                console.error('Input not found:', inputId);
                return;
            }
            
            const preview = document.getElementById(previewId);
            if (!preview) {
                console.error('Preview not found:', previewId);
                return;
            }
            
            const previewImg = preview.querySelector('img');
            const fileInfo = preview.querySelector('.file-info');
            
            // Remove any existing event listeners by cloning the input
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);
            
            newInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const token = localStorage.getItem('token');
                    console.log('Document upload - Token:', token ? 'Present' : 'Missing');
                    console.log('Document upload - File:', file.name, file.type, file.size);
                    console.log('Document upload - Preview ID:', previewId);
                    
                    if (!token) {
                        showMessage('Authentication required. Please login again.', 'error');
                        // Reset input
                        e.target.value = '';
                        return;
                    }
                    
                    // Check if it's an image file
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const fileData = e.target.result;
                            console.log('Document upload - File data length:', fileData.length);
                            console.log('Document upload - File data preview:', fileData.substring(0, 50) + '...');
                            
                            // Replace existing preview (this handles replacement correctly)
                            if (previewImg) {
                                previewImg.src = fileData;
                                previewImg.style.display = 'block';
                                previewImg.alt = file.name;
                                previewImg.onload = function() {
                                    console.log('Preview image loaded successfully');
                                };
                                previewImg.onerror = function() {
                                    console.error('Preview image failed to load');
                                };
                                console.log('Preview image src set to:', previewImg.src.substring(0, 50) + '...');
                                console.log('Preview image src length:', previewImg.src.length);
                            }
                            if (fileInfo) {
                                fileInfo.textContent = file.name;
                                console.log('File info set to:', file.name);
                            }
                            
                            // Force preview to be visible (works for both old and new compact layout)
                            preview.style.display = 'block';
                            preview.style.visibility = 'visible';
                            
                            // If it's a compact preview, ensure it's visible
                            if (preview.classList.contains('document-preview-compact')) {
                                preview.style.display = 'block';
                            }
                            
                            // Double-check visibility after a short delay
                            setTimeout(() => {
                                const isVisible = preview.style.display !== 'none' && preview.offsetParent !== null;
                                const hasValidSrc = previewImg && previewImg.src && previewImg.src.startsWith('data:') && previewImg.src.length > 100;
                                console.log('Preview visibility check:', {
                                    id: preview.id,
                                    display: preview.style.display,
                                    offsetParent: preview.offsetParent !== null,
                                    isVisible,
                                    hasValidSrc,
                                    srcLength: previewImg ? previewImg.src.length : 0
                                });
                                
                                if (!isVisible || !hasValidSrc) {
                                    console.error('‚ö†Ô∏è Preview not properly set up!', {
                                        id: preview.id,
                                        display: preview.style.display,
                                        offsetParent: preview.offsetParent !== null,
                                        src: previewImg ? previewImg.src.substring(0, 50) : 'no img'
                                    });
                                }
                            }, 100);
                            
                            // Update label to show "Replace" instead of "Upload" if preview already exists
                            const label = document.querySelector(`label[for="${inputId}"]`);
                            if (label && preview.style.display !== 'none') {
                                const labelText = label.textContent;
                                if (labelText.includes('Upload')) {
                                    label.textContent = labelText.replace('Upload', 'Replace');
                                }
                            }
                            
                            console.log('File selected successfully:', file.name, '- Click "Save Changes" to save all documents');
                            console.log('Preview element:', {
                                id: preview.id,
                                display: preview.style.display,
                                offsetParent: preview.offsetParent !== null,
                                imgSrc: previewImg ? previewImg.src.substring(0, 50) : 'no img'
                            });
                        };
                        reader.onerror = function() {
                            console.error('FileReader error:', reader.error);
                            showMessage('Error reading file. Please try again.', 'error');
                            e.target.value = '';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // For PDF or other files, show file info only
                        if (previewImg) {
                            previewImg.style.display = 'none';
                        }
                        if (fileInfo) {
                            fileInfo.textContent = file.name;
                        }
                        preview.style.display = 'block';
                        
                        // Note: For non-image files, you might want to handle them differently
                        showMessage('Only image files are currently supported for preview', 'error');
                    }
                } else {
                    // If no file selected, keep existing preview if it exists
                    if (previewImg && !previewImg.src) {
                        preview.style.display = 'none';
                    }
                }
            });
        }

        function setupFormSubmission() {
            // Add explicit event listener for save button
            const saveBtn = document.getElementById('save-profile-btn');
            if (saveBtn) {
                saveBtn.addEventListener('click', function(e) {
                    console.log('üîç Save button clicked');
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üîç Save button event prevented, calling saveProfile');
                    saveProfile();
                });
            } else {
                console.log('Save button not found, skipping event listener setup');
            }
        }

        function addEducationItem(data = null) {
            const container = document.getElementById('education-container');
            const itemId = `education-${educationCounter++}`;
            const disabledAttr = isEditingProfile ? '' : 'disabled';
            
            const educationItem = document.createElement('div');
            educationItem.className = 'education-item';
            educationItem.id = itemId;
            
            educationItem.innerHTML = `
                <div class="education-header">
                    <strong>Education ${educationCounter}</strong>
                    <button type="button" class="remove-btn" onclick="removeEducationItem('${itemId}')">Remove</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Degree/Course</label>
                        <input type="text" class="form-input" name="degree" value="${data ? data.degree : ''}" placeholder="e.g., Bachelor of Education" ${disabledAttr}>
                    </div>
                    <div class="form-group">
                        <label class="form-label">School/University</label>
                        <input type="text" class="form-input" name="school" value="${data ? data.school : ''}" placeholder="e.g., University of the Philippines" ${disabledAttr}>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Year Graduated</label>
                        <input type="number" class="form-input" name="yearGraduated" value="${data ? data.yearGraduated : ''}" min="1950" max="2030" placeholder="e.g., 2020" ${disabledAttr}>
                    </div>
                    <div class="form-group">
                        <label class="form-label">GPA (Optional)</label>
                        <input type="number" class="form-input" name="gpa" value="${data ? data.gpa : ''}" step="0.01" min="1.0" max="4.0" placeholder="e.g., 3.5" ${disabledAttr}>
                    </div>
                </div>
            `;
            
            container.appendChild(educationItem);
        }

        function removeEducationItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
            }
        }

        function addWorkExperienceItem(data = null) {
            const container = document.getElementById('work-experience-container');
            const itemId = `work-experience-${workExperienceCounter++}`;
            const disabledAttr = isEditingProfile ? '' : 'disabled';
            
            const workExperienceItem = document.createElement('div');
            workExperienceItem.className = 'work-experience-item';
            workExperienceItem.id = itemId;
            
            workExperienceItem.innerHTML = `
                <div class="work-experience-header">
                    <strong>Work Experience ${workExperienceCounter}</strong>
                    <button type="button" class="remove-btn" onclick="removeWorkExperienceItem('${itemId}')">Remove</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Company</label>
                        <input type="text" class="form-input" name="company" value="${data ? data.company : ''}" placeholder="e.g., ABC Company" ${disabledAttr}>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-input" name="jobTitle" value="${data ? data.jobTitle : ''}" placeholder="e.g., Software Engineer" ${disabledAttr}>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration</label>
                        <input type="text" class="form-input" name="duration" value="${data ? data.duration : ''}" placeholder="e.g., 2020-2023" ${disabledAttr}>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-textarea" name="jobDescription" rows="3" placeholder="Describe your role, responsibilities, and achievements..." ${disabledAttr}>${data ? data.jobDescription : ''}</textarea>
                    </div>
                </div>
            `;
            
            container.appendChild(workExperienceItem);
        }

        function removeWorkExperienceItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
            }
        }
        
        // Diploma management functions
        function addDiplomaItem(data = null) {
            // If not in edit mode, enable editing first
            if (!isEditingProfile && data === null) {
                enableEditing();
            }
            
            const container = document.getElementById('diplomas-container');
            if (!container) {
                console.error('Diplomas container not found');
                return;
            }
            
            // Check limit (max 5) - but allow loading saved data
            const currentCount = container.children.length;
            if (currentCount >= 5 && data === null) {
                showMessage('Maximum of 5 diplomas allowed', 'error');
                return;
            }
            
            const itemId = `diploma-${diplomaCounter++}`;
            const disabledAttr = isEditingProfile ? '' : 'disabled';
            const displayNumber = currentCount + 1;
            
            const diplomaItem = document.createElement('div');
            diplomaItem.className = 'document-item';
            diplomaItem.id = itemId;
            
            diplomaItem.innerHTML = `
                <div class="document-header">
                    <strong>Diploma ${displayNumber}</strong>
                    <button type="button" class="remove-btn" onclick="removeDiplomaItem('${itemId}')" style="padding: 4px 8px; font-size: 0.75rem;">Remove</button>
                </div>
                <div class="document-content">
                    <div class="document-upload-compact">
                        <div class="file-upload" id="diploma-upload-${itemId}">
                            <input type="file" id="diploma-file-${itemId}" name="diploma-${itemId}" accept=".pdf,.jpg,.jpeg,.png" ${disabledAttr}>
                            <label class="file-upload-label-compact" for="diploma-file-${itemId}">üìÑ Upload</label>
                        </div>
                    </div>
                    <div class="document-preview-compact" id="diploma-preview-${itemId}" style="display: ${data && data.fileData ? 'block' : 'none'};">
                        <img src="${data && data.fileData ? data.fileData : ''}" alt="Diploma Preview">
                        <div class="file-info">${data && data.fileName ? data.fileName : 'No file selected'}</div>
                    </div>
                </div>
            `;
            
            container.appendChild(diplomaItem);
            
            // If data provided, ensure preview is shown
            if (data && data.fileData) {
                setTimeout(() => {
                    const preview = document.getElementById(`diploma-preview-${itemId}`);
                    if (preview) {
                        const previewImg = preview.querySelector('img');
                        const fileInfo = preview.querySelector('.file-info');
                        if (previewImg) {
                            previewImg.src = data.fileData;
                            previewImg.style.display = 'block';
                        }
                        if (fileInfo) {
                            fileInfo.textContent = data.fileName || 'Diploma';
                        }
                        preview.style.display = 'block';
                    }
                }, 50);
            }
            
            // Setup file upload for this diploma (always set up, editing is auto-enabled if needed)
            setTimeout(() => {
                setupDocumentUpload(`diploma-file-${itemId}`, `diploma-preview-${itemId}`);
            }, 150);
        }
        
        function removeDiplomaItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
                // Update counter based on remaining items
                const container = document.getElementById('diplomas-container');
                if (container) {
                    diplomaCounter = container.children.length;
                }
            }
        }
        
        // Certificate management functions
        function addCertificateItem(data = null) {
            // If not in edit mode, enable editing first (but not when loading saved data)
            if (!isEditingProfile && data === null) {
                enableEditing();
            }
            
            const container = document.getElementById('certificates-container');
            if (!container) {
                console.error('Certificates container not found');
                return;
            }
            
            // Check limit (max 5) - but allow loading saved data
            const currentCount = container.children.length;
            if (currentCount >= 5 && data === null) {
                showMessage('Maximum of 5 certificates allowed', 'error');
                return;
            }
            
            const itemId = `certificate-${certificateCounter++}`;
            const disabledAttr = isEditingProfile ? '' : 'disabled';
            const displayNumber = currentCount + 1;
            
            const certificateItem = document.createElement('div');
            certificateItem.className = 'document-item';
            certificateItem.id = itemId;
            
            certificateItem.innerHTML = `
                <div class="document-header">
                    <strong>Certificate ${displayNumber}</strong>
                    <button type="button" class="remove-btn" onclick="removeCertificateItem('${itemId}')" style="padding: 4px 8px; font-size: 0.75rem;">Remove</button>
                </div>
                <div class="document-content">
                    <div class="document-upload-compact">
                        <div class="file-upload" id="certificate-upload-${itemId}">
                            <input type="file" id="certificate-file-${itemId}" name="certificate-${itemId}" accept=".pdf,.jpg,.jpeg,.png" ${disabledAttr}>
                            <label class="file-upload-label-compact" for="certificate-file-${itemId}">üèÜ Upload</label>
                        </div>
                    </div>
                    <div class="document-preview-compact" id="certificate-preview-${itemId}" style="display: ${data && data.fileData ? 'block' : 'none'};">
                        <img src="${data && data.fileData ? data.fileData : ''}" alt="Certificate Preview">
                        <div class="file-info">${data && data.fileName ? data.fileName : 'No file selected'}</div>
                    </div>
                </div>
            `;
            
            container.appendChild(certificateItem);
            
            // If data provided, ensure preview is shown
            if (data && data.fileData) {
                setTimeout(() => {
                    const preview = document.getElementById(`certificate-preview-${itemId}`);
                    if (preview) {
                        const previewImg = preview.querySelector('img');
                        const fileInfo = preview.querySelector('.file-info');
                        if (previewImg) {
                            previewImg.src = data.fileData;
                            previewImg.style.display = 'block';
                        }
                        if (fileInfo) {
                            fileInfo.textContent = data.fileName || 'Certificate';
                        }
                        preview.style.display = 'block';
                    }
                }, 50);
            }
            
            // Setup file upload for this certificate (always set up, editing is auto-enabled if needed)
            setTimeout(() => {
                setupDocumentUpload(`certificate-file-${itemId}`, `certificate-preview-${itemId}`);
            }, 150);
        }
        
        function removeCertificateItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.remove();
                // Update counter based on remaining items
                const container = document.getElementById('certificates-container');
                if (container) {
                    certificateCounter = container.children.length;
                }
            }
        }

        function saveProfile() {
            console.log('üîç saveProfile function called');
            const saveBtn = document.getElementById('save-profile-btn');
            if (!saveBtn) {
                console.error('Save button not found');
                return;
            }
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            
            const token = localStorage.getItem('token');
            console.log('Profile save - Token:', token ? 'Present' : 'Missing');
            
            if (!token) {
                showMessage('Authentication required. Please login again.', 'error');
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Changes';
                return;
            }
            
            // Collect form data BEFORE disabling fields
            console.log('üîç Collecting form data...');
            // Since we no longer have a form, collect data directly from input elements
             const firstName = document.getElementById('firstname').value;
             const middleName = document.getElementById('middlename').value;
             const lastName = document.getElementById('lastname').value;
             const fullname = `${firstName} ${middleName} ${lastName}`.trim();
             
             const profileData = {
                 firstName: firstName,
                 middleName: middleName,
                 lastName: lastName,
                 fullname: fullname,
                birthday: document.getElementById('birthday').value,
                gender: document.getElementById('gender').value,
                language: document.getElementById('language').value,
                hobbies: document.getElementById('hobbies').value,
                address: document.getElementById('address').value,
                contact: document.getElementById('contact').value,
                email: document.getElementById('email').value,
                username: document.getElementById('username').value,
                emergencyContact: document.getElementById('emergency-contact').value,
                introduction: document.getElementById('introduction').value,
                experience: document.getElementById('experience').value,
                                 education: collectEducationData(),
                 workExperience: collectWorkExperienceData(),
                 profilePicture: document.getElementById('profile-avatar-img')?.src || null,
                 videoIntroduction: document.getElementById('video-player').querySelector('source').src || null,
                 videoIntroductionFileName: document.getElementById('video-name').textContent !== 'No video selected' ? document.getElementById('video-name').textContent : null,
                documents: (function() {
                    console.log('=== COLLECTING DOCUMENTS ===');
                    const diplomas = collectDiplomasData();
                    const certificates = collectCertificatesData();
                    
                    // Collect valid ID
                    const validIdPreview = document.getElementById('valid-id-preview');
                    console.log('Valid ID preview element:', {
                        found: !!validIdPreview,
                        id: validIdPreview ? validIdPreview.id : 'not found',
                        display: validIdPreview ? validIdPreview.style.display : 'N/A',
                        offsetParent: validIdPreview ? (validIdPreview.offsetParent !== null) : 'N/A'
                    });
                    
                    const validIdImg = validIdPreview ? validIdPreview.querySelector('img') : null;
                    console.log('Valid ID img element:', {
                        found: !!validIdImg,
                        hasSrc: validIdImg ? !!validIdImg.src : false,
                        srcLength: validIdImg && validIdImg.src ? validIdImg.src.length : 0,
                        srcStart: validIdImg && validIdImg.src ? validIdImg.src.substring(0, 50) : 'no src',
                        startsWithData: validIdImg && validIdImg.src ? validIdImg.src.startsWith('data:') : false
                    });
                    
                    // Collect valid ID if image has valid base64 data (same logic as diplomas/certificates)
                    let validId = null;
                    if (validIdImg && validIdImg.src) {
                        const src = validIdImg.src;
                        const isValid = src.startsWith('data:') && 
                                   !src.includes('data:image/svg+xml') &&
                                   src.length > 100;
                        
                        console.log('Valid ID validation:', {
                            hasSrc: true,
                            startsWithData: src.startsWith('data:'),
                            notSvg: !src.includes('data:image/svg+xml'),
                            hasLength: src.length > 100,
                            isValid: isValid,
                            srcLength: src.length
                        });
                        
                        if (isValid) {
                            validId = src;
                            console.log('‚úì Valid ID collected successfully - Data length:', validId.length);
                        } else {
                            console.log('‚úó Valid ID failed validation checks');
                        }
                    } else {
                        console.log('‚úó Valid ID not collected - no image element or no src');
                    }
                    
                    console.log('=== FINAL DOCUMENTS SUMMARY ===');
                    console.log('Diplomas:', diplomas.length);
                    console.log('Certificates:', certificates.length);
                    console.log('Valid ID:', validId ? `Present (${validId.length} chars)` : 'Missing');
                    console.log('Final documents object structure:', {
                        diplomas: diplomas.length,
                        certificates: certificates.length,
                        hasValidId: !!validId
                    });
                    
                    return {
                        diplomas: diplomas,
                        certificates: certificates,
                        validId: validId
                    };
                })()
            };
            
            console.log('Saving profile data:', profileData);
            console.log('Documents being saved:', JSON.stringify(profileData.documents, null, 2));
            console.log('Diplomas count:', profileData.documents.diplomas ? profileData.documents.diplomas.length : 0);
            console.log('Certificates count:', profileData.documents.certificates ? profileData.documents.certificates.length : 0);
            console.log('Diplomas data:', profileData.documents.diplomas);
            console.log('Certificates data:', profileData.documents.certificates);
            
            // Validate that fileData is base64
            if (profileData.documents.diplomas && profileData.documents.diplomas.length > 0) {
                profileData.documents.diplomas.forEach((diploma, index) => {
                    if (!diploma.fileData || !diploma.fileData.startsWith('data:')) {
                        console.error(`‚ùå Diploma ${index + 1} has invalid fileData (not base64):`, diploma.fileData ? diploma.fileData.substring(0, 50) : 'missing');
                    } else {
                        console.log(`‚úì Diploma ${index + 1} has valid base64 data, length:`, diploma.fileData.length);
                    }
                });
            }
            
            if (profileData.documents.certificates && profileData.documents.certificates.length > 0) {
                profileData.documents.certificates.forEach((cert, index) => {
                    if (!cert.fileData || !cert.fileData.startsWith('data:')) {
                        console.error(`‚ùå Certificate ${index + 1} has invalid fileData (not base64):`, cert.fileData ? cert.fileData.substring(0, 50) : 'missing');
                    } else {
                        console.log(`‚úì Certificate ${index + 1} has valid base64 data, length:`, cert.fileData.length);
                    }
                });
            }
            
            // Validate documents before saving
            if (profileData.documents.diplomas && profileData.documents.diplomas.length > 0) {
                profileData.documents.diplomas.forEach((diploma, index) => {
                    if (!diploma.fileData || !diploma.fileData.startsWith('data:')) {
                        console.error(`Diploma ${index + 1} has invalid fileData:`, diploma);
                    }
                });
            }
            
            if (profileData.documents.certificates && profileData.documents.certificates.length > 0) {
                profileData.documents.certificates.forEach((cert, index) => {
                    if (!cert.fileData || !cert.fileData.startsWith('data:')) {
                        console.error(`Certificate ${index + 1} has invalid fileData:`, cert);
                    }
                });
            }
            
            console.log('Work experience data being saved:', profileData.workExperience);
            console.log('firstName being saved:', profileData.firstName);
            console.log('Form firstName value:', document.getElementById('firstname').value);
            console.log('Form firstName disabled:', document.getElementById('firstname').disabled);
            console.log('email being saved:', profileData.email);
            console.log('Form email value:', document.getElementById('email').value);
            
            // Save to database
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout for profile save
            
            fetch('/api/teacher/profile', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(profileData),
                signal: controller.signal
            })
            .then(async response => {
                clearTimeout(timeoutId);
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Profile save failed:', response.status, response.statusText, errorText);
                    throw new Error(`Server error: ${response.status} - ${errorText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Profile update response:', data);
                console.log('Response profile object:', data.profile);
                console.log('Response documents:', data.profile?.documents);
                console.log('Response documents type:', typeof data.profile?.documents);
                console.log('Response documents keys:', data.profile?.documents ? Object.keys(data.profile.documents) : 'no documents');
                
                // Check for diplomas and certificates with multiple access patterns
                const diplomas = data.profile?.documents?.diplomas || 
                                data.profile?.documents?.diploma ? [data.profile.documents.diploma] : 
                                undefined;
                const certificates = data.profile?.documents?.certificates || 
                                    data.profile?.documents?.certifications || 
                                    undefined;
                
                console.log('Response diplomas (after fallback):', diplomas);
                console.log('Response diplomas count:', diplomas ? (Array.isArray(diplomas) ? diplomas.length : 1) : 0);
                console.log('Response certificates (after fallback):', certificates);
                console.log('Response certificates count:', certificates ? (Array.isArray(certificates) ? certificates.length : 1) : 0);
                
                if (data.success) {
                    // Verify documents were saved
                    if (data.profile?.documents) {
                        const savedDiplomas = Array.isArray(diplomas) ? diplomas.length : (diplomas ? 1 : 0);
                        const savedCertificates = Array.isArray(certificates) ? certificates.length : (certificates ? 1 : 0);
                        const sentDiplomas = profileData.documents.diplomas?.length || 0;
                        const sentCertificates = profileData.documents.certificates?.length || 0;
                        
                        console.log('Documents save verification:', {
                            sentDiplomas,
                            savedDiplomas,
                            sentCertificates,
                            savedCertificates,
                            match: savedDiplomas === sentDiplomas && savedCertificates === sentCertificates,
                            diplomasType: Array.isArray(diplomas) ? 'array' : typeof diplomas,
                            certificatesType: Array.isArray(certificates) ? 'array' : typeof certificates
                        });
                        
                        if (savedDiplomas !== sentDiplomas || savedCertificates !== sentCertificates) {
                            console.warn('‚ö†Ô∏è Document count mismatch! Some documents may not have been saved.');
                            console.warn('Full response for debugging:', JSON.stringify(data.profile?.documents, null, 2));
                            showMessage(`Warning: ${sentDiplomas - savedDiplomas} diploma(s) and ${sentCertificates - savedCertificates} certificate(s) may not have been saved.`, 'error');
                        } else if (savedDiplomas > 0 || savedCertificates > 0) {
                            showMessage(`Successfully saved ${savedDiplomas} diploma(s) and ${savedCertificates} certificate(s)!`, 'success');
                        }
                    } else {
                        console.error('‚ùå No documents object in response!');
                        console.error('Full response:', JSON.stringify(data, null, 2));
                    }
                    // Update display
                    const displayName = profileData.fullname || `${profileData.firstName || ''} ${profileData.lastName || ''}`.trim() || profileData.username || 'Teacher';
                    document.getElementById('profile-name-large').textContent = displayName;
                    document.getElementById('profile-email-large').textContent = profileData.email || '';
                    updateSidebarQuickInfo(profileData);
                    updateProfileAvatar(profileData);
                    
                    // Update token and localStorage if username was changed
                    if (data.newToken) {
                        localStorage.setItem('token', data.newToken);
                        console.log('Token updated due to username change');
                        
                        // Update localStorage with new username
                        if (profileData.username) {
                            localStorage.setItem('remoedUsername', profileData.username);
                            console.log('LocalStorage username updated to:', profileData.username);
                        }
                    }
                    
                    // Always update sidebar first name in real-time if dashboard is open
                    if (profileData.firstName) {
                        updateSidebarUsername(profileData.firstName);
                        console.log('‚úÖ Sidebar update called with firstName:', profileData.firstName);
                    } else {
                        console.log('‚ùå No firstName found in profileData:', profileData);
                    }
                    
                    // Disable editing after successful save
                    isEditingProfile = false;
                    const inputs = document.querySelectorAll('.form-input, .form-textarea');
                    inputs.forEach(input => input.disabled = true);
                    
                    const fileInputs = document.querySelectorAll('input[type="file"]');
                    fileInputs.forEach(input => input.disabled = true);
                    
                    document.getElementById('add-education-btn').disabled = true;
                    document.getElementById('add-work-experience-btn').disabled = true;
                    
                    // Show/hide buttons in header
                    document.getElementById('edit-profile-btn').style.display = 'inline-block';
                    document.getElementById('cancel-edit-btn').style.display = 'none';
                    document.getElementById('save-profile-btn').style.display = 'none';
                    
                    // Show success message
                    showMessage('Profile updated successfully!', 'success');
                    
                    // If response includes profile data, use it directly; otherwise reload
                    if (data.profile) {
                        console.log('Response profile exists, checking documents...');
                        console.log('Response profile documents:', data.profile.documents);
                        
                        if (data.profile.documents) {
                            console.log('Using response data to update documents display');
                            // Update documents display directly from response
                            const diplomasContainer = document.getElementById('diplomas-container');
                            const certificatesContainer = document.getElementById('certificates-container');
                            if (diplomasContainer) diplomasContainer.innerHTML = '';
                            if (certificatesContainer) certificatesContainer.innerHTML = '';
                            
                            diplomaCounter = 0;
                            certificateCounter = 0;
                            
                            // Load diplomas from response data
                            const diplomas = data.profile.documents.diplomas || 
                                          (data.profile.documents.diploma ? [{ fileData: data.profile.documents.diploma, fileName: 'Diploma' }] : []);
                            
                            if (Array.isArray(diplomas) && diplomas.length > 0) {
                                console.log('Loading', diplomas.length, 'diplomas from response');
                                diplomas.forEach((diploma) => {
                                    if (diploma && diploma.fileData) {
                                        addDiplomaItem({ fileData: diploma.fileData, fileName: diploma.fileName || 'Diploma' });
                                    }
                                });
                            } else {
                                console.log('No diplomas in response');
                            }
                            
                            // Load certificates from response data
                            const certificates = data.profile.documents.certificates || 
                                              (data.profile.documents.certifications || []);
                            
                            if (Array.isArray(certificates) && certificates.length > 0) {
                                console.log('Loading', certificates.length, 'certificates from response');
                                certificates.forEach((certificate) => {
                                    // Handle both new format (object with fileData/fileName) and legacy format (string)
                                    if (certificate) {
                                        if (typeof certificate === 'string') {
                                            // Legacy format - just a string
                                            addCertificateItem({ fileData: certificate, fileName: 'Certificate' });
                                        } else if (certificate.fileData) {
                                            // New format - object with fileData and fileName
                                            addCertificateItem({ fileData: certificate.fileData, fileName: certificate.fileName || 'Certificate' });
                                        }
                                    }
                                });
                            } else {
                                console.log('No certificates in response');
                            }
                        } else {
                            console.log('No documents object in response profile');
                        }
                    } else {
                        // Reload profile data to reflect changes (with delay to ensure backend has saved)
                        console.log('No profile data in response, reloading from API');
                        setTimeout(() => {
                            loadProfileData();
                        }, 500);
                    }
                } else {
                    showMessage(data.error || 'Failed to update profile', 'error');
                }
            })
            .catch(error => {
                clearTimeout(timeoutId);
                console.error('Error saving profile:', error);
                if (error.name === 'AbortError') {
                    showMessage('Profile save timed out. Please try again.', 'error');
                } else {
                    showMessage('Error updating profile: ' + error.message, 'error');
                }
            })
            .finally(() => {
                clearTimeout(timeoutId);
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Changes';
            });
        }



        function collectEducationData() {
            const educationItems = document.querySelectorAll('.education-item');
            const educationData = [];
            
            educationItems.forEach(item => {
                const inputs = item.querySelectorAll('input');
                const education = {};
                
                inputs.forEach(input => {
                    education[input.name] = input.value;
                });
                
                // Only push if user actually entered something
                if (education.degree || education.school || education.yearGraduated || education.gpa) {
                    educationData.push(education);
                }
            });
            
            return educationData;
        }

        function collectWorkExperienceData() {
            const workExperienceItems = document.querySelectorAll('.work-experience-item');
            const workExperienceData = [];
            
            console.log('Collecting work experience data from', workExperienceItems.length, 'items');
            
            workExperienceItems.forEach((item, index) => {
                const inputs = item.querySelectorAll('input, textarea');
                const workExperience = {};
                
                inputs.forEach(input => {
                    workExperience[input.name] = input.value;
                });
                
                console.log(`Work experience item ${index + 1}:`, workExperience);
                
                if (workExperience.company || workExperience.jobTitle) {
                    workExperienceData.push(workExperience);
                    console.log(`Added work experience item ${index + 1} to data`);
                } else {
                    console.log(`Skipped work experience item ${index + 1} (no company or job title)`);
                }
            });
            
            console.log('Final work experience data:', workExperienceData);
            return workExperienceData;
        }
        
        function collectDiplomasData() {
            const diplomas = [];
            
            // Get all diploma previews
            document.querySelectorAll('[id^="diploma-preview-"]').forEach(preview => {
                const previewImg = preview.querySelector('img');
                const fileInfo = preview.querySelector('.file-info');
                
                // Check if preview exists
                if (!preview || !previewImg) {
                    console.log('Skipping diploma preview - missing elements');
                    return;
                }
                
                // Check if image has valid base64 data - this is the key check
                const hasImage = previewImg.src && 
                                previewImg.src !== '' && 
                                previewImg.src.startsWith('data:') && 
                                !previewImg.src.includes('data:image/svg+xml') &&
                                previewImg.src.length > 100; // Base64 data should be substantial
                
                console.log('Diploma preview check:', {
                    id: preview.id,
                    hasImage,
                    srcLength: previewImg.src ? previewImg.src.length : 0,
                    srcStart: previewImg.src ? previewImg.src.substring(0, 50) : 'no src',
                    display: preview.style.display,
                    offsetParent: preview.offsetParent !== null
                });
                
                // Collect if image data exists - don't require visibility check as it might be in a hidden tab
                if (hasImage) {
                    const fileName = fileInfo && fileInfo.textContent && fileInfo.textContent !== 'No file selected' 
                        ? fileInfo.textContent 
                        : `Diploma ${diplomas.length + 1}`;
                    
                    diplomas.push({
                        fileData: previewImg.src,
                        fileName: fileName
                    });
                    console.log('‚úì Added diploma:', fileName, '- Data length:', previewImg.src.length);
                } else {
                    console.log('‚úó Skipping diploma - no valid image data');
                }
            });
            
            console.log('Collected diplomas:', diplomas.length, diplomas);
            return diplomas;
        }
        
        function collectCertificatesData() {
            const certificates = [];
            
            // Get all certificate previews
            document.querySelectorAll('[id^="certificate-preview-"]').forEach(preview => {
                const previewImg = preview.querySelector('img');
                const fileInfo = preview.querySelector('.file-info');
                
                // Check if preview exists
                if (!preview || !previewImg) {
                    console.log('Skipping certificate preview - missing elements');
                    return;
                }
                
                // Check if image has valid base64 data - this is the key check
                const hasImage = previewImg.src && 
                                previewImg.src !== '' && 
                                previewImg.src.startsWith('data:') && 
                                !previewImg.src.includes('data:image/svg+xml') &&
                                previewImg.src.length > 100; // Base64 data should be substantial
                
                console.log('Certificate preview check:', {
                    id: preview.id,
                    hasImage,
                    srcLength: previewImg.src ? previewImg.src.length : 0,
                    srcStart: previewImg.src ? previewImg.src.substring(0, 50) : 'no src',
                    display: preview.style.display,
                    offsetParent: preview.offsetParent !== null
                });
                
                // Collect if image data exists - don't require visibility check as it might be in a hidden tab
                if (hasImage) {
                    const fileName = fileInfo && fileInfo.textContent && fileInfo.textContent !== 'No file selected' 
                        ? fileInfo.textContent 
                        : `Certificate ${certificates.length + 1}`;
                    
                    certificates.push({
                        fileData: previewImg.src,
                        fileName: fileName
                    });
                    console.log('‚úì Added certificate:', fileName, '- Data length:', previewImg.src.length);
                } else {
                    console.log('‚úó Skipping certificate - no valid image data');
                }
            });
            
            console.log('Collected certificates:', certificates.length, certificates);
            return certificates;
        }

        function enableEditing() {
            isEditingProfile = true;
            // Enable all form inputs
            const inputs = document.querySelectorAll('.form-input, .form-textarea');
            inputs.forEach(input => input.disabled = false);
            
            // Enable file uploads
            const fileInputs = document.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => input.disabled = false);
            
            // Enable education and work experience buttons
            document.getElementById('add-education-btn').disabled = false;
            document.getElementById('add-work-experience-btn').disabled = false;
            
            // Diploma and certificate buttons are always enabled (they auto-enable editing when clicked)
            // No need to disable/enable them
            
            // Enable education and work experience inputs
            const educationInputs = document.querySelectorAll('.education-item input, .education-item select, .work-experience-item input, .work-experience-item select');
            educationInputs.forEach(input => input.disabled = false);
            
            // Setup file uploads for all diploma and certificate items
            document.querySelectorAll('[id^="diploma-file-"]').forEach(input => {
                const id = input.id;
                const previewId = id.replace('diploma-file-', 'diploma-preview-');
                setupDocumentUpload(id, previewId);
            });
            document.querySelectorAll('[id^="certificate-file-"]').forEach(input => {
                const id = input.id;
                const previewId = id.replace('certificate-file-', 'certificate-preview-');
                setupDocumentUpload(id, previewId);
            });
            
            // Re-setup valid ID upload when editing is enabled (ensures event listener is active)
            setupDocumentUpload('valid-id', 'valid-id-preview');
            
            // Show/hide buttons in header
            document.getElementById('edit-profile-btn').style.display = 'none';
            document.getElementById('cancel-edit-btn').style.display = 'inline-block';
            document.getElementById('save-profile-btn').style.display = 'inline-block';
        }
        
        function cancelEditing() {
            isEditingProfile = false;
            // Disable all form inputs
            const inputs = document.querySelectorAll('.form-input, .form-textarea');
            inputs.forEach(input => input.disabled = true);
            
            // Disable file uploads
            const fileInputs = document.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => input.disabled = true);
            
            // Disable education and work experience buttons
            document.getElementById('add-education-btn').disabled = true;
            document.getElementById('add-work-experience-btn').disabled = true;
            
            // Diploma and certificate buttons remain enabled (they auto-enable editing when clicked)
            // No need to disable them
            
            // Disable education and work experience inputs
            const educationInputs = document.querySelectorAll('.education-item input, .education-item select, .work-experience-item input, .work-experience-item select');
            educationInputs.forEach(input => input.disabled = true);
            
            // Show/hide buttons in header
            document.getElementById('edit-profile-btn').style.display = 'inline-block';
            document.getElementById('cancel-edit-btn').style.display = 'none';
            document.getElementById('save-profile-btn').style.display = 'none';
            
            // Reload profile data to restore original values
            loadProfileData();
        }
        
        function setupVideoUpload() {
             document.getElementById('video-introduction').addEventListener('change', function(e) {
                 const file = e.target.files[0];
                 console.log('File selected:', file);
                 
                 if (file) {
                     const token = localStorage.getItem('token');
                     if (!token) {
                         showMessage('Authentication required. Please login again.', 'error');
                         return;
                     }
                     
                     console.log('File type:', file.type);
                     console.log('File size:', file.size, 'bytes');
                     
                     // Check file size (limit to 50MB)
                     if (file.size > 50 * 1024 * 1024) {
                         showMessage('Video file size must be less than 50MB', 'error');
                         return;
                     }
                     
                     // Check file type
                     if (!file.type.startsWith('video/')) {
                         showMessage('Please select a valid video file. Selected file type: ' + file.type, 'error');
                         return;
                     }
                     
                     const reader = new FileReader();
                     reader.onload = function(e) {
                         const videoData = e.target.result;
                         
                         // Show preview immediately
                         const videoPlayer = document.getElementById('video-player');
                         const videoSource = videoPlayer.querySelector('source');
                         videoSource.src = videoData;
                         videoPlayer.load();
                         
                         document.getElementById('video-name').textContent = file.name;
                         document.getElementById('video-preview').style.display = 'block';
                         
                         // Save to database
                         console.log('Uploading video to server...');
                         fetch('/api/teacher/upload-video', {
                             method: 'POST',
                             headers: {
                                 'Authorization': `Bearer ${token}`,
                                 'Content-Type': 'application/json'
                             },
                             body: JSON.stringify({
                                 videoData: videoData,
                                 fileName: file.name
                             })
                         })
                         .then(response => {
                             console.log('Video upload response status:', response.status);
                             console.log('Video upload response headers:', response.headers);
                             
                             if (!response.ok) {
                                 throw new Error(`HTTP error! status: ${response.status}`);
                             }
                             
                             return response.json();
                         })
                         .then(data => {
                             console.log('Video upload response data:', data);
                             if (data.success) {
                                 console.log('Video introduction updated successfully');
                                 showMessage('Video introduction updated successfully!', 'success');
                             } else {
                                 console.error('Video upload failed:', data.error);
                                 showMessage('Failed to upload video: ' + (data.error || 'Unknown error'), 'error');
                             }
                         })
                         .catch(error => {
                             console.error('Error uploading video:', error);
                             showMessage('Error uploading video: ' + error.message, 'error');
                         });
                     };
                     reader.readAsDataURL(file);
                 }
             });
         }
         
         function testVideoUploadEndpoint() {
             const token = localStorage.getItem('token');
             if (!token) {
                 console.log('No token available for testing video upload endpoint');
                 return;
             }
             
             // Test if the endpoint is available
             fetch('/api/teacher/profile', {
                 headers: { 'Authorization': `Bearer ${token}` }
             })
             .then(response => {
                 console.log('Server connectivity test - Profile endpoint status:', response.status);
                 if (response.ok) {
                     console.log('‚úÖ Server is running and accessible');
                 } else {
                     console.log('‚ùå Server responded with error:', response.status);
                 }
             })
             .catch(error => {
                 console.log('‚ùå Server connectivity test failed:', error.message);
             });
         }
         
         function removeVideo() {
             const token = localStorage.getItem('token');
             if (!token) {
                 showMessage('Authentication required. Please login again.', 'error');
                 return;
             }
             
             // Clear preview
             const videoPlayer = document.getElementById('video-player');
             const videoSource = videoPlayer.querySelector('source');
             videoSource.src = '';
             videoPlayer.load();
             document.getElementById('video-name').textContent = 'No video selected';
             document.getElementById('video-preview').style.display = 'none';
             
             // Clear file input
             document.getElementById('video-introduction').value = '';
             
             // Remove from database
             fetch('/api/teacher/remove-video', {
                 method: 'POST',
                 headers: {
                     'Authorization': `Bearer ${token}`,
                     'Content-Type': 'application/json'
                 }
             })
             .then(response => response.json())
             .then(data => {
                 if (data.success) {
                     showMessage('Video introduction removed successfully!', 'success');
                 } else {
                     showMessage('Failed to remove video: ' + (data.error || 'Unknown error'), 'error');
                 }
             })
             .catch(error => {
                 console.error('Error removing video:', error);
                 showMessage('Error removing video: ' + error.message, 'error');
             });
         }
         
         function showMessage(message, type) {
             const successMsg = document.getElementById('success-message');
             const errorMsg = document.getElementById('error-message');
             
             if (type === 'success') {
                 successMsg.textContent = message;
                 successMsg.style.display = 'block';
                 errorMsg.style.display = 'none';
             } else {
                 errorMsg.textContent = message;
                 errorMsg.style.display = 'block';
                 successMsg.style.display = 'none';
             }
             
             setTimeout(() => {
                 successMsg.style.display = 'none';
                 errorMsg.style.display = 'none';
             }, 5000);
         }
         
         // Function to update sidebar first name in real-time
         function updateSidebarUsername(firstName) {
             console.log('üîÑ updateSidebarUsername called with firstName:', firstName);
             
             // TEMPORARILY DISABLED: window.open is causing new tab to open
             // Method 1: Try to update via window.open
             /*
             try {
                 const dashboardWindow = window.open('', 'teacher-dashboard');
                 console.log('Dashboard window found:', dashboardWindow ? 'Yes' : 'No');
                 
                 if (dashboardWindow && !dashboardWindow.closed) {
                     console.log('Dashboard window is open, attempting to update sidebar...');
                     
                     // Wait a bit for the page to load if needed
                     setTimeout(() => {
                         try {
                             const usernameElement = dashboardWindow.document.getElementById('remoed-username');
                             const avatarElement = dashboardWindow.document.getElementById('avatar-text');
                             
                             console.log('Username element found:', usernameElement ? 'Yes' : 'No');
                             console.log('Avatar element found:', avatarElement ? 'Yes' : 'No');
                             
                             if (usernameElement) {
                                 usernameElement.textContent = `Hi, ${firstName}`;
                                 console.log('‚úÖ Sidebar first name updated in dashboard window:', firstName);
                             } else {
                                 console.log('‚ùå Username element not found in dashboard');
                             }
                             
                             if (avatarElement) {
                                 const username = localStorage.getItem('remoedUsername');
                                 avatarElement.textContent = username ? username[0].toUpperCase() : firstName[0].toUpperCase();
                                 console.log('‚úÖ Avatar text updated in dashboard window');
                             } else {
                                 console.log('‚ùå Avatar element not found in dashboard');
                             }
                         } catch (innerError) {
                             console.log('‚ùå Error accessing dashboard DOM:', innerError.message);
                         }
                     }, 100); // Small delay to ensure page is loaded
                 } else {
                     console.log('Dashboard window is not open or closed');
                 }
             } catch (error) {
                 console.log('‚ùå Could not update dashboard sidebar via window.open:', error.message);
             }
             */
             
             // Method 2: Update localStorage so dashboard can pick it up on refresh
             try {
                 localStorage.setItem('updatedFirstName', firstName);
                 console.log('‚úÖ Updated localStorage with firstName:', firstName);
                 
                 // Also update the username in localStorage for consistency
                 const username = localStorage.getItem('remoedUsername');
                 if (username) {
                     localStorage.setItem('remoedUsername', username);
                     console.log('‚úÖ Updated localStorage username for consistency');
                 }
             } catch (error) {
                 console.log('‚ùå Could not update localStorage:', error.message);
             }
         }
         
         // Settings functions
         function updateSettings() {
             const token = localStorage.getItem('token');
             if (!token) {
                 showSettingsMessage('Authentication required. Please login again.', 'error');
                 return;
             }
             
             const newEmail = document.getElementById('new-email').value.trim();
             const newUsername = document.getElementById('new-username').value.trim();
             const currentPassword = document.getElementById('current-password').value;
             const newPassword = document.getElementById('new-password').value;
             const confirmPassword = document.getElementById('confirm-password').value;
             
             // Validate inputs
             if (!newEmail && !newUsername && !newPassword) {
                 showSettingsMessage('Please fill in at least one field to update.', 'error');
                 return;
             }
             
             if (newPassword && newPassword !== confirmPassword) {
                 showSettingsMessage('New passwords do not match.', 'error');
                 return;
             }
             
             if (newPassword && newPassword.length < 6) {
                 showSettingsMessage('New password must be at least 6 characters long.', 'error');
                 return;
             }
             
             // Prepare update data
             const updateData = {};
             if (newEmail) updateData.newEmail = newEmail;
             if (newUsername) updateData.newUsername = newUsername;
             if (currentPassword && newPassword) {
                 updateData.currentPassword = currentPassword;
                 updateData.newPassword = newPassword;
             }
             
             // Send update request
             fetch('/api/teacher/update-settings', {
                 method: 'POST',
                 headers: {
                     'Authorization': `Bearer ${token}`,
                     'Content-Type': 'application/json'
                 },
                 body: JSON.stringify(updateData)
             })
             .then(response => response.json())
             .then(data => {
                 if (data.success) {
                     showSettingsMessage('Settings updated successfully!', 'success');
                     
                     // Update localStorage if username changed
                     if (newUsername) {
                         localStorage.setItem('remoedUsername', newUsername);
                     }
                     
                     // Clear form
                     resetSettingsForm();
                     
                     // Reload profile data to reflect changes
                     loadProfileData();
                 } else {
                     showSettingsMessage(data.message || 'Failed to update settings.', 'error');
                 }
             })
             .catch(error => {
                 console.error('Error updating settings:', error);
                 showSettingsMessage('Error updating settings: ' + error.message, 'error');
             });
         }
         
         function resetSettingsForm() {
             document.getElementById('new-email').value = '';
             document.getElementById('new-username').value = '';
             document.getElementById('current-password').value = '';
             document.getElementById('new-password').value = '';
             document.getElementById('confirm-password').value = '';
             
             // Reload current values
             const currentEmail = document.getElementById('email').value;
             const currentUsername = document.getElementById('username').value;
             
             document.getElementById('current-email').value = currentEmail;
             document.getElementById('current-username').value = currentUsername;
             
             showSettingsMessage('', '');
         }
         
         function showSettingsMessage(message, type) {
             const messageDiv = document.getElementById('settings-message');
             
             if (!message) {
                 messageDiv.style.display = 'none';
                 return;
             }
             
             messageDiv.textContent = message;
             messageDiv.style.display = 'block';
             
             if (type === 'success') {
                 messageDiv.style.color = '#28a745';
                 messageDiv.style.backgroundColor = '#d4edda';
                 messageDiv.style.border = '1px solid #c3e6cb';
                 messageDiv.style.padding = '10px';
                 messageDiv.style.borderRadius = '4px';
             } else {
                 messageDiv.style.color = '#dc3545';
                 messageDiv.style.backgroundColor = '#f8d7da';
                 messageDiv.style.border = '1px solid #f5c6cb';
                 messageDiv.style.padding = '10px';
                 messageDiv.style.borderRadius = '4px';
             }
             
             setTimeout(() => {
                 messageDiv.style.display = 'none';
             }, 5000);
                  }
         
        function goToForgotPassword() {
            // Redirect to the forgot password page
            window.location.href = 'forgot-password.html';
        }
        
        // Teaching Abilities Functions
        // Display assessed skill level
        function displayAssessedSkill(skill, assessment) {
            const starsEl = document.getElementById(skill + '-stars');
            const levelTextEl = document.getElementById(skill + '-level-text');
            const levelBadgeEl = document.getElementById(skill + '-level-badge');
            const criteriaListEl = document.getElementById(skill + '-criteria-list');
            const sourceEl = document.getElementById(skill + '-source');
            
            if (!assessment || assessment.level === null || assessment.level === undefined) {
                // Not assessed yet
                if (starsEl) starsEl.textContent = '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ';
                if (levelTextEl) levelTextEl.textContent = 'Not Assessed';
                if (levelBadgeEl) {
                    levelBadgeEl.className = 'assessed-level';
                    levelBadgeEl.style.background = 'linear-gradient(135deg, #6c757d, #5a6268)';
                }
                if (sourceEl) sourceEl.textContent = assessment?.source || 'Pending';
                
                // Still show criteria if available
                if (criteriaListEl && assessment && assessment.criteria) {
                    criteriaListEl.innerHTML = '';
                    assessment.criteria.forEach(criterion => {
                        const li = document.createElement('li');
                        li.className = 'criteria-item';
                        li.textContent = criterion;
                        criteriaListEl.appendChild(li);
                    });
                }
                return;
            }
            
            const level = assessment.level; // 0-5 scale
            const levelNames = ['Beginner', 'Basic', 'Intermediate', 'Advanced', 'Expert', 'Master'];
            const levelName = levelNames[level] || 'Beginner';
            
            // Update stars
            let starDisplay = '';
            for (let i = 0; i < 5; i++) {
                starDisplay += i < level ? '‚òÖ' : '‚òÜ';
            }
            if (starsEl) starsEl.textContent = starDisplay;
            if (levelTextEl) levelTextEl.textContent = levelName;
            
            // Update badge styling based on level
            if (levelBadgeEl) {
                levelBadgeEl.className = 'assessed-level';
                if (level <= 1) levelBadgeEl.style.background = 'linear-gradient(135deg, #FFF3CD, #FFE69C)';
                else if (level <= 2) levelBadgeEl.style.background = 'linear-gradient(135deg, #D1ECF1, #B8E0E8)';
                else if (level <= 3) levelBadgeEl.style.background = 'linear-gradient(135deg, #D4EDDA, #C3E6CB)';
                else if (level <= 4) levelBadgeEl.style.background = 'linear-gradient(135deg, #D1E7DD, #BADBCC)';
                else levelBadgeEl.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            }
            
            // Update assessment criteria
            if (criteriaListEl && assessment.criteria) {
                criteriaListEl.innerHTML = '';
                assessment.criteria.forEach(criterion => {
                    const li = document.createElement('li');
                    li.className = 'criteria-item';
                    li.textContent = criterion;
                    criteriaListEl.appendChild(li);
                });
            }
            
            // Update assessment source
            if (sourceEl && assessment.source) {
                sourceEl.textContent = assessment.source; // 'Interview', 'Trainer', 'AI', or combination
            }
        }
        
        // Enable editing of teaching ability descriptions only
        function enableTeachingAbilitiesEditing() {
            const descriptions = ['listening-description', 'reading-description', 'speaking-description', 'writing-description', 'creativity-hobbies'];
            descriptions.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.disabled = false;
            });
            
            document.getElementById('edit-teaching-abilities-btn').style.display = 'none';
            document.getElementById('save-teaching-abilities-btn').style.display = 'inline-block';
            document.getElementById('cancel-teaching-abilities-btn').style.display = 'inline-block';
        }
        
        // Cancel editing of teaching ability descriptions
        function cancelTeachingAbilitiesEditing() {
            const descriptions = ['listening-description', 'reading-description', 'speaking-description', 'writing-description', 'creativity-hobbies'];
            descriptions.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.disabled = true;
            });
            
            document.getElementById('edit-teaching-abilities-btn').style.display = 'inline-block';
            document.getElementById('save-teaching-abilities-btn').style.display = 'none';
            document.getElementById('cancel-teaching-abilities-btn').style.display = 'none';
            
            // Reload to restore original values
            loadProfileData();
        }
        
        function saveTeachingAbilities() {
            const token = localStorage.getItem('token');
            if (!token) {
                showMessage('Authentication required. Please login again.', 'error');
                return;
            }

            // Only save descriptions - levels are assessed by the system
            const teachingAbilities = {
                listening: {
                    description: document.getElementById('listening-description').value || ''
                },
                reading: {
                    description: document.getElementById('reading-description').value || ''
                },
                speaking: {
                    description: document.getElementById('speaking-description').value || ''
                },
                writing: {
                    description: document.getElementById('writing-description').value || ''
                },
                creativityHobbies: document.getElementById('creativity-hobbies').value || ''
            };

            // Save to profile
            fetch('/api/teacher/profile', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ teachingAbilities })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('Teaching descriptions saved successfully!', 'success');
                    cancelTeachingAbilitiesEditing();
                } else {
                    showMessage('Failed to save teaching descriptions: ' + (data.error || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                console.error('Error saving teaching abilities:', error);
                showMessage('Error saving teaching descriptions: ' + error.message, 'error');
            });
        }
        
        // Support & Resources Functions
        function openSupportModal(type) {
            const modals = {
                technical: {
                    title: 'Technical Assistance',
                    content: 'Our technical support team is here to help you with any platform issues. Contact us at support@remoedph.com or use the live chat feature.',
                    action: 'Contact Support'
                },
                lesson: {
                    title: 'Lesson Guidance',
                    content: 'Access our comprehensive library of lesson plans, teaching materials, and curriculum resources. Visit the Lessons Library in your dashboard.',
                    action: 'Go to Lessons Library'
                },
                training: {
                    title: 'Teacher Training',
                    content: 'Enhance your teaching skills with our training programs covering pedagogy, classroom management, and student engagement techniques.',
                    action: 'Start Training'
                },
                certification: {
                    title: 'Teacher Certification',
                    content: 'Earn certifications to advance your career. Complete training modules and assessments to unlock higher teaching rates and opportunities.',
                    action: 'View Certifications'
                },
                faq: {
                    title: 'Frequently Asked Questions',
                    content: 'Find answers to common questions about teaching on RemoEdPH, payment, scheduling, and platform features.',
                    action: 'View FAQ'
                },
                community: {
                    title: 'Community & Social Responsibility',
                    content: 'View our community initiatives, core values, and social responsibility programs in the Dashboard. Click to go to Dashboard.',
                    action: 'View in Dashboard'
                },
                webinars: {
                    title: 'Training Webinars',
                    content: 'Attend live and recorded webinars on various teaching topics, best practices, and professional development.',
                    action: 'View Webinars'
                },
                'best-practices': {
                    title: 'Best Practices Guide',
                    content: 'Learn proven teaching strategies, student engagement techniques, and tips for success on RemoEdPH.',
                    action: 'Read Guide'
                }
            };
            
            const modal = modals[type] || modals.technical;
            
            // Create and show modal
            const modalHTML = `
                <div id="support-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 8px 24px rgba(0,0,0,0.2);">
                        <h2 style="color: #667eea; margin-top: 0;">${modal.title}</h2>
                        <p style="color: #666; line-height: 1.6; margin-bottom: 24px;">${modal.content}</p>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button onclick="closeSupportModal()" style="padding: 10px 20px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 8px; cursor: pointer; font-weight: 600;">Close</button>
                            <button onclick="handleSupportAction('${type}')" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">${modal.action}</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        function closeSupportModal() {
            const modal = document.getElementById('support-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function handleSupportAction(type) {
            closeSupportModal();
            
            // Handle different actions
            switch(type) {
                case 'lesson':
                    window.location.href = 'teacher-lessons-library.html';
                    break;
                case 'training':
                case 'certification':
                    showMessage('Training and certification features coming soon!', 'success');
                    break;
                case 'community':
                    // Community content is now in the dashboard - redirect directly
                    window.location.href = 'teacher-dashboard.html';
                    return; // Exit early since we're redirecting
                default:
                    showMessage('Feature coming soon! Our team is working on this.', 'success');
            }
        }
        
        // Update sidebar quick info
        function updateSidebarQuickInfo(profile) {
            const email = profile.email || profile.username || '-';
            const contact = profile.contact || '-';
            const birthday = profile.birthday || '-';
            const address = profile.address || '-';
            
            document.getElementById('sidebar-email-display').textContent = email;
            document.getElementById('sidebar-contact-display').textContent = contact !== '-' ? contact : '-';
            
            if (birthday !== '-') {
                try {
                    const date = new Date(birthday);
                    document.getElementById('sidebar-birthday-display').textContent = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                } catch (e) {
                    document.getElementById('sidebar-birthday-display').textContent = birthday;
                }
            } else {
                document.getElementById('sidebar-birthday-display').textContent = '-';
            }
            
            // Display full address - let CSS handle wrapping
            document.getElementById('sidebar-location-display').textContent = address !== '' ? address : '-';
        }
        
        // Handle profile picture click
        function handleProfilePictureClick() {
            if (!isEditingProfile) {
                alert('Click "Edit Profile" to upload a new profile picture.');
                return;
            }
            document.getElementById('profile-picture').click();
        }
        
        // Update profile avatar
        function updateProfileAvatar(profile) {
            const displayName = profile.fullname || `${profile.firstName || ''} ${profile.lastName || ''}`.trim() || profile.username || 'Teacher';
            const avatarImg = document.getElementById('profile-avatar-img');
            const avatarText = document.getElementById('profile-avatar-text');
            
            if (profile.profilePicture) {
                avatarImg.src = profile.profilePicture;
                avatarImg.style.display = 'block';
                avatarText.style.display = 'none';
            } else {
                avatarImg.style.display = 'none';
                avatarText.style.display = 'inline-block';
                avatarText.textContent = displayName[0].toUpperCase();
            }
        }
        
        // Load teaching abilities when profile loads
        function loadTeachingAbilities(profile) {
            // Load assessed levels from backend (these are set by admin/trainer/AI, not self-assigned)
            const skills = ['listening', 'reading', 'speaking', 'writing'];
            
            // Load descriptions (editable by teacher)
            if (profile.teachingAbilities) {
                const ta = profile.teachingAbilities;
                
                if (ta.listening && ta.listening.description) {
                    document.getElementById('listening-description').value = ta.listening.description;
                }
                if (ta.reading && ta.reading.description) {
                    document.getElementById('reading-description').value = ta.reading.description;
                }
                if (ta.speaking && ta.speaking.description) {
                    document.getElementById('speaking-description').value = ta.speaking.description;
                }
                if (ta.writing && ta.writing.description) {
                    document.getElementById('writing-description').value = ta.writing.description;
                }
                if (ta.creativityHobbies) {
                    document.getElementById('creativity-hobbies').value = ta.creativityHobbies;
                }
            }
            
            // Load assessed levels (from assessment system)
            // This should come from a separate API endpoint that calculates based on:
            // - Education level
            // - Certifications (TEFL/TESOL, CELTA, etc.)
            // - Work experience
            // - Performance indicators
            // - Interview/trainer evaluations
            loadAssessedLevels(profile);
        }
        
        // Generate assessment criteria based on profile data
        function generateAssessmentCriteria(profile, skill) {
            const criteria = [];
            
            // Language Proficiency Assessment
            if (profile.languageProficiency) {
                if (profile.languageProficiency.test) {
                    criteria.push(`Language Proficiency: ${profile.languageProficiency.test} (${profile.languageProficiency.level || 'Not specified'})`);
                }
                if (profile.languageProficiency.cefr) {
                    criteria.push(`CEFR Level: ${profile.languageProficiency.cefr}`);
                }
            }
            
            // Teaching Qualifications
            if (profile.certifications && profile.certifications.length > 0) {
                const certs = profile.certifications.filter(c => 
                    c.type && (c.type.includes('TEFL') || c.type.includes('TESOL') || 
                              c.type.includes('CELTA') || c.type.includes('DipTESOL'))
                );
                if (certs.length > 0) {
                    criteria.push(`Teaching Certifications: ${certs.map(c => c.type).join(', ')}`);
                }
            }
            
            // Academic Degrees
            if (profile.education && profile.education.length > 0) {
                const relevantDegrees = profile.education.filter(e => 
                    e.field && (e.field.includes('Education') || e.field.includes('Linguistics') || 
                               e.field.includes('TESOL') || e.field.includes('English'))
                );
                if (relevantDegrees.length > 0) {
                    criteria.push(`Relevant Education: ${relevantDegrees.map(e => e.degree || e.field).join(', ')}`);
                }
            }
            
            // Work Experience
            if (profile.workExperience && profile.workExperience.length > 0) {
                const teachingExp = profile.workExperience.filter(w => 
                    w.position && (w.position.toLowerCase().includes('teacher') || 
                                 w.position.toLowerCase().includes('instructor') ||
                                 w.position.toLowerCase().includes('tutor'))
                );
                if (teachingExp.length > 0) {
                    const totalYears = teachingExp.reduce((sum, exp) => {
                        const years = exp.yearsOfExperience || 0;
                        return sum + years;
                    }, 0);
                    if (totalYears > 0) {
                        criteria.push(`Teaching Experience: ${totalYears} year${totalYears > 1 ? 's' : ''}`);
                    }
                }
            }
            
            // Performance Indicators (from performance indicator page)
            // This would be fetched from the performance analysis API
            if (profile.performanceIndicators) {
                if (profile.performanceIndicators.averageRating >= 4.5) {
                    criteria.push(`Student Ratings: ${profile.performanceIndicators.averageRating.toFixed(1)}/5.0 (Excellent)`);
                }
                if (profile.performanceIndicators.completionRate >= 95) {
                    criteria.push(`Completion Rate: ${profile.performanceIndicators.completionRate}% (High)`);
                }
            }
            
            // Interview/Trainer Assessment
            if (profile.assessments && profile.assessments[skill]) {
                const skillAssessment = profile.assessments[skill];
                if (skillAssessment.interviewScore) {
                    criteria.push(`Interview Assessment: ${skillAssessment.interviewScore}/5`);
                }
                if (skillAssessment.trainerEvaluation) {
                    criteria.push(`Trainer Evaluation: ${skillAssessment.trainerEvaluation}`);
                }
            }
            
            return criteria.length > 0 ? criteria : ['Complete your profile, upload certifications, and complete the interview to be assessed'];
        }
        
        // Load assessed levels from assessment system
        async function loadAssessedLevels(profile) {
            const token = localStorage.getItem('token');
            if (!token) return;
            
            try {
                // Fetch assessed levels from backend
                const response = await fetch('/api/teacher/assessed-abilities', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.assessments) {
                        // Display each assessed skill
                        ['listening', 'reading', 'speaking', 'writing'].forEach(skill => {
                            if (data.assessments[skill]) {
                                const assessment = data.assessments[skill];
                                // Generate criteria if not provided
                                if (!assessment.criteria || assessment.criteria.length === 0) {
                                    assessment.criteria = generateAssessmentCriteria(profile, skill);
                                }
                                displayAssessedSkill(skill, assessment);
                            } else {
                                // Show pending with criteria based on current profile
                                const criteria = generateAssessmentCriteria(profile, skill);
                                displayAssessedSkill(skill, {
                                    level: null,
                                    criteria: criteria,
                                    source: 'Pending'
                                });
                            }
                        });
                    }
                } else {
                    // If endpoint doesn't exist yet, show pending assessment with criteria
                    console.log('Assessment endpoint not available, showing pending assessment');
                    ['listening', 'reading', 'speaking', 'writing'].forEach(skill => {
                        const criteria = generateAssessmentCriteria(profile, skill);
                        displayAssessedSkill(skill, {
                            level: null,
                            criteria: criteria,
                            source: 'Pending'
                        });
                    });
                }
            } catch (error) {
                console.error('Error loading assessed levels:', error);
                // Fallback: show pending with criteria
                ['listening', 'reading', 'speaking', 'writing'].forEach(skill => {
                    const criteria = generateAssessmentCriteria(profile, skill);
                    displayAssessedSkill(skill, {
                        level: null,
                        criteria: criteria,
                        source: 'Pending'
                    });
                });
            }
        }
        
        // ========== PROFILE COMPLETION INDICATOR ==========
        function updateProfileCompletion() {
            const requiredFields = {
                'firstname': 'First Name',
                'lastname': 'Last Name',
                'email': 'Email',
                'username': 'Username',
                'introduction': 'Introduction',
                'profilePicture': 'Profile Picture'
            };
            
            const optionalFields = {
                'birthday': 'Birthday',
                'gender': 'Gender',
                'contact': 'Contact Number',
                'address': 'Address',
                'hobbies': 'Hobbies',
                'experience': 'Experience',
                'education': 'Education',
                'workExperience': 'Work Experience',
                'diplomas': 'Diplomas',
                'certificates': 'Certificates',
                'validId': 'Valid ID',
                'videoIntroduction': 'Video Introduction'
            };
            
            let completedRequired = 0;
            let completedOptional = 0;
            const missingFields = [];
            
            // Check required fields
            Object.keys(requiredFields).forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    const value = field.value ? field.value.trim() : '';
                    if (value) {
                        completedRequired++;
                    } else {
                        missingFields.push(requiredFields[fieldId]);
                    }
                } else if (fieldId === 'profilePicture') {
                    const img = document.getElementById('profile-avatar-img');
                    if (img && img.src && !img.src.includes('data:image/svg+xml')) {
                        completedRequired++;
                    } else {
                        missingFields.push(requiredFields[fieldId]);
                    }
                }
            });
            
            // Check optional fields
            Object.keys(optionalFields).forEach(fieldId => {
                if (fieldId === 'diplomas' || fieldId === 'certificates') {
                    const container = document.getElementById(fieldId === 'diplomas' ? 'diplomas-container' : 'certificates-container');
                    if (container && container.children.length > 0) {
                        completedOptional++;
                    }
                } else if (fieldId === 'validId') {
                    const preview = document.getElementById('valid-id-preview');
                    if (preview && preview.style.display !== 'none') {
                        completedOptional++;
                    }
                } else if (fieldId === 'education' || fieldId === 'workExperience') {
                    const container = document.getElementById(fieldId === 'education' ? 'education-container' : 'work-experience-container');
                    if (container && container.children.length > 0) {
                        completedOptional++;
                    }
                } else if (fieldId === 'videoIntroduction') {
                    const video = document.getElementById('video-player');
                    if (video && video.querySelector('source') && video.querySelector('source').src) {
                        completedOptional++;
                    }
                } else {
                    const field = document.getElementById(fieldId);
                    if (field && field.value && field.value.trim()) {
                        completedOptional++;
                    }
                }
            });
            
            const totalRequired = Object.keys(requiredFields).length;
            const totalOptional = Object.keys(optionalFields).length;
            const totalFields = totalRequired + totalOptional;
            const totalCompleted = completedRequired + completedOptional;
            
            const percentage = Math.round((totalCompleted / totalFields) * 100);
            const requiredPercentage = Math.round((completedRequired / totalRequired) * 100);
            
            // Update progress bar
            const progressBar = document.getElementById('completion-progress-bar');
            const percentageEl = document.getElementById('completion-percentage');
            const detailsEl = document.getElementById('completion-details');
            const messageEl = document.getElementById('completion-message');
            const missingListEl = document.getElementById('missing-fields-list');
            const missingTextEl = document.getElementById('missing-fields-text');
            
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
            if (percentageEl) {
                percentageEl.textContent = percentage + '%';
                if (percentage >= 80) {
                    percentageEl.style.color = '#10b981';
                } else if (percentage >= 50) {
                    percentageEl.style.color = '#f59e0b';
                } else {
                    percentageEl.style.color = '#e74c3c';
                }
            }
            if (detailsEl) {
                detailsEl.textContent = `${completedRequired}/${totalRequired} required, ${completedOptional}/${totalOptional} optional`;
            }
            if (messageEl) {
                if (percentage === 100) {
                    messageEl.textContent = 'üéâ Your profile is complete!';
                    messageEl.style.color = '#10b981';
                } else if (requiredPercentage === 100) {
                    messageEl.textContent = 'Great! Add optional information to improve your profile';
                    messageEl.style.color = '#667eea';
                } else {
                    messageEl.textContent = 'Complete your profile to attract more students';
                    messageEl.style.color = '#666';
                }
            }
            if (missingFields.length > 0 && missingListEl && missingTextEl) {
                missingTextEl.textContent = missingFields.join(', ');
                missingListEl.style.display = 'block';
            } else if (missingListEl) {
                missingListEl.style.display = 'none';
            }
        }
        
        // ========== BULK UPLOAD WITH DRAG & DROP ==========
        function setupBulkUpload() {
            const bulkZone = document.getElementById('bulk-upload-zone');
            const bulkInput = document.getElementById('bulk-upload-input');
            
            if (!bulkZone || !bulkInput) return;
            
            // Click to browse
            bulkZone.addEventListener('click', () => {
                bulkInput.click();
            });
            
            // Drag and drop events
            bulkZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                bulkZone.classList.add('drag-over');
            });
            
            bulkZone.addEventListener('dragleave', () => {
                bulkZone.classList.remove('drag-over');
            });
            
            bulkZone.addEventListener('drop', (e) => {
                e.preventDefault();
                bulkZone.classList.remove('drag-over');
                const files = Array.from(e.dataTransfer.files);
                handleBulkFiles(files);
            });
            
            bulkInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleBulkFiles(files);
            });
        }
        
        function handleBulkFiles(files) {
            const validFiles = files.filter(file => {
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
                return validTypes.includes(file.type);
            });
            
            if (validFiles.length === 0) {
                showMessage('Please select valid image or PDF files', 'error');
                return;
            }
            
            bulkUploadFiles = validFiles;
            displayBulkFiles();
        }
        
        function displayBulkFiles() {
            const listContainer = document.getElementById('bulk-files-list');
            const filesListDiv = document.getElementById('bulk-upload-files-list');
            
            if (!listContainer || !filesListDiv) return;
            
            listContainer.innerHTML = '';
            bulkUploadFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; margin-bottom: 4px; background: white; border-radius: 6px;';
                fileItem.innerHTML = `
                    <span style="font-size: 0.85rem; color: #666;">${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button type="button" onclick="removeBulkFile(${index})" style="background: #e74c3c; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">Remove</button>
                `;
                listContainer.appendChild(fileItem);
            });
            
            filesListDiv.style.display = 'block';
        }
        
        function removeBulkFile(index) {
            bulkUploadFiles.splice(index, 1);
            if (bulkUploadFiles.length === 0) {
                document.getElementById('bulk-upload-files-list').style.display = 'none';
            } else {
                displayBulkFiles();
            }
        }
        
        function clearBulkUpload() {
            bulkUploadFiles = [];
            document.getElementById('bulk-upload-files-list').style.display = 'none';
            document.getElementById('bulk-upload-input').value = '';
        }
        
        function processBulkUpload() {
            if (bulkUploadFiles.length === 0) {
                showMessage('No files selected', 'error');
                return;
            }
            
            // Show organization modal or directly categorize
            const category = prompt(`Organize ${bulkUploadFiles.length} file(s):\n\nType:\n1 - Diplomas\n2 - Certificates\n3 - Valid ID\n\nOr press Cancel to skip organization.`);
            
            if (!category) return;
            
            const categoryNum = parseInt(category);
            
            // Process files immediately with preview
            if (categoryNum === 1) {
                // Add as diplomas - process files immediately
                bulkUploadFiles.forEach((file, index) => {
                    setTimeout(() => {
                        // Create diploma item with file data already included
                        addDiplomaItemWithFile(file);
                    }, index * 150);
                });
            } else if (categoryNum === 2) {
                // Add as certificates - process files immediately
                bulkUploadFiles.forEach((file, index) => {
                    setTimeout(() => {
                        // Create certificate item with file data already included
                        addCertificateItemWithFile(file);
                    }, index * 150);
                });
            } else if (categoryNum === 3 && bulkUploadFiles.length === 1) {
                // Add as valid ID - process file immediately
                const file = bulkUploadFiles[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileData = e.target.result;
                    const preview = document.getElementById('valid-id-preview');
                    if (preview) {
                        const previewImg = preview.querySelector('img');
                        const fileInfo = preview.querySelector('.file-info');
                        
                        if (previewImg && file.type.startsWith('image/')) {
                            previewImg.src = fileData;
                            previewImg.style.display = 'block';
                        }
                        if (fileInfo) {
                            fileInfo.textContent = file.name;
                        }
                        preview.style.display = 'block';
                    }
                };
                reader.readAsDataURL(file);
            } else {
                showMessage('Invalid category or too many files for Valid ID', 'error');
                return;
            }
            
            clearBulkUpload();
            showMessage(`‚úÖ Successfully uploaded ${bulkUploadFiles.length} file(s)! Files are ready to save.`, 'success');
            
            // Update counts after a delay to ensure items are created
            setTimeout(() => {
                updateDocumentCounts();
                updateProfileCompletion();
            }, bulkUploadFiles.length * 200);
        }
        
        // Helper function to add diploma with file already processed
        function addDiplomaItemWithFile(file) {
            // Enable editing if not already enabled
            if (!isEditingProfile) {
                enableEditing();
            }
            
            const container = document.getElementById('diplomas-container');
            if (!container) {
                console.error('Diplomas container not found');
                return;
            }
            
            const currentCount = container.children.length;
            if (currentCount >= 5) {
                showMessage('Maximum of 5 diplomas allowed', 'error');
                return;
            }
            
            const itemId = `diploma-${diplomaCounter++}`;
            const displayNumber = currentCount + 1;
            
            // Read file first
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = e.target.result;
                
                const diplomaItem = document.createElement('div');
                diplomaItem.className = 'document-item';
                diplomaItem.id = itemId;
                
                diplomaItem.innerHTML = `
                    <div class="document-header">
                        <strong>Diploma ${displayNumber}</strong>
                        <button type="button" class="remove-btn" onclick="removeDiplomaItem('${itemId}')" style="padding: 4px 8px; font-size: 0.75rem;">Remove</button>
                    </div>
                    <div class="document-content">
                        <div class="document-upload-compact">
                            <div class="file-upload" id="diploma-upload-${itemId}">
                                <input type="file" id="diploma-file-${itemId}" name="diploma-${itemId}" accept=".pdf,.jpg,.jpeg,.png" ${isEditingProfile ? '' : 'disabled'}>
                                <label class="file-upload-label-compact" for="diploma-file-${itemId}">üìÑ Replace</label>
                            </div>
                        </div>
                        <div class="document-preview-compact" id="diploma-preview-${itemId}" style="display: block;">
                            <img src="${fileData}" alt="Diploma Preview">
                            <div class="file-info">${file.name}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(diplomaItem);
                
                // Setup file upload for replacement
                setTimeout(() => {
                    setupDocumentUpload(`diploma-file-${itemId}`, `diploma-preview-${itemId}`);
                }, 100);
            };
            reader.readAsDataURL(file);
        }
        
        // Helper function to add certificate with file already processed
        function addCertificateItemWithFile(file) {
            // Enable editing if not already enabled
            if (!isEditingProfile) {
                enableEditing();
            }
            
            const container = document.getElementById('certificates-container');
            if (!container) {
                console.error('Certificates container not found');
                return;
            }
            
            const currentCount = container.children.length;
            if (currentCount >= 5) {
                showMessage('Maximum of 5 certificates allowed', 'error');
                return;
            }
            
            const itemId = `certificate-${certificateCounter++}`;
            const displayNumber = currentCount + 1;
            
            // Read file first
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = e.target.result;
                
                const certificateItem = document.createElement('div');
                certificateItem.className = 'document-item';
                certificateItem.id = itemId;
                
                certificateItem.innerHTML = `
                    <div class="document-header">
                        <strong>Certificate ${displayNumber}</strong>
                        <button type="button" class="remove-btn" onclick="removeCertificateItem('${itemId}')" style="padding: 4px 8px; font-size: 0.75rem;">Remove</button>
                    </div>
                    <div class="document-content">
                        <div class="document-upload-compact">
                            <div class="file-upload" id="certificate-upload-${itemId}">
                                <input type="file" id="certificate-file-${itemId}" name="certificate-${itemId}" accept=".pdf,.jpg,.jpeg,.png" ${isEditingProfile ? '' : 'disabled'}>
                                <label class="file-upload-label-compact" for="certificate-file-${itemId}">üèÜ Replace</label>
                            </div>
                        </div>
                        <div class="document-preview-compact" id="certificate-preview-${itemId}" style="display: block;">
                            <img src="${fileData}" alt="Certificate Preview">
                            <div class="file-info">${file.name}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(certificateItem);
                
                // Setup file upload for replacement
                setTimeout(() => {
                    setupDocumentUpload(`certificate-file-${itemId}`, `certificate-preview-${itemId}`);
                }, 100);
            };
            reader.readAsDataURL(file);
        }
        
        // ========== DOCUMENT CATEGORY TABS ==========
        function showDocumentCategory(category) {
            // Hide all categories
            document.querySelectorAll('.document-category').forEach(cat => {
                cat.style.display = 'none';
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.doc-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected category
            const categoryEl = document.getElementById(category + '-category');
            if (categoryEl) {
                categoryEl.style.display = 'block';
            }
            
            // Add active class to clicked button
            const btn = document.querySelector(`[data-category="${category}"]`);
            if (btn) {
                btn.classList.add('active');
            }
        }
        
        function updateDocumentCounts() {
            const diplomaCount = document.getElementById('diplomas-container')?.children.length || 0;
            const certificateCount = document.getElementById('certificates-container')?.children.length || 0;
            
            const diplomaBadge = document.getElementById('diploma-count-badge');
            const certificateBadge = document.getElementById('certificate-count-badge');
            
            if (diplomaBadge) {
                diplomaBadge.textContent = diplomaCount;
                diplomaBadge.style.display = diplomaCount > 0 ? 'inline-block' : 'none';
            }
            if (certificateBadge) {
                certificateBadge.textContent = certificateCount;
                certificateBadge.style.display = certificateCount > 0 ? 'inline-block' : 'none';
            }
        }
        
        // ========== PREVIEW MODE ==========
        function togglePreviewMode() {
            isPreviewMode = !isPreviewMode;
            const previewBtn = document.getElementById('preview-profile-btn');
            const profileForm = document.getElementById('profile-form');
            
            if (isPreviewMode) {
                // Show preview modal
                showPreviewModal();
                if (previewBtn) {
                    previewBtn.textContent = '‚úèÔ∏è Edit Profile';
                }
            } else {
                // Hide preview modal
                hidePreviewModal();
                if (previewBtn) {
                    previewBtn.textContent = 'üëÅÔ∏è Preview Profile';
                }
            }
        }
        
        function showPreviewModal() {
            const overlay = document.createElement('div');
            overlay.className = 'preview-overlay';
            overlay.id = 'preview-overlay';
            overlay.onclick = () => togglePreviewMode();
            
            const modal = document.createElement('div');
            modal.className = 'preview-modal';
            modal.id = 'preview-modal';
            
            // Get profile data
            const profileData = collectProfileDataForPreview();
            
            modal.innerHTML = `
                <div class="preview-modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 24px; border-radius: 20px 20px 0 0; color: white;">
                    <h3 style="margin: 0; color: white; font-size: 1.3rem; display: flex; align-items: center; gap: 8px;">
                        üëÅÔ∏è This is how students see your profile!
                    </h3>
                    <button class="close-preview-btn" onclick="togglePreviewMode()" style="background: rgba(255,255,255,0.2); border: 2px solid white; color: white;">‚úï Close</button>
                </div>
                <div style="padding: 24px;">
                    ${generatePreviewHTML(profileData)}
                </div>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
            
            overlay.style.display = 'block';
            modal.style.display = 'block';
        }
        
        function hidePreviewModal() {
            const overlay = document.getElementById('preview-overlay');
            const modal = document.getElementById('preview-modal');
            if (overlay) overlay.remove();
            if (modal) modal.remove();
        }
        
        function collectProfileDataForPreview() {
            // Collect diplomas and certificates with previews
            const diplomas = [];
            const certificates = [];
            
            document.querySelectorAll('#diplomas-container .document-item').forEach(item => {
                const preview = item.querySelector('.file-preview img');
                if (preview && preview.src && preview.src.startsWith('data:')) {
                    diplomas.push({
                        fileData: preview.src,
                        fileName: item.querySelector('.file-info')?.textContent || 'Diploma'
                    });
                }
            });
            
            document.querySelectorAll('#certificates-container .document-item').forEach(item => {
                const preview = item.querySelector('.file-preview img');
                if (preview && preview.src && preview.src.startsWith('data:')) {
                    certificates.push({
                        fileData: preview.src,
                        fileName: item.querySelector('.file-info')?.textContent || 'Certificate'
                    });
                }
            });
            
            // Collect teaching abilities
            const teachingAbilities = {
                listening: {
                    description: document.getElementById('listening-description')?.value || '',
                    level: document.getElementById('listening-level-text')?.textContent || 'Not Assessed'
                },
                reading: {
                    description: document.getElementById('reading-description')?.value || '',
                    level: document.getElementById('reading-level-text')?.textContent || 'Not Assessed'
                },
                speaking: {
                    description: document.getElementById('speaking-description')?.value || '',
                    level: document.getElementById('speaking-level-text')?.textContent || 'Not Assessed'
                },
                writing: {
                    description: document.getElementById('writing-description')?.value || '',
                    level: document.getElementById('writing-level-text')?.textContent || 'Not Assessed'
                },
                creativityHobbies: document.getElementById('creativity-hobbies')?.value || ''
            };
            
            // Check for video introduction - get from video-player element
            let videoIntro = null;
            const videoPlayer = document.getElementById('video-player');
            if (videoPlayer) {
                const videoSource = videoPlayer.querySelector('source');
                if (videoSource && videoSource.src && videoSource.src.trim() !== '') {
                    videoIntro = videoSource.src;
                    console.log('Video found in source tag:', videoIntro);
                } else if (videoPlayer.src && videoPlayer.src.trim() !== '') {
                    videoIntro = videoPlayer.src;
                    console.log('Video found in video element src:', videoIntro);
                } else {
                    console.log('No video source found in video-player element');
                }
            } else {
                console.log('Video player element not found');
            }
            
            return {
                name: (document.getElementById('firstname')?.value || '') + ' ' + (document.getElementById('lastname')?.value || ''),
                email: document.getElementById('email')?.value || '',
                contact: document.getElementById('contact')?.value || '',
                introduction: document.getElementById('introduction')?.value || '',
                experience: document.getElementById('experience')?.value || '',
                profilePicture: document.getElementById('profile-avatar-img')?.src || null,
                education: Array.from(document.querySelectorAll('.education-item')).map(item => ({
                    degree: item.querySelector('[name="degree"]')?.value || '',
                    school: item.querySelector('[name="school"]')?.value || '',
                    year: item.querySelector('[name="yearGraduated"]')?.value || ''
                })).filter(edu => edu.degree || edu.school),
                workExperience: Array.from(document.querySelectorAll('.work-experience-item')).map(item => ({
                    company: item.querySelector('[name="company"]')?.value || '',
                    position: item.querySelector('[name="jobTitle"]')?.value || '',
                    duration: item.querySelector('[name="duration"]')?.value || ''
                })).filter(work => work.company || work.position),
                diplomas: diplomas,
                certificates: certificates,
                teachingAbilities: teachingAbilities,
                videoIntroduction: videoIntro,
                hobbies: document.getElementById('hobbies')?.value || ''
            };
        }
        
        function generatePreviewHTML(data) {
            const teacherName = data.name?.trim() || 'Teacher';
            const firstName = teacherName.split(' ')[0] || 'Teacher';
            
            // Helper function to get level badge color
            const getLevelColor = (level) => {
                if (!level || level === 'Not Assessed') return '#95a5a6';
                const levelLower = level.toLowerCase();
                if (levelLower.includes('expert') || levelLower.includes('advanced')) return '#10b981';
                if (levelLower.includes('intermediate')) return '#f59e0b';
                return '#667eea';
            };
            
            // Helper function to get level emoji
            const getLevelEmoji = (level) => {
                if (!level || level === 'Not Assessed') return '‚≠ê';
                const levelLower = level.toLowerCase();
                if (levelLower.includes('expert')) return 'üèÜ';
                if (levelLower.includes('advanced')) return 'üåü';
                if (levelLower.includes('intermediate')) return '‚ú®';
                return '‚≠ê';
            };
            
            return `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 20px; border-radius: 20px 20px 0 0; margin: -24px -24px 30px -24px; text-align: center; color: white;">
                    ${data.profilePicture ? `
                        <div style="position: relative; display: inline-block; margin-bottom: 16px;">
                            <img src="${data.profilePicture}" style="width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 5px solid white; box-shadow: 0 8px 20px rgba(0,0,0,0.2);">
                            <div style="position: absolute; bottom: 5px; right: 5px; background: #10b981; width: 32px; height: 32px; border-radius: 50%; border: 3px solid white; display: flex; align-items: center; justify-content: center; font-size: 18px;">‚úì</div>
                        </div>
                    ` : `
                        <div style="width: 140px; height: 140px; border-radius: 50%; background: white; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 60px; color: #667eea; border: 5px solid white; box-shadow: 0 8px 20px rgba(0,0,0,0.2);">
                            ${firstName.charAt(0).toUpperCase()}
                        </div>
                    `}
                    <h1 style="margin: 0; font-size: 2rem; font-weight: 800; text-shadow: 0 2px 6px rgba(0,0,0,0.3); color: white;">üëã Hi! I'm ${teacherName}</h1>
                    <p style="margin: 8px 0 0 0; font-size: 1.2rem; color: white; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.3px;">Your Friendly English Teacher! ‚ú®</p>
                </div>
                
                ${data.videoIntroduction && data.videoIntroduction.trim() !== '' ? `
                <div style="background: linear-gradient(135deg, #f0f8ff 0%, #e8f4fd 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border: 3px solid #667eea; text-align: center;">
                    <h3 style="margin: 0 0 16px 0; color: #667eea; font-size: 1.4rem; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        üé• Watch My Introduction Video!
                    </h3>
                    <video controls style="width: 100%; max-width: 600px; border-radius: 12px; box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3); background: #000;" preload="metadata">
                        <source src="${data.videoIntroduction}" type="video/mp4">
                        <source src="${data.videoIntroduction}" type="video/webm">
                        Your browser does not support the video tag.
                    </video>
                    <p style="margin: 16px 0 0 0; color: #1a202c; font-size: 1rem; font-weight: 600;">Get to know me better! üëã</p>
                </div>
                ` : ''}
                
                <div style="background: linear-gradient(135deg, #fff5e6 0%, #ffe8cc 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #f59e0b;">
                    <h3 style="margin: 0 0 12px 0; color: #f59e0b; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üí¨ About Me
                    </h3>
                    <p style="color: #1a202c; line-height: 1.8; font-size: 1.05rem; margin: 0;">
                        ${data.introduction || `Hello! I'm ${firstName}, and I love teaching English! I'm here to help you learn and have fun while doing it! üòä`}
                    </p>
                </div>
                
                ${data.experience ? `
                <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #10b981;">
                    <h3 style="margin: 0 0 12px 0; color: #10b981; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üéì My Teaching Experience
                    </h3>
                    <p style="color: #1a202c; line-height: 1.8; font-size: 1.05rem; margin: 0;">${data.experience}</p>
                </div>
                ` : ''}
                
                ${data.teachingAbilities ? `
                <div style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #9c27b0;">
                    <h3 style="margin: 0 0 20px 0; color: #9c27b0; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üéØ What I Can Teach You
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        ${data.teachingAbilities.listening ? `
                            <div style="background: white; padding: 16px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">üëÇ</div>
                                <div style="font-weight: 700; color: #1a202c; margin-bottom: 8px;">Listening</div>
                                <div style="padding: 6px 12px; background: ${getLevelColor(data.teachingAbilities.listening.level)}; color: white; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block;">
                                    ${getLevelEmoji(data.teachingAbilities.listening.level)} ${data.teachingAbilities.listening.level || 'Not Assessed'}
                                </div>
                            </div>
                        ` : ''}
                        ${data.teachingAbilities.reading ? `
                            <div style="background: white; padding: 16px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">üìñ</div>
                                <div style="font-weight: 700; color: #1a202c; margin-bottom: 8px;">Reading</div>
                                <div style="padding: 6px 12px; background: ${getLevelColor(data.teachingAbilities.reading.level)}; color: white; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block;">
                                    ${getLevelEmoji(data.teachingAbilities.reading.level)} ${data.teachingAbilities.reading.level || 'Not Assessed'}
                                </div>
                            </div>
                        ` : ''}
                        ${data.teachingAbilities.speaking ? `
                            <div style="background: white; padding: 16px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">üó£Ô∏è</div>
                                <div style="font-weight: 700; color: #1a202c; margin-bottom: 8px;">Speaking</div>
                                <div style="padding: 6px 12px; background: ${getLevelColor(data.teachingAbilities.speaking.level)}; color: white; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block;">
                                    ${getLevelEmoji(data.teachingAbilities.speaking.level)} ${data.teachingAbilities.speaking.level || 'Not Assessed'}
                                </div>
                            </div>
                        ` : ''}
                        ${data.teachingAbilities.writing ? `
                            <div style="background: white; padding: 16px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="font-size: 2.5rem; margin-bottom: 8px;">‚úçÔ∏è</div>
                                <div style="font-weight: 700; color: #1a202c; margin-bottom: 8px;">Writing</div>
                                <div style="padding: 6px 12px; background: ${getLevelColor(data.teachingAbilities.writing.level)}; color: white; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block;">
                                    ${getLevelEmoji(data.teachingAbilities.writing.level)} ${data.teachingAbilities.writing.level || 'Not Assessed'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}
                
                ${data.education && data.education.length > 0 ? `
                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #2196f3;">
                    <h3 style="margin: 0 0 16px 0; color: #2196f3; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üéì My Education
                    </h3>
                    ${data.education.map(edu => `
                        <div style="background: white; padding: 16px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="font-size: 1.2rem; font-weight: 700; color: #2196f3; margin-bottom: 4px;">${edu.degree || 'Degree'}</div>
                            <div style="color: #666; margin-bottom: 4px;">üè´ ${edu.school || 'School'}</div>
                            ${edu.year ? `<div style="color: #999; font-size: 0.9rem;">üìÖ Graduated: ${edu.year}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${data.workExperience && data.workExperience.length > 0 ? `
                <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #ff9800;">
                    <h3 style="margin: 0 0 16px 0; color: #ff9800; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üíº My Work Experience
                    </h3>
                    ${data.workExperience.map(work => `
                        <div style="background: white; padding: 16px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="font-size: 1.1rem; font-weight: 700; color: #ff9800; margin-bottom: 4px;">${work.position || 'Position'}</div>
                            <div style="color: #666; margin-bottom: 4px;">üè¢ ${work.company || 'Company'}</div>
                            ${work.duration ? `<div style="color: #999; font-size: 0.9rem;">‚è∞ ${work.duration}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${(data.diplomas && data.diplomas.length > 0) || (data.certificates && data.certificates.length > 0) ? `
                <div style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #e91e63;">
                    <h3 style="margin: 0 0 16px 0; color: #e91e63; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üèÜ My Certificates & Diplomas
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;">
                        ${data.diplomas.map((diploma, idx) => `
                            <div style="background: white; padding: 12px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <img src="${diploma.fileData}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 8px;">
                                <div style="font-size: 0.85rem; color: #666; font-weight: 600;">üìÑ Diploma ${idx + 1}</div>
                            </div>
                        `).join('')}
                        ${data.certificates.map((cert, idx) => `
                            <div style="background: white; padding: 12px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <img src="${cert.fileData}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 8px;">
                                <div style="font-size: 0.85rem; color: #666; font-weight: 600;">üèÜ Certificate ${idx + 1}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${data.hobbies || data.teachingAbilities?.creativityHobbies ? `
                <div style="background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; border-left: 5px solid #009688;">
                    <h3 style="margin: 0 0 12px 0; color: #009688; font-size: 1.4rem; display: flex; align-items: center; gap: 8px;">
                        üé® My Hobbies & Interests
                    </h3>
                    <p style="color: #1a202c; line-height: 1.8; font-size: 1.05rem; margin: 0;">
                        ${data.hobbies || data.teachingAbilities?.creativityHobbies || 'I love learning and teaching! üòä'}
                    </p>
                </div>
                ` : ''}
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 24px; border-radius: 16px; text-align: center; color: white; margin-top: 32px; box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);">
                    <h3 style="margin: 0 0 12px 0; font-size: 1.5rem; color: white; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">Ready to Learn Together? üöÄ</h3>
                    <p style="margin: 0; font-size: 1.1rem; color: white; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">Book a class with me and let's start your English learning journey! üí™‚ú®</p>
                </div>
            `;
        }
        
        // Update completion when profile data loads
        const originalLoadProfileData = loadProfileData;
        loadProfileData = function() {
            if (originalLoadProfileData) originalLoadProfileData();
            setTimeout(() => {
                updateProfileCompletion();
                updateDocumentCounts();
            }, 500);
        };
        
        // Update completion when documents are added/removed
        const originalAddDiploma = addDiplomaItem;
        const originalAddCertificate = addCertificateItem;
        
        if (typeof addDiplomaItem === 'function') {
            window.addDiplomaItem = function(data) {
                if (originalAddDiploma) originalAddDiploma(data);
                setTimeout(() => {
                    updateDocumentCounts();
                    updateProfileCompletion();
                }, 100);
            };
        }
        
        if (typeof addCertificateItem === 'function') {
            window.addCertificateItem = function(data) {
                if (originalAddCertificate) originalAddCertificate(data);
                setTimeout(() => {
                    updateDocumentCounts();
                    updateProfileCompletion();
                }, 100);
            };
        }
        
    </script>
</body>
<script src="mobile-utils.js"></script>
<script>
    // Initialize mobile features for profile page
    document.addEventListener('DOMContentLoaded', function() {
        if (isMobile && isMobile()) {
            // Add swipe gestures to document items
            setTimeout(() => {
                const documentItems = document.querySelectorAll('.document-item');
                documentItems.forEach(item => {
                    item.setAttribute('data-swipe-item', 'true');
                });
                
                if (documentItems.length > 0) {
                    new QuickActions('#diplomas-container, #certificates-container', {
                        actionButtons: ['edit', 'delete']
                    });
                }
            }, 1000);
        }
    });
</script>
</html> 